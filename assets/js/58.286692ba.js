(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{463:function(t,s,a){"use strict";a.r(s);var e=a(34),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[a("img",{attrs:{src:"/other/git/mirror/banner.jpg",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),a("p",[t._v("  大多数的开发者都或多或少在"),a("code",[t._v("GitHub")]),t._v("上维护有项目，但是通常"),a("code",[t._v("GitHub")]),t._v("访问起来都很慢，或者无法响应。为了不能正常访问"),a("code",[t._v("GitHub")]),t._v("的用户，一般会将"),a("code",[t._v("Gitee")]),t._v("或其它平台托管作为镜像。")]),t._v(" "),a("p",[t._v("  我们通常只考虑维护在"),a("code",[t._v("GitHub")]),t._v("上的仓库就足够了，而对于其它镜像仓库，更多的是希望在"),a("code",[t._v("GitHub")]),t._v("更新的同时，都以静默的方式自动同步。")]),t._v(" "),a("p",[t._v("  因此以下将以"),a("code",[t._v("Gitee")]),t._v("作为镜像仓库，对比多种同步方式的利弊，跟随此文你将了解到。")]),t._v(" "),a("ul",[a("li",[t._v("同步"),a("code",[t._v("GitHub")]),t._v("和"),a("code",[t._v("Gitee")]),t._v("代码仓库的多种方式")]),t._v(" "),a("li",[a("code",[t._v("webhooks")]),t._v("是什么")]),t._v(" "),a("li",[t._v("什么是"),a("code",[t._v("GitHub Actions")]),t._v("，"),a("code",[t._v("GitHub Actions")]),t._v("可以做什么")]),t._v(" "),a("li",[a("code",[t._v("GitHub Actions")]),t._v("如何自动化部署"),a("code",[t._v("Pages")])])]),t._v(" "),a("h2",{attrs:{id:"同步"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#同步"}},[t._v("#")]),t._v(" 同步")]),t._v(" "),a("h3",{attrs:{id:"维护多个远端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#维护多个远端"}},[t._v("#")]),t._v(" 维护多个远端")]),t._v(" "),a("p",[t._v("  查看当前仓库关联的远程库。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/other/git/mirror/current.png",alt:""}})]),t._v(" "),a("h4",{attrs:{id:"推送多次"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#推送多次"}},[t._v("#")]),t._v(" 推送多次")]),t._v(" "),a("p",[t._v("  删除"),a("code",[t._v("origin")]),t._v("，然后依次关联远程"),a("code",[t._v("GitHub")]),t._v("和"),a("code",[t._v("Gitee")]),t._v("仓库。")]),t._v(" "),a("p",[t._v("  本地关联的远程库名称大多数都是"),a("code",[t._v("origin")]),t._v("，此情况对于单个远端来说很适用。若关联有多个远端，名称最好还是要容易区分。")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("git remote rm origin\ngit remote add github https"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("github"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("xxx"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("repo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("git\ngit remote add gitee https"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("gitee"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("xxx"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("repo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("git\n")])])]),a("p",[t._v("  查看关联的远程库。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/other/git/mirror/v.png",alt:""}})]),t._v(" "),a("p",[t._v("  本地代码提交后，分别推送至两个远端。缺点也比较明显，即推送多次显得冗余。")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("git push github master\ngit push gitee master\n")])])]),a("h4",{attrs:{id:"添加-package-json-脚本命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加-package-json-脚本命令"}},[t._v("#")]),t._v(" 添加 package.json 脚本命令")]),t._v(" "),a("p",[t._v("  可在"),a("code",[t._v("package.json")]),t._v("中合并两个命令，推送时只运行"),a("code",[t._v("npm run push")]),t._v("即可。实际看似简化了输入，却添加了与项目无关的"),a("code",[t._v("scripts")]),t._v("命令。")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// package.json")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"scripts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"push"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"git push github master && git push gitee master"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h4",{attrs:{id:"修改-git-内部配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改-git-内部配置"}},[t._v("#")]),t._v(" 修改 Git 内部配置")]),t._v(" "),a("p",[t._v("  当前远端还是只有"),a("code",[t._v("origin")]),t._v("。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/other/git/mirror/current.png",alt:""}})]),t._v(" "),a("p",[t._v("  添加一条"),a("code",[t._v("push")]),t._v("的远端地址。")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("git remote set"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("url "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("add origin https"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("gitee"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("xxx"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("repo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("git\n")])])]),a("p",[t._v("  可以看到推送"),a("code",[t._v("push")]),t._v("的"),a("code",[t._v("url")]),t._v("多了一条。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/other/git/mirror/add.png",alt:""}})]),t._v(" "),a("p",[t._v("  因此"),a("code",[t._v("fetch")]),t._v("时将从"),a("code",[t._v("GitHub")]),t._v("拉取代码，"),a("code",[t._v("push")]),t._v("时将推送到"),a("code",[t._v("Gitee")]),t._v("和"),a("code",[t._v("GitHub")]),t._v("两个远端。此方式相对可用，但是无法做到部分的自动化功能，例如测试、部署等。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/other/git/mirror/push.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"gitee-同步按钮"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gitee-同步按钮"}},[t._v("#")]),t._v(" Gitee 同步按钮")]),t._v(" "),a("p",[t._v("  若仓库还未创建，可在头部选择导入仓库。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/other/git/mirror/header.png",alt:""}})]),t._v(" "),a("p",[t._v("  若仓库已存在，可在仓库主页的管理菜单的功能设置下配置地址。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/other/git/mirror/url.png",alt:""}})]),t._v(" "),a("p",[t._v("  两种方式都将在仓库主页创建同步按钮。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/other/git/mirror/btn.png",alt:""}})]),t._v(" "),a("p",[t._v("  注意强制同步将覆盖当前仓库。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/other/git/mirror/click.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"webhooks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webhooks"}},[t._v("#")]),t._v(" webhooks")]),t._v(" "),a("p",[t._v("  ;"),a("a",{attrs:{href:"https://docs.github.com/cn/developers/webhooks-and-events/webhooks/about-webhooks",target:"_blank",rel:"noopener noreferrer"}},[t._v("webhooks"),a("OutboundLink")],1),t._v(" 即"),a("code",[t._v("web")]),t._v("钩子，是一个可以接收"),a("code",[t._v("http/s")]),t._v("请求（多为"),a("code",[t._v("post")]),t._v("）的"),a("code",[t._v("URL")]),t._v("。大多数情况下都是客户端调用"),a("code",[t._v("api")]),t._v("获取服务端提供的数据。而在"),a("code",[t._v("webhooks")]),t._v("中，服务端则将在特定事件时调用"),a("code",[t._v("webhooks")]),t._v("钩子。")]),t._v(" "),a("p",[t._v("  ;"),a("code",[t._v("GitHub")]),t._v("也提供了"),a("code",[t._v("webhooks")]),t._v("，当用户向仓库"),a("code",[t._v("push")]),t._v("推送（不单单是推送事件）代码时，"),a("code",[t._v("GitHub")]),t._v("将向配置的"),a("code",[t._v("URL")]),t._v("发送"),a("code",[t._v("http/s")]),t._v("请求，可用于发邮件、自动部署、备份镜像等等。")]),t._v(" "),a("p",[t._v("  代码仓库可访问 "),a("a",{attrs:{href:"https://github.com/dongwei1125/mirror-repo.git",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("h4",{attrs:{id:"准备工作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备工作"}},[t._v("#")]),t._v(" 准备工作")]),t._v(" "),a("p",[t._v("  根据以上特性，搭建一个"),a("code",[t._v("express")]),t._v("服务器，目的用于启动一个用于同步代码的服务端"),a("code",[t._v("post")]),t._v("接口。")]),t._v(" "),a("p",[t._v("  目录结构如下，"),a("code",[t._v("app.js")]),t._v("为入口文件，"),a("code",[t._v("webhook-handler")]),t._v("用于提供同步代码的核心功能。")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("├── webhook"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("handler\n│   ├── index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js\n│   ├── mirror"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js\n│   ├── shell"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sh\n│   ├── webhook"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js\n├── app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js\n├── "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js\n├── "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("json\n├── "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n")])])]),a("p",[t._v("  ;"),a("code",[t._v("app.js")]),t._v("中引入"),a("code",[t._v("webhook-handler")]),t._v("处理函数，注意"),a("code",[t._v("GitHub")]),t._v("触发"),a("code",[t._v("webhooks")]),t._v("传递的是"),a("code",[t._v("json")]),t._v("格式的数据，要用到"),a("code",[t._v("express.json()")]),t._v("中间件，继续往下看。")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// app.js")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" handler "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./webhook-handler'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("express"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("json")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("post")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/mirror'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("handler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h4",{attrs:{id:"处理函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#处理函数"}},[t._v("#")]),t._v(" 处理函数")]),t._v(" "),a("p",[t._v("  当"),a("code",[t._v("GitHub")]),t._v("调用"),a("code",[t._v("mirror")]),t._v("接口时，会将用户预设的秘钥"),a("code",[t._v("secret")]),t._v("和参数体"),a("code",[t._v("json")]),t._v("进行加密，加密后的序列会携带在请求头"),a("code",[t._v("header")]),t._v("的 "),a("a",{attrs:{href:"https://docs.github.com/cn/developers/webhooks-and-events/webhooks/securing-your-webhooks#validating-payloads-from-github",target:"_blank",rel:"noopener noreferrer"}},[t._v("x-hub-signature"),a("OutboundLink")],1),t._v(" 中。")]),t._v(" "),a("p",[t._v("  工具类函数"),a("code",[t._v("encrypted")]),t._v("，主要用于进行"),a("code",[t._v("hmacsha1")]),t._v("算法加密，参数"),a("code",[t._v("secret")]),t._v("为秘钥，"),a("code",[t._v("sign")]),t._v("为被用于加密的数据。")]),t._v(" "),a("p",[t._v("  函数"),a("code",[t._v("isEqual")]),t._v("，用于对比两字符串是否一致，但是注意判断相等 "),a("a",{attrs:{href:"https://docs.github.com/cn/developers/webhooks-and-events/webhooks/securing-your-webhooks#validating-payloads-from-github",target:"_blank",rel:"noopener noreferrer"}},[t._v("不建议"),a("OutboundLink")],1),t._v(" 用"),a("code",[t._v("===")]),t._v("，而应该使用 "),a("a",{attrs:{href:"http://nodejs.cn/api/crypto.html#cryptotimingsafeequala-b",target:"_blank",rel:"noopener noreferrer"}},[t._v("恒定时间"),a("OutboundLink")],1),t._v(" 字符串比较，有助于提高服务端的安全性。")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// webhook-handler/index.js")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("handler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cb")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" sign "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'x-hub-signature'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" encrypted "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("encrypt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("GITHUB_WEBHOOK_SECRET")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("encrypt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("secret"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sign")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("sha1=")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("crypto"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createHmac")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sha1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" secret"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("update")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sign"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("digest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hex'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isEqual")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" other "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" other"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" crypto"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("timingSafeEqual")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Buffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("from")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Buffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("from")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("other"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("  思考一下，为什么"),a("code",[t._v("GitHub")]),t._v("会将用户预设的秘钥和参数体加密呢？")]),t._v(" "),a("p",[t._v("  秘钥加密可以理解，因为不能明文传递。")]),t._v(" "),a("p",[t._v("  以上提供的"),a("code",[t._v("post")]),t._v("接口，对于"),a("code",[t._v("GitHub")]),t._v("的任意仓库都能触发，别人的仓库是不是也可以呢。那么如何区分是否是我们的仓库触发了呢，秘钥就派上用场了。当服务端保存的静态秘钥与"),a("code",[t._v("GitHub")]),t._v("仓库预设的秘钥一致时，就能确定是我们的仓库了。")]),t._v(" "),a("h4",{attrs:{id:"同步代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#同步代码"}},[t._v("#")]),t._v(" 同步代码")]),t._v(" "),a("p",[t._v("  ;"),a("code",[t._v("mirror.js")]),t._v("用于启动子进程，运行"),a("code",[t._v("shell")]),t._v("脚本来同步代码。")]),t._v(" "),a("p",[t._v("  要明确的是，当我们向"),a("code",[t._v("https://github.com/xxx/repo.git")]),t._v("推送代码时，是无法登录验证权限的，而应当携带上用户名密码来推送，即推送到"),a("code",[t._v("https://"),a("strong",[t._v("username:password@")]),t._v("github.com/xxx/repo.git")]),t._v("。")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// webhook-handler/mirror.js")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" fullPath "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getFullPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DIST_REPO")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("GITEE_USERNAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("GITEE_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getFullPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" username"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" index "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("indexOf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'//'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" protocol "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("slice")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" index "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("slice")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("index "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("protocol"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("username"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("password"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("@")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("path"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("  ;"),a("code",[t._v("shell")]),t._v("脚本中，接收两个参数，分别为源仓库和目标仓库地址，注意"),a("code",[t._v("$1")]),t._v("和"),a("code",[t._v("$2")]),t._v("没有语义，可声明变量来保存。")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// webhook-handler/mirror.js")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" shPath "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'shell.sh'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" command "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("shPath"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v(" ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SRC_REPO")]),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v(" ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("fullPath"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// webhook-handler/shell.sh")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SRC_REPO")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("$1\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DIST_REPO")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("$2\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n")])])]),a("p",[t._v("  有必要解释下"),a("code",[t._v("shell.sh")]),t._v("脚本的工作流程。")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("mkdir _temp ...")]),t._v("：根目录下创建临时目录"),a("code",[t._v("_temp")]),t._v("，切换工作目录到"),a("code",[t._v("_temp")]),t._v("下")]),t._v(" "),a("li",[a("code",[t._v("git clone --mirror ...")]),t._v("：镜像克隆，完全复制源仓库（包括分支、引用等等）")]),t._v(" "),a("li",[a("code",[t._v("git remote set-url --push ...")]),t._v("：将当前副本仓库的推送源地址修改为目标仓库")]),t._v(" "),a("li",[a("code",[t._v("git push --mirror")]),t._v("：镜像推送，完全推送到目标仓库（包括分支、引用等等）")]),t._v(" "),a("li",[a("code",[t._v("cd ...")]),t._v("：切换到初始的目录，删除临时仓库"),a("code",[t._v("_temp")])])]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// webhook-handler/shell.sh")]),t._v("\nmkdir _temp "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" cd _temp\n\ngit clone "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("mirror "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$SRC_REPO"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" cd "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('basename "$SRC_REPO"')]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n\ngit remote set"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("url "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("push origin "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$DIST_REPO"')]),t._v("\n\ngit push "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("mirror\n\ncd "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" rm "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("rf _temp\n")])])]),a("h4",{attrs:{id:"github-添加-webhooks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#github-添加-webhooks"}},[t._v("#")]),t._v(" GitHub 添加 webhooks")]),t._v(" "),a("p",[t._v("  在"),a("code",[t._v("GitHub")]),t._v("仓库下，选中"),a("code",[t._v("Settings")]),t._v("功能的"),a("code",[t._v("Webhooks")]),t._v("菜单，单击"),a("code",[t._v("Add webhook")]),t._v("添加。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/other/git/mirror/webhooks.png",alt:""}})]),t._v(" "),a("p",[t._v("  输入你部署在服务器上的"),a("code",[t._v("post")]),t._v("接口，设置"),a("code",[t._v("Secret")]),t._v("秘钥，注意"),a("code",[t._v("Content type")]),t._v("选择为"),a("code",[t._v("json")]),t._v("，另外触发"),a("code",[t._v("webhook")]),t._v("的事件类型，默认只有推送事件，你也可以自定义选择。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/other/git/mirror/trigger.png",alt:""}})]),t._v(" "),a("p",[t._v("  当你的仓库发生以上勾选的事件时，"),a("code",[t._v("GitHub")]),t._v("就会自动帮你调用部署在服务器上的"),a("code",[t._v("mirror")]),t._v("接口，进而镜像同步你的仓库代码。")]),t._v(" "),a("p",[t._v("  ;"),a("code",[t._v("webhooks")]),t._v("的方式相对来说比较可行，但是缺点也很明显，一方面必须额外的服务器（有"),a("code",[t._v("node")]),t._v("环境且安装了"),a("code",[t._v("Git")]),t._v("）支持用来部署接口。另一方面，单个仓库同步还是很便捷，但是如果说多个仓库要镜像同步呢？")]),t._v(" "),a("p",[t._v("  那我们的处理函数就要去判断请求接口的"),a("code",[t._v("GitHub")]),t._v("仓库来源，同时每多同步一组仓库，就要在服务端新增一组源仓库和目标仓库的地址。")]),t._v(" "),a("blockquote",[a("p",[t._v("提供一个 "),a("a",{attrs:{href:"https://gitee.com/help/articles/4336#article-header0",target:"_blank",rel:"noopener noreferrer"}},[t._v("Gitee"),a("OutboundLink")],1),t._v(" 官方的"),a("code",[t._v("webhooks")]),t._v("，用于"),a("code",[t._v("Gitee")]),t._v("和"),a("code",[t._v("GitHub")]),t._v("双向同步的功能，但是注意目前尚处于内测期，只能 "),a("a",{attrs:{href:"https://gitee.com/gitee-community/mirror-repository",target:"_blank",rel:"noopener noreferrer"}},[t._v("申请"),a("OutboundLink")],1),t._v(" 开通")])]),t._v(" "),a("h3",{attrs:{id:"github-actions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#github-actions"}},[t._v("#")]),t._v(" GitHub Actions")]),t._v(" "),a("p",[t._v("  ;"),a("a",{attrs:{href:"https://docs.github.com/cn/actions/learn-github-actions/understanding-github-actions",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub Actions"),a("OutboundLink")],1),t._v(" 即是一个免费的虚拟机，提供了三种可选的操作系统（"),a("code",[t._v("Ubuntu Linux")]),t._v("、"),a("code",[t._v("Microsoft Windows")]),t._v("和"),a("code",[t._v("macOS")]),t._v("），用以执行用户自定义的工作流程。")]),t._v(" "),a("p",[t._v("  那么何为工作流程呢？就是一个以"),a("code",[t._v(".yml")]),t._v("为后缀的文件（"),a("code",[t._v("YAML")]),t._v("语法），注意此文件要放置在代码仓库中的目录"),a("code",[t._v(".github/workflows")]),t._v("下才会生效。")]),t._v(" "),a("blockquote",[a("p",[t._v("注意对于每个工作流程，"),a("code",[t._v("GitHub")]),t._v("都会在预先配置好的全新虚拟机中执行")])]),t._v(" "),a("h4",{attrs:{id:"hello-world"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hello-world"}},[t._v("#")]),t._v(" Hello world")]),t._v(" "),a("p",[t._v("  我们就用"),a("code",[t._v("GitHub Actions")]),t._v("打印"),a("code",[t._v("Hello world")]),t._v("试试，不用太过复杂的例子。")]),t._v(" "),a("p",[t._v("  在"),a("code",[t._v("GitHub")]),t._v("仓库上选中"),a("code",[t._v("Actions")]),t._v("，单击"),a("code",[t._v("set up a workflow yourself")]),t._v("创建工作流程。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/other/git/mirror/setup.png",alt:""}})]),t._v(" "),a("p",[t._v("  然后在代码编辑器粘贴以下代码，以下为相关命令的含义，更多可 "),a("a",{attrs:{href:"https://docs.github.com/cn/actions/using-workflows/workflow-syntax-for-github-actions",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("name: ...")]),t._v("：工作流程的名称为"),a("code",[t._v("Console hello world")])]),t._v(" "),a("li",[a("code",[t._v("on: ...")]),t._v("：仓库发生推送"),a("code",[t._v("push")]),t._v("事件时执行")]),t._v(" "),a("li",[a("code",[t._v("jobs")]),t._v("：表示执行的一项或多项任务，当前仅有一个任务"),a("code",[t._v("console")])]),t._v(" "),a("li",[a("code",[t._v("console")]),t._v("：任务名为"),a("code",[t._v("console")])]),t._v(" "),a("li",[a("code",[t._v("runs-on ...")]),t._v("：任务"),a("code",[t._v("console")]),t._v("运行的虚拟机为最新的"),a("code",[t._v("Ubuntu Linux")]),t._v("环境")]),t._v(" "),a("li",[a("code",[t._v("steps")]),t._v("：任务"),a("code",[t._v("console")]),t._v("的运行步骤，当前仅有一个步骤")]),t._v(" "),a("li",[a("code",[t._v("- run ...")]),t._v("：运行命令"),a("code",[t._v("echo Hello world")])])]),t._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# .github/gitflows/main.yml")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Console hello world\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" push\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jobs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("console")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runs-on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ubuntu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" echo Hello world\n")])])]),a("p",[t._v("  点击"),a("code",[t._v("Start Commit")]),t._v("然后"),a("code",[t._v("Commit new file")]),t._v("提交。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/other/git/mirror/edit.png",alt:""}})]),t._v(" "),a("p",[t._v("  仓库目录下将生成"),a("code",[t._v("main.yml")]),t._v("文件，另外会创建一次提交记录"),a("code",[t._v("Create main.yml")]),t._v("。")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("├── "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("github\n│   ├── workflows\n│   │   ├── main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("yml\n├── "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n")])])]),a("p",[t._v("  由于代码是在"),a("code",[t._v("GitHub")]),t._v("上提交的，相当于是本地代码推送"),a("code",[t._v("push")]),t._v("了一次，而脚本的执行条件就是"),a("code",[t._v("push")]),t._v("事件的发生，因此"),a("code",[t._v("GitHub Actions")]),t._v("将会触发。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/other/git/mirror/all.png",alt:""}})]),t._v(" "),a("p",[t._v("  单击"),a("code",[t._v("Create main.yml")]),t._v("查看此次推送执行的工作流程，成功在虚拟机下打印出"),a("code",[t._v("Hello world")]),t._v("。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/other/git/mirror/console.png",alt:""}})]),t._v(" "),a("h4",{attrs:{id:"准备工作-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备工作-2"}},[t._v("#")]),t._v(" 准备工作")]),t._v(" "),a("p",[t._v("  先要保证本机环境有"),a("code",[t._v("Git")]),t._v("公钥和私钥。")]),t._v(" "),a("p",[t._v("  然后在"),a("code",[t._v("Gitee")]),t._v("用户"),a("code",[t._v("SSH")]),t._v("公钥中，添加标题并粘贴公钥保存。\n"),a("img",{attrs:{src:"/other/git/mirror/ssh.png",alt:""}})]),t._v(" "),a("p",[t._v("  然后在"),a("code",[t._v("GitHub")]),t._v("的仓库"),a("code",[t._v("repo")]),t._v("下，"),a("code",[t._v("Settings")]),t._v("功能选择"),a("code",[t._v("Actions")]),t._v("，单击"),a("code",[t._v("New repository secret")]),t._v("添加秘钥。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/other/git/mirror/secrets.png",alt:""}})]),t._v(" "),a("p",[t._v("  呐，粘贴你的私钥，准备工作就完成了。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/other/git/mirror/finish.png",alt:""}})]),t._v(" "),a("h4",{attrs:{id:"添加脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加脚本"}},[t._v("#")]),t._v(" 添加脚本")]),t._v(" "),a("p",[t._v("  修改"),a("code",[t._v(".github/workflow/main.yml")]),t._v("。")]),t._v(" "),a("p",[t._v("  根据刚才"),a("code",[t._v("Hello world")]),t._v("的例子，很容易知道当前工作流程的名称为"),a("code",[t._v("Mirror to Gitee repo")]),t._v("，仓库在推送"),a("code",[t._v("push")]),t._v("代码、删除"),a("code",[t._v("delete")]),t._v("分支或者创建"),a("code",[t._v("create")]),t._v("分支时，将执行此脚本。")]),t._v(" "),a("p",[t._v("  脚本包含一个任务，名为"),a("code",[t._v("mirror")]),t._v("，运行的虚拟机为最新的"),a("code",[t._v("Ubuntu Linux")]),t._v("环境。而此任务下又包含两个名为"),a("code",[t._v("Config private key")]),t._v("和"),a("code",[t._v("Clone repo and push")]),t._v("的步骤。")]),t._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# .github/gitflows/main.yml")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Mirror to Gitee repo\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" push"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" delete"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" create "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jobs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mirror")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runs-on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ubuntu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Config private key\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("SSH_PRIVATE_KEY")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.GITEE_PRIVATE_KEY "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v('\n          mkdir -p ~/.ssh\n          echo "$SSH_PRIVATE_KEY" > ~/.ssh/id_rsa\n          chmod 600 ~/.ssh/id_rsa\n          echo "StrictHostKeyChecking no" >> ~/.ssh/config')]),t._v("\n\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Clone repo and push\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("SRC_REPO")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://github.com/xxx/repo.git"')]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("DIST_REPO")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"git@gitee.com:xxx/repo.git"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v('\n          git clone --mirror "$SRC_REPO"\n          cd `basename "$SRC_REPO"`\n          git remote set-url --push origin "$DIST_REPO"\n          git push --mirror')]),t._v("\n")])])]),a("p",[t._v("  ;"),a("code",[t._v("Config private key")]),t._v("用于在虚拟机的用户目录中写入私钥。"),a("code",[t._v("env")]),t._v("下有环境变量"),a("code",[t._v("SSH_PRIVATE_KEY")]),t._v("，变量值由 "),a("a",{attrs:{href:"https://docs.github.com/cn/actions/learn-github-actions/contexts#secrets-context",target:"_blank",rel:"noopener noreferrer"}},[t._v("secrets"),a("OutboundLink")],1),t._v(" 上下文获取而来。")]),t._v(" "),a("p",[t._v("  有没有觉得"),a("code",[t._v("GITEE_PRIVATE_KEY")]),t._v("很眼熟呢？没错，就是刚才保存在仓库目录下的私钥。")]),t._v(" "),a("p",[t._v("  当用户向诸如"),a("code",[t._v("git@github.com:xxx/xx.git")]),t._v("的仓库推送代码时，遵循"),a("code",[t._v("SSH")]),t._v("传输协议。在推送前，"),a("code",[t._v("Git")]),t._v("将提交用户根目录下的私钥"),a("code",[t._v("id_rsa")]),t._v("到远端，远端则会将私钥和公钥（"),a("code",[t._v("GitHub")]),t._v("或者"),a("code",[t._v("Gitee")]),t._v("用户在服务端添加的公钥"),a("code",[t._v("id_rsa.pub")]),t._v("）对一起做验证，判别此私钥是否有推送权限。")]),t._v(" "),a("p",[t._v("  而我们已经将公钥保存在了"),a("code",[t._v("Gitee")]),t._v("远端服务器上，私钥保存在"),a("code",[t._v("GitHub")]),t._v("仓库内的"),a("code",[t._v("GITEE_PRIVATE_KEY")]),t._v("上，"),a("code",[t._v("GitHub")]),t._v("平台会将私钥传递在"),a("code",[t._v("yml")]),t._v("脚本中的"),a("code",[t._v("secrets")]),t._v("上下文内，然后脚本获取后，将其写在了虚拟机的用户根目录下。此时虚拟机要推送的话，它当然是有权限的。")]),t._v(" "),a("p",[t._v("  还是不太清楚的话，可以理解为。依托"),a("code",[t._v("GitHub")]),t._v("平台和"),a("code",[t._v("yml")]),t._v("脚本，我们本机的私钥将会被复制成为虚拟机的私钥。")]),t._v(" "),a("p",[t._v("  以下为"),a("code",[t._v("Config private key")]),t._v("写入私钥的过程。")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("mkdir -p ...")]),t._v("：虚拟机根目录下创建"),a("code",[t._v(".ssh")]),t._v("文件夹。"),a("code",[t._v("-p")]),t._v("表示即使上级目录不存在，也要按目录层级自动创建")]),t._v(" "),a("li",[a("code",[t._v("echo ...")]),t._v("：将私钥写入"),a("code",[t._v(".ssh")]),t._v("文件夹下的"),a("code",[t._v("id_rsa")]),t._v("文件中")]),t._v(" "),a("li",[a("code",[t._v("chmod ...")]),t._v("：修改"),a("code",[t._v("id_rsa")]),t._v("的权限为"),a("code",[t._v("600")]),t._v("（仅所有者可读写）")])]),t._v(" "),a("p",[t._v("  创建的"),a("code",[t._v("id_rsa")]),t._v("的访问权限"),a("code",[t._v("0644")]),t._v("过于开放，"),a("code",[t._v("Git")]),t._v("要求私钥文件不能被其他人访问。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/other/git/mirror/600.png",alt:""}})]),t._v(" "),a("ul",[a("li",[a("code",[t._v("echo ...")]),t._v("：关闭初次连接服务器时的提示")])]),t._v(" "),a("p",[t._v("  当第一次连接服务器时，例如"),a("code",[t._v("push")]),t._v("提交，"),a("code",[t._v("Git")]),t._v("将弹出公钥确认的提示，将导致自动化任务中断。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/other/git/mirror/host.png",alt:""}})]),t._v(" "),a("h4",{attrs:{id:"同步代码-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#同步代码-2"}},[t._v("#")]),t._v(" 同步代码")]),t._v(" "),a("p",[t._v("  当我们向"),a("code",[t._v("GitHub")]),t._v("仓库推送代码时，"),a("code",[t._v("GitHub Actions")]),t._v("将自动运行仓库下的"),a("code",[t._v("yml")]),t._v("脚本。若任务和任务下的步骤都通过，则表示执行成功。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/other/git/mirror/success.png",alt:""}})]),t._v(" "),a("h4",{attrs:{id:"actions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#actions"}},[t._v("#")]),t._v(" actions")]),t._v(" "),a("p",[t._v("  现在来思考一个问题，如果要同步另外的"),a("code",[t._v("GitHub")]),t._v("仓库到"),a("code",[t._v("Gitee")]),t._v("呢？")]),t._v(" "),a("p",[t._v("  那么我们是不要复制以上代码，修改源和目的仓库地址呢？可以明确告诉你，不用。")]),t._v(" "),a("p",[t._v("  ;"),a("code",[t._v("GitHub")]),t._v("想到了一个很好的办法，开发者可以发布不同的工作流程到 "),a("a",{attrs:{href:"https://github.com/marketplace?type=actions",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方市场"),a("OutboundLink")],1),t._v("，而用户可以引用别人的"),a("code",[t._v("actions")]),t._v("即可。同步"),a("code",[t._v("GitHub")]),t._v("仓库到"),a("code",[t._v("Gitee")]),t._v("的功能，很早就有团队写好发布了，缺陷相对也很少。刚才讲那么多命令，只是为了更好地帮助你理解"),a("code",[t._v("GitHub Actions")]),t._v("的工作原理。")]),t._v(" "),a("p",[t._v("  以下为 "),a("a",{attrs:{href:"https://github.com/marketplace/actions/hub-mirror-action",target:"_blank",rel:"noopener noreferrer"}},[t._v("hub-mirror-action"),a("OutboundLink")],1),t._v(" 配置参数。")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("src")]),t._v("：源平台账户名")]),t._v(" "),a("li",[a("code",[t._v("dst")]),t._v("：目标平台账户名")]),t._v(" "),a("li",[a("code",[t._v("dst_key")]),t._v("：源仓库下保存的私钥")]),t._v(" "),a("li",[a("code",[t._v("static_list")]),t._v("：仅同步指定的仓库")]),t._v(" "),a("li",[a("code",[t._v("force_update")]),t._v("：强制同步")])]),t._v(" "),a("blockquote",[a("p",[a("code",[t._v("hub-mirror-action")]),t._v("远远不止同步单个仓库，它可以将两个平台下的所有仓库都同步")])]),t._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# .github/gitflows/main.yml")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Mirror to Gitee repo\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" push"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" delete"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" create "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jobs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mirror")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runs-on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ubuntu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Yikun/hub"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("mirror"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("action@v1.2\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" github/username\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dst")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" gitee/username\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dst_key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.GITEE_PRIVATE_KEY "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("static_list")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'repo'")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("force_update")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])]),a("h2",{attrs:{id:"常见问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常见问题"}},[t._v("#")]),t._v(" 常见问题")]),t._v(" "),a("h3",{attrs:{id:"github-actions-如何自动化部署-pages"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#github-actions-如何自动化部署-pages"}},[t._v("#")]),t._v(" GitHub Actions 如何自动化部署 Pages")]),t._v(" "),a("p",[t._v("  一个很常见的场景，当我们将本地仓库代码推送至远端"),a("code",[t._v("GitHub")]),t._v("仓库时，要同步代码到"),a("code",[t._v("Gitee")]),t._v("，并且自动部署"),a("code",[t._v("GitHub")]),t._v("和"),a("code",[t._v("Gitee")]),t._v("的"),a("code",[t._v("Pages")]),t._v("。")]),t._v(" "),a("p",[t._v("  此处用"),a("code",[t._v("vuecli3")]),t._v("脚手架作为示例，运行"),a("code",[t._v("vue create app")]),t._v("安装"),a("code",[t._v("vue")]),t._v("空脚手架，然后修改"),a("code",[t._v("vue.config.js")]),t._v("中的生产路径。")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// vue.config.js")]),t._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("publicPath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("  根目录"),a("code",[t._v("app")]),t._v("下目录结构，"),a("code",[t._v("main.yml")]),t._v("用于部署"),a("code",[t._v("Pages")]),t._v("。")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("├── "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("github\n│   ├── workflows\n│   │   ├── main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("yml\n├── node_modules\n├── src\n│   ├── App"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("vue\n│   ├── main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js\n│   ├── "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n├── "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n├── vue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js\n")])])]),a("p",[t._v("  部署"),a("code",[t._v("GitHub Pages")]),t._v("相对容易，"),a("code",[t._v("GitHub Pages")]),t._v("关联的分支有更新时将自动部署。")]),t._v(" "),a("p",[t._v("  而"),a("code",[t._v("Gitee Pages")]),t._v("相对麻烦，只能手动更新部署。第三方"),a("code",[t._v("gitee-pages-action")]),t._v("内部实际是利用"),a("code",[t._v("Gitee")]),t._v("用户名和密码登录至平台，调用更新接口的方式来实现的自动部署。")]),t._v(" "),a("p",[t._v("  以下为各个"),a("code",[t._v("actions")]),t._v("的功能及参数的作用。")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/marketplace/actions/checkout",target:"_blank",rel:"noopener noreferrer"}},[t._v("checkout"),a("OutboundLink")],1),t._v("：检出当前仓库。你可以想象成在虚拟机内克隆了当前仓库，然后就可以运行"),a("code",[t._v("package.json")]),t._v("中的"),a("code",[t._v("scripts")]),t._v("命令，例如"),a("code",[t._v("npm run build")]),t._v("等。")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/marketplace/actions/setup-node-js-environment",target:"_blank",rel:"noopener noreferrer"}},[t._v("setup-node"),a("OutboundLink")],1),t._v("：虚拟机安装"),a("code",[t._v("node")]),t._v("环境。其中"),a("code",[t._v("node-version")]),t._v("用于指定"),a("code",[t._v("node")]),t._v("版本")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/marketplace/actions/github-pages-action",target:"_blank",rel:"noopener noreferrer"}},[t._v("actions-gh-pages"),a("OutboundLink")],1),t._v("：部署"),a("code",[t._v("GitHub Pages")]),t._v("页面。将"),a("code",[t._v("npm run build")]),t._v("命令构建出的"),a("code",[t._v("dist")]),t._v("目录，创建为新分支"),a("code",[t._v("page")]),t._v("用于部署。"),a("code",[t._v("force_orphan")]),t._v("表示"),a("code",[t._v("page")]),t._v("分支只生成一次提交记录，"),a("code",[t._v("full_commit_message")]),t._v("为提交说明，"),a("code",[t._v("allow_empty_commit")]),t._v("表示即使"),a("code",[t._v("dist")]),t._v("文件没有更新，也要重新提交")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/marketplace/actions/hub-mirror-action",target:"_blank",rel:"noopener noreferrer"}},[t._v("hub-mirror-action"),a("OutboundLink")],1),t._v("：镜像同步仓库")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/marketplace/actions/gitee-pages-action",target:"_blank",rel:"noopener noreferrer"}},[t._v("gitee-pages-action"),a("OutboundLink")],1),t._v("：部署"),a("code",[t._v("Gitee Pages")]),t._v("页面。其中"),a("code",[t._v("GITEE_PASSWORD")]),t._v("为"),a("code",[t._v("GitHub")]),t._v("仓库下添加的"),a("code",[t._v("Gitee")]),t._v("平台密码，"),a("code",[t._v("gitee-repo")]),t._v("和"),a("code",[t._v("branch")]),t._v("表示对"),a("code",[t._v("Gitee")]),t._v("下的"),a("code",[t._v("repo")]),t._v("仓库的"),a("code",[t._v("page")]),t._v("分支进行部署")])]),t._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# .github/gitflows/main.yml")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Mirror to Gitee repo and deploy pages\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("push")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("branches")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" master\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jobs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("deploy-github")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runs-on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ubuntu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/checkout@v3\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Setup node\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/setup"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node@v3\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("node-version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'16.14.0'")]),t._v("\n\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Depend install and build\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v("\n          npm install\n          npm run build")]),t._v("\n\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deploy GitHub pages\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" peaceiris/actions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("gh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pages@v3\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("deploy_key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.GITEE_PRIVATE_KEY "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("publish_branch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" page\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("publish_dir")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" dist\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("allow_empty_commit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("force_orphan")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("full_commit_message")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'feat: deploy pages'")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("deploy-gitee")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("needs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" deploy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("github\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runs-on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ubuntu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Mirror to Gitee repo\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Yikun/hub"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("mirror"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("action@v1.2\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" github/username\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dst")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" gitee/username\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dst_key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.GITEE_PRIVATE_KEY "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("static_list")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'repo'")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("force_update")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deploy Gitee pages\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" yanglbme/gitee"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pages"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("action@v1.4.0\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gitee-username")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" username\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gitee-password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.GITEE_PASSWORD "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gitee-repo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" repo\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("branch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" page\n")])])]),a("p",[t._v("  因此"),a("code",[t._v("main.yml")]),t._v("脚本的工作流程也非常清晰了，任务"),a("code",[t._v("deploy-github")]),t._v("用于检出仓库后构建代码，部署至"),a("code",[t._v("GitHub")]),t._v("对应仓库的"),a("code",[t._v("page")]),t._v("分支。任务"),a("code",[t._v("deploy-gitee")]),t._v("用于同步"),a("code",[t._v("GitHub")]),t._v("仓库至"),a("code",[t._v("Gitee")]),t._v("，然后在"),a("code",[t._v("Gitee")]),t._v("平台，对仓库的"),a("code",[t._v("page")]),t._v("分支再单独部署。")]),t._v(" "),a("p",[t._v("  注意任务"),a("code",[t._v("deploy-gitee")]),t._v("一定是在"),a("code",[t._v("deploy-github")]),t._v("后运行的，否则仓库同步将无法达到预期。"),a("a",{attrs:{href:"https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idneeds",target:"_blank",rel:"noopener noreferrer"}},[t._v("needs"),a("OutboundLink")],1),t._v(" 表示当前任务要等待指定任务完成后才能执行。")]),t._v(" "),a("h3",{attrs:{id:"vuepress-如何多仓库同步和部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vuepress-如何多仓库同步和部署"}},[t._v("#")]),t._v(" VuePress 如何多仓库同步和部署")]),t._v(" "),a("p",[t._v("  ;"),a("a",{attrs:{href:"https://vuepress.vuejs.org/zh/",target:"_blank",rel:"noopener noreferrer"}},[t._v("VuePress"),a("OutboundLink")],1),t._v(" 也有仓库的同步和部署"),a("code",[t._v("Pages")]),t._v("的场景，但是相对来说有很大的差异性，主要原因在于部署"),a("code",[t._v("Pages")]),t._v("的代码位于另外的仓库下，而不是当前仓库的"),a("code",[t._v("page")]),t._v("分支。")]),t._v(" "),a("h4",{attrs:{id:"准备工作-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备工作-3"}},[t._v("#")]),t._v(" 准备工作")]),t._v(" "),a("p",[t._v("  你的"),a("code",[t._v("GitHub")]),t._v("应该包括两个仓库，一个用于保存"),a("code",[t._v("VuePress")]),t._v("的源码，一个用于静态博客，保存"),a("code",[t._v("VuePress")]),t._v("打包后的代码，另外"),a("code",[t._v("Gitee")]),t._v("仓库也是同理。")]),t._v(" "),a("p",[t._v("  可能你会问，用一个命名分支（例如"),a("code",[t._v("page")]),t._v("）保存打包后的代码，在部署页面时选择此分支不是更好，还能节省一个仓库。")]),t._v(" "),a("p",[t._v("  为什么会这样做呢？")]),t._v(" "),a("p",[t._v("  在"),a("code",[t._v("Gitee")]),t._v("平台中，如果你的用户名为"),a("code",[t._v("username")]),t._v("，当你的仓库名和用户名一致时，就会触发一个 "),a("a",{attrs:{href:"https://gitee.com/help/articles/4136#article-header0",target:"_blank",rel:"noopener noreferrer"}},[t._v("隐藏特性"),a("OutboundLink")],1),t._v("，即访问地址"),a("code",[t._v("https://username.gitee.io")]),t._v("，就能访问你部署在"),a("code",[t._v("username")]),t._v("仓库的静态页面。")]),t._v(" "),a("blockquote",[a("p",[t._v("一般的"),a("code",[t._v("Gitee")]),t._v("仓库，部署为静态"),a("code",[t._v("Pages")]),t._v("后，访问地址都为二级目录。例如"),a("code",[t._v("repo")]),t._v("仓库，部署后的地址为"),a("code",[t._v("http://username.gitee.io/repo")])])]),t._v(" "),a("p",[t._v("  而在"),a("code",[t._v("GitHub")]),t._v("平台中，如果你的用户名为"),a("code",[t._v("username")]),t._v("，当你的仓库名为"),a("code",[t._v("username.github.io")]),t._v("时，也会触发一个隐藏特性，即访问地址"),a("code",[t._v("https://username.github.io")]),t._v("，就能访问部署在"),a("code",[t._v("username.github.io")]),t._v("仓库的静态页面，否则也会是二级目录的形式。")]),t._v(" "),a("blockquote",[a("p",[a("code",[t._v("GitHub")]),t._v("平台，用户名和仓库名一致时，还会有另外的隐藏特性")])]),t._v(" "),a("p",[t._v("  为什么会创建两个仓库，而不是以分支的方式就不用我多说了吧。为了触发平台的隐藏特性，让你的个人主页地址更加简洁，容易记忆。")]),t._v(" "),a("p",[t._v("  因此我们实际要有四个仓库，"),a("code",[t._v("Gitee")]),t._v("平台的"),a("code",[t._v("vuepress")]),t._v("和"),a("code",[t._v("username")]),t._v("仓库，"),a("code",[t._v("GitHub")]),t._v("的"),a("code",[t._v("vuepress")]),t._v("和"),a("code",[t._v("username.github.io")]),t._v("仓库。")]),t._v(" "),a("h4",{attrs:{id:"添加脚本-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加脚本-2"}},[t._v("#")]),t._v(" 添加脚本")]),t._v(" "),a("p",[t._v("  默认你的目录结构为以下，其中"),a("code",[t._v("deploy-pages.yml")]),t._v("用于部署"),a("code",[t._v("Pages")]),t._v("，"),a("code",[t._v("mirror-repo.yml")]),t._v("用于同步"),a("code",[t._v("VuePress")]),t._v("源码仓库。")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("├── "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("github\n│   ├── workflows\n│   │   ├── deploy"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("pages"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("yml\n│   │   ├── mirror"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("repo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("yml\n├── node_modules\n├── docs\n│   ├── "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("vuepress\n│   │   ├── config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js\n│   ├── "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("README")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("md\n├── "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("json\n├── "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("gitignore\n")])])]),a("p",[t._v("  ;"),a("code",[t._v("package.json")]),t._v("添加"),a("code",[t._v("scripts")]),t._v("命令。")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// package.json")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"scripts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"dev"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vuepress dev docs --temp .temp"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"build"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vuepress build docs"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("  然后新增"),a("code",[t._v("mirror-repo.yml")]),t._v("脚本，作用很简单，即将"),a("code",[t._v("Github")]),t._v("平台用户"),a("code",[t._v("username")]),t._v("的仓库"),a("code",[t._v("vuepress")]),t._v("，强制同步到"),a("code",[t._v("Gitee")]),t._v("平台用户"),a("code",[t._v("username")]),t._v("的仓库"),a("code",[t._v("vuepress")]),t._v("。")]),t._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# .github/workflows/mirror-repo.yml")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Mirror to Gitee repo\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("push")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("branches")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" master\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jobs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mirror")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runs-on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ubuntu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Yikun/hub"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("mirror"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("action@v1.2\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" github/username\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dst")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" gitee/username\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dst_key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.GITEE_PRIVATE_KEY "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("static_list")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vuepress'")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("force_update")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])]),a("p",[t._v("  最后新增"),a("code",[t._v("deploy-pages.yml")]),t._v("脚本，以下为各步骤作用。")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("Setup node")]),t._v("：签出当前仓库并安装"),a("code",[t._v("node")]),t._v("环境")]),t._v(" "),a("li",[a("code",[t._v("Depend install and build")]),t._v("：安装依赖并打包代码")]),t._v(" "),a("li",[a("code",[t._v("Deploy GitHub pages")]),t._v("：将打包后的代码（位于"),a("code",[t._v("docs/.vuepress/dist")]),t._v("目录下），推送到用户"),a("code",[t._v("username")]),t._v("的"),a("code",[t._v("username.github.io")]),t._v("仓库")]),t._v(" "),a("li",[a("code",[t._v("Mirror to Gitee repo")]),t._v("：同步"),a("code",[t._v("GitHub")]),t._v("平台的仓库"),a("code",[t._v("username.github.io")]),t._v("代码，至"),a("code",[t._v("Gitee")]),t._v("平台的"),a("code",[t._v("username")]),t._v("仓库。其中"),a("code",[t._v("mappings")]),t._v("参数表示仓库名不同时的映射")]),t._v(" "),a("li",[a("code",[t._v("Deploy Gitee pages")]),t._v("：将"),a("code",[t._v("Gitee")]),t._v("平台的用户"),a("code",[t._v("username")]),t._v("下的"),a("code",[t._v("username")]),t._v("仓库，其中的"),a("code",[t._v("master")]),t._v("分支代码部署为"),a("code",[t._v("Pages")])])]),t._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# .github/workflows/mirror-repo.yml")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deploy pages\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("push")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("branches")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" master\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jobs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("deploy-github")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runs-on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ubuntu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/checkout@v3\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Setup node\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/setup"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("node@v3\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("node-version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'16.14.0'")]),t._v("\n\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Depend install and build\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v("\n          npm install\n          npm run build")]),t._v("\n          \n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deploy GitHub pages\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" peaceiris/actions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("gh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pages@v3\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("deploy_key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.GITEE_PRIVATE_KEY "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("external_repository")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" username/username.github.io\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("publish_branch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" master\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("publish_dir")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" docs/.vuepress/dist\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("allow_empty_commit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("force_orphan")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("full_commit_message")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'feat: deploy pages'")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("deploy-gitee")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("needs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" deploy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("github\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runs-on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ubuntu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Mirror to Gitee repo\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Yikun/hub"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("mirror"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("action@v1.2\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" github/username\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dst")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" gitee/username\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dst_key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.GITEE_PRIVATE_KEY "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mappings")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"username.github.io=>username"')]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("static_list")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'username.github.io'")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("force_update")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deploy Gitee pages\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" yanglbme/gitee"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pages"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("action@v1.4.0\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gitee-username")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" username\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gitee-password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.GITEE_PASSWORD "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gitee-repo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" username\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("branch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" master\n")])])]),a("h2",{attrs:{id:"🎉-写在最后"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#🎉-写在最后"}},[t._v("#")]),t._v(" 🎉 写在最后")]),t._v(" "),a("p",[t._v("🍻伙伴们，如果你已经看到了这里，觉得这篇文章有帮助到你的话不妨点赞👍或 "),a("a",{attrs:{href:"https://github.com/dongwei1125/blog",target:"_blank",rel:"noopener noreferrer"}},[t._v("Star"),a("OutboundLink")],1),t._v(" ✨支持一下哦！")]),t._v(" "),a("p",[t._v("手动码字，如有错误，欢迎在评论区指正💬~")]),t._v(" "),a("p",[t._v("你的支持就是我更新的最大动力💪~")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/dongwei1125",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub"),a("OutboundLink")],1),t._v(" / "),a("a",{attrs:{href:"https://gitee.com/dongwei1125",target:"_blank",rel:"noopener noreferrer"}},[t._v("Gitee"),a("OutboundLink")],1),t._v("、"),a("a",{attrs:{href:"https://dongwei1125.github.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub Pages"),a("OutboundLink")],1),t._v("、"),a("a",{attrs:{href:"https://juejin.cn/user/2621689331987783",target:"_blank",rel:"noopener noreferrer"}},[t._v("掘金"),a("OutboundLink")],1),t._v("、"),a("a",{attrs:{href:"https://blog.csdn.net/Don_GW",target:"_blank",rel:"noopener noreferrer"}},[t._v("CSDN"),a("OutboundLink")],1),t._v(" 同步更新，欢迎关注😉~")])])}),[],!1,null,null,null);s.default=n.exports}}]);