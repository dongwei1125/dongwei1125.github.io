<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>è§£æå›¾ç‰‡çš„ç€‘å¸ƒæµï¼ˆå«æ‡’åŠ è½½ï¼‰åŸç†ï¼Œå¹¶æ­é…æœåŠ¡ç«¯äº¤äº’æ•°æ® | DonV</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/header.jpg">
    <meta name="description" content="A paper about JavaScript, HTML and CSS.">
    
    <link rel="preload" href="/assets/css/0.styles.87611319.css" as="style"><link rel="preload" href="/assets/js/app.0aa97f73.js" as="script"><link rel="preload" href="/assets/js/2.f850a8ef.js" as="script"><link rel="preload" href="/assets/js/55.937bfe09.js" as="script"><link rel="prefetch" href="/assets/js/10.cb041c1b.js"><link rel="prefetch" href="/assets/js/11.1aadbcee.js"><link rel="prefetch" href="/assets/js/12.77cc8e56.js"><link rel="prefetch" href="/assets/js/13.7e8162d9.js"><link rel="prefetch" href="/assets/js/14.dea6ba67.js"><link rel="prefetch" href="/assets/js/15.a786d687.js"><link rel="prefetch" href="/assets/js/16.163edf25.js"><link rel="prefetch" href="/assets/js/17.3a0232cb.js"><link rel="prefetch" href="/assets/js/18.91bd2dd7.js"><link rel="prefetch" href="/assets/js/19.a36993f8.js"><link rel="prefetch" href="/assets/js/20.30dd9f79.js"><link rel="prefetch" href="/assets/js/21.5e3c83a3.js"><link rel="prefetch" href="/assets/js/22.88d5e321.js"><link rel="prefetch" href="/assets/js/23.b54a65a7.js"><link rel="prefetch" href="/assets/js/24.51df379f.js"><link rel="prefetch" href="/assets/js/25.79342bd2.js"><link rel="prefetch" href="/assets/js/26.643d5441.js"><link rel="prefetch" href="/assets/js/27.54b7d7b4.js"><link rel="prefetch" href="/assets/js/28.d01a4aee.js"><link rel="prefetch" href="/assets/js/29.7d932073.js"><link rel="prefetch" href="/assets/js/3.31ebf682.js"><link rel="prefetch" href="/assets/js/30.4c2f5636.js"><link rel="prefetch" href="/assets/js/31.b00c42d5.js"><link rel="prefetch" href="/assets/js/32.e9a0f488.js"><link rel="prefetch" href="/assets/js/33.f510b5fd.js"><link rel="prefetch" href="/assets/js/34.6e78f32f.js"><link rel="prefetch" href="/assets/js/35.04d666a2.js"><link rel="prefetch" href="/assets/js/36.900a3beb.js"><link rel="prefetch" href="/assets/js/37.19ddf8d7.js"><link rel="prefetch" href="/assets/js/38.35f899bd.js"><link rel="prefetch" href="/assets/js/39.fe9ea525.js"><link rel="prefetch" href="/assets/js/4.3c7083a8.js"><link rel="prefetch" href="/assets/js/40.0d116ce0.js"><link rel="prefetch" href="/assets/js/41.6cdce4cf.js"><link rel="prefetch" href="/assets/js/42.ab0bd0d5.js"><link rel="prefetch" href="/assets/js/43.66c8f8eb.js"><link rel="prefetch" href="/assets/js/44.ac02981e.js"><link rel="prefetch" href="/assets/js/45.479814b0.js"><link rel="prefetch" href="/assets/js/46.29956259.js"><link rel="prefetch" href="/assets/js/47.a89cf7d2.js"><link rel="prefetch" href="/assets/js/48.859e3502.js"><link rel="prefetch" href="/assets/js/49.d0fa0b25.js"><link rel="prefetch" href="/assets/js/5.206809f3.js"><link rel="prefetch" href="/assets/js/50.d051084c.js"><link rel="prefetch" href="/assets/js/51.fa831e6a.js"><link rel="prefetch" href="/assets/js/52.3ed98760.js"><link rel="prefetch" href="/assets/js/53.016b1c3c.js"><link rel="prefetch" href="/assets/js/54.c88e06c5.js"><link rel="prefetch" href="/assets/js/56.03003660.js"><link rel="prefetch" href="/assets/js/57.8bcda68a.js"><link rel="prefetch" href="/assets/js/58.286692ba.js"><link rel="prefetch" href="/assets/js/59.fbfe98aa.js"><link rel="prefetch" href="/assets/js/6.6f9d9bda.js"><link rel="prefetch" href="/assets/js/60.0975844e.js"><link rel="prefetch" href="/assets/js/61.0af6cf48.js"><link rel="prefetch" href="/assets/js/62.66c23699.js"><link rel="prefetch" href="/assets/js/63.7fda9b3f.js"><link rel="prefetch" href="/assets/js/7.6f64fba1.js"><link rel="prefetch" href="/assets/js/8.a163349f.js"><link rel="prefetch" href="/assets/js/9.9058d3cc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.87611319.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/header.jpg" alt="DonV" class="logo"> <span class="site-name can-hide">DonV</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><a href="/pages/js/nav.html" class="nav-link">
  JavaScript
</a></div><div class="nav-item"><a href="/pages/html/nav.html" class="nav-link">
  HTML
</a></div><div class="nav-item"><a href="/pages/css/nav.html" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/pages/other/nav.html" class="nav-link">
  å…¶å®ƒ
</a></div><div class="nav-item"><a href="/pages/app/nav.html" class="nav-link">
  åº”ç”¨
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å…³äº" class="dropdown-title"><span class="title">å…³äº</span> <span class="arrow down"></span></button> <button type="button" aria-label="å…³äº" class="mobile-dropdown-title"><span class="title">å…³äº</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/dongwei1125" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/dongwei1125" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/2621689331987783" target="_blank" rel="noopener noreferrer" class="nav-link external">
  æ˜é‡‘
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/Don_GW" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/~dongwei1125" target="_blank" rel="noopener noreferrer" class="nav-link external">
  NPM
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><a href="/pages/js/nav.html" class="nav-link">
  JavaScript
</a></div><div class="nav-item"><a href="/pages/html/nav.html" class="nav-link">
  HTML
</a></div><div class="nav-item"><a href="/pages/css/nav.html" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/pages/other/nav.html" class="nav-link">
  å…¶å®ƒ
</a></div><div class="nav-item"><a href="/pages/app/nav.html" class="nav-link">
  åº”ç”¨
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å…³äº" class="dropdown-title"><span class="title">å…³äº</span> <span class="arrow down"></span></button> <button type="button" aria-label="å…³äº" class="mobile-dropdown-title"><span class="title">å…³äº</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/dongwei1125" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/dongwei1125" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/2621689331987783" target="_blank" rel="noopener noreferrer" class="nav-link external">
  æ˜é‡‘
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/Don_GW" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/~dongwei1125" target="_blank" rel="noopener noreferrer" class="nav-link external">
  NPM
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>è§£æå›¾ç‰‡çš„ç€‘å¸ƒæµï¼ˆå«æ‡’åŠ è½½ï¼‰åŸç†ï¼Œå¹¶æ­é…æœåŠ¡ç«¯äº¤äº’æ•°æ®</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/js/waterfall.html#å‰è¨€" class="sidebar-link">å‰è¨€</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/js/waterfall.html#å‡†å¤‡å·¥ä½œ" class="sidebar-link">å‡†å¤‡å·¥ä½œ</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/js/waterfall.html#å·¥å…·å‡½æ•°" class="sidebar-link">å·¥å…·å‡½æ•°</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/js/waterfall.html#getrandomint" class="sidebar-link">getRandomInt</a></li><li class="sidebar-sub-header"><a href="/pages/js/waterfall.html#getrandomheight" class="sidebar-link">getRandomHeight</a></li><li class="sidebar-sub-header"><a href="/pages/js/waterfall.html#getrandomcolor" class="sidebar-link">getRandomColor</a></li><li class="sidebar-sub-header"><a href="/pages/js/waterfall.html#createitem" class="sidebar-link">createItem</a></li><li class="sidebar-sub-header"><a href="/pages/js/waterfall.html#request" class="sidebar-link">request</a></li><li class="sidebar-sub-header"><a href="/pages/js/waterfall.html#debounce" class="sidebar-link">debounce</a></li></ul></li><li><a href="/pages/js/waterfall.html#åŸç†éƒ¨åˆ†" class="sidebar-link">åŸç†éƒ¨åˆ†</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/js/waterfall.html#getcols" class="sidebar-link">getCols</a></li><li class="sidebar-sub-header"><a href="/pages/js/waterfall.html#getminindex" class="sidebar-link">getMinIndex</a></li><li class="sidebar-sub-header"><a href="/pages/js/waterfall.html#setwaterfallrect" class="sidebar-link">setWaterFallRect</a></li><li class="sidebar-sub-header"><a href="/pages/js/waterfall.html#waterfall" class="sidebar-link">waterfall</a></li></ul></li><li><a href="/pages/js/waterfall.html#å®ç°éƒ¨åˆ†" class="sidebar-link">å®ç°éƒ¨åˆ†</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/js/waterfall.html#æ‡’åŠ è½½" class="sidebar-link">æ‡’åŠ è½½</a></li><li class="sidebar-sub-header"><a href="/pages/js/waterfall.html#å“åº”å¼" class="sidebar-link">å“åº”å¼</a></li></ul></li><li><a href="/pages/js/waterfall.html#å®Œæ•´ä»£ç " class="sidebar-link">å®Œæ•´ä»£ç </a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/js/waterfall.html#æ•ˆæœå›¾" class="sidebar-link">æ•ˆæœå›¾</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/js/waterfall.html#æ‡’åŠ è½½-2" class="sidebar-link">æ‡’åŠ è½½</a></li><li class="sidebar-sub-header"><a href="/pages/js/waterfall.html#å“åº”å¼-2" class="sidebar-link">å“åº”å¼</a></li></ul></li><li><a href="/pages/js/waterfall.html#ğŸ‰-å†™åœ¨æœ€å" class="sidebar-link">ğŸ‰ å†™åœ¨æœ€å</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="è§£æå›¾ç‰‡çš„ç€‘å¸ƒæµ-å«æ‡’åŠ è½½-åŸç†-å¹¶æ­é…æœåŠ¡ç«¯äº¤äº’æ•°æ®"><a href="#è§£æå›¾ç‰‡çš„ç€‘å¸ƒæµ-å«æ‡’åŠ è½½-åŸç†-å¹¶æ­é…æœåŠ¡ç«¯äº¤äº’æ•°æ®" class="header-anchor">#</a> è§£æå›¾ç‰‡çš„ç€‘å¸ƒæµï¼ˆå«æ‡’åŠ è½½ï¼‰åŸç†ï¼Œå¹¶æ­é…æœåŠ¡ç«¯äº¤äº’æ•°æ®</h1> <p><img src="/js/waterfall/banner.gif" alt=""></p> <h2 id="å‰è¨€"><a href="#å‰è¨€" class="header-anchor">#</a> å‰è¨€</h2> <p>â€ƒâ€ƒç€‘å¸ƒæµæ˜¯ä¸€ç§å¾ˆå¸¸è§çš„ç½‘é¡µå›¾ç‰‡äº¤äº’æ–¹å¼ï¼Œæ•ˆæœå¯ä»¥å‚è€ƒ <a href="https://huaban.com/" target="_blank" rel="noopener noreferrer">èŠ±ç“£ç½‘<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‚</p> <h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="header-anchor">#</a> å‡†å¤‡å·¥ä½œ</h2> <p>â€ƒâ€ƒé¦–å…ˆæ¥æŸ¥çœ‹ä¸€ä¸‹ç›®å½•ç»“æ„ï¼Œå…¶ä¸­<code>app.js</code>ä¸ºæœåŠ¡ç«¯å¯åŠ¨æ–‡ä»¶ï¼Œä¸»è¦ç”¨æ¥æä¾›æ¥å£ï¼Œè¿”å›æ‰€éœ€çš„å›¾ç‰‡æ•°æ®ï¼Œ<code>index.html</code>ä¸ºç€‘å¸ƒæµé¡µé¢ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>â”œâ”€â”€ app<span class="token punctuation">.</span>js
â”œâ”€â”€ index<span class="token punctuation">.</span>html
â”œâ”€â”€ <span class="token keyword">package</span><span class="token punctuation">.</span>json
â”œâ”€â”€ node_modules<span class="token operator">/</span>
</code></pre></div><p>â€ƒâ€ƒæœåŠ¡ç«¯<code>app.js</code>åˆ©ç”¨<code>express</code>æ­å»ºæœ¬åœ°æœåŠ¡å™¨ï¼Œå…¶ä¸­è®¿é—®<code>http://127.0.0.1:3000</code>é»˜è®¤è¿”å›ç€‘å¸ƒæµé¡µé¢ï¼Œè·å–å›¾ç‰‡æ¥å£ä¸€èˆ¬æ˜¯ä»¥<code>pageNo</code>å’Œ<code>pageSize</code>çš„åˆ†é¡µæ¨¡å¼ï¼Œç”±äºä»…æ˜¯æä¾›ç®€å•çš„æ•°æ®æœåŠ¡ï¼Œæ ¹æ®è¯·æ±‚å‚æ•°è¿”å›å›¾ç‰‡åˆ—è¡¨å³å¯ï¼Œä¸å¿…å¤ªå¤šçº ç»“é€»è¾‘ï¼Œæ³¨æ„å›¾ç‰‡æ•°é‡ä¸€èˆ¬æœ‰é™ï¼Œå‡å®šå¤§äº<code>300</code>åˆ™ä¸å†è¿”å›æ•°æ®åªè¿”å›ç©ºæ•°ç»„ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// app.js</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">3000</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./index.html'</span><span class="token punctuation">,</span> <span class="token string">'UTF-8'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">'404 not found'</span>

    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/imgs'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> pageSize<span class="token punctuation">,</span> pageNo <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>query
  <span class="token keyword">const</span> lists <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> total <span class="token operator">=</span> <span class="token number">300</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> pageSize<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    lists<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1/images/img.png'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    pageNo<span class="token punctuation">,</span>
    pageSize<span class="token punctuation">,</span>
    total<span class="token punctuation">,</span>
    <span class="token literal-property property">lists</span><span class="token operator">:</span> pageNo <span class="token operator">*</span> pageSize <span class="token operator">&gt;</span> total <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">:</span> lists<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">app is running at http://127.0.0.1:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>â€ƒâ€ƒ;<code>index.html</code>é¡µé¢å†…ï¼Œä¸ºäº†æ”¯æŒ<code>IE9</code>åŠä»¥ä¸Šæµè§ˆå™¨ï¼Œ<code>Promise</code>éœ€å¼•å…¥ç¬¬ä¸‰æ–¹<code>CDN</code>ï¼ŒåŒæ—¶é¡µé¢<code>ajax</code>è¯·æ±‚éœ€è¦ç”¨åˆ°<code>axios</code>åº“ï¼Œå¦å¤–é¡µé¢æ‰€æœ‰å‡½æ•°å‡ä¸ºæ™®é€šå‡½æ•°ï¼Œå˜é‡å£°æ˜ä¹Ÿä»…ç”¨<code>var</code>ï¼Œåˆ«é—®ä¸ºä»€ä¹ˆï¼Œé—®å°±æ˜¯å…¼å®¹<code>IE</code>ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>waterfall<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;promise-polyfill.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;axios.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
</code></pre></div><p>â€ƒâ€ƒ;<code>CSS</code>ä¸­å°†<code>waterfall</code>å—æ°´å¹³å±…ä¸­ï¼Œå†…éƒ¨<code>item</code>å…ƒç´ åŠ äº†é˜´å½±ï¼Œæ•ˆæœä¸Šä¼šæ›´åŠ å¥½ä¸€ç‚¹ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
  body <span class="token punctuation">{</span>
    <span class="token literal-property property">margin</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
    min<span class="token operator">-</span>width<span class="token operator">:</span> 600px<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  #waterfall <span class="token punctuation">{</span>
    <span class="token literal-property property">margin</span><span class="token operator">:</span> 16px auto<span class="token punctuation">;</span>
    <span class="token literal-property property">position</span><span class="token operator">:</span> relative<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token punctuation">.</span>item <span class="token punctuation">{</span>
    <span class="token literal-property property">width</span><span class="token operator">:</span> 230px<span class="token punctuation">;</span>
    border<span class="token operator">-</span>radius<span class="token operator">:</span> 10px<span class="token punctuation">;</span>
    <span class="token literal-property property">position</span><span class="token operator">:</span> absolute<span class="token punctuation">;</span>
    box<span class="token operator">-</span>shadow<span class="token operator">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.24</span><span class="token punctuation">)</span> 0px 3px 8px<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  #msg <span class="token punctuation">{</span>
    font<span class="token operator">-</span>size<span class="token operator">:</span> 18px<span class="token punctuation">;</span>
    font<span class="token operator">-</span>weight<span class="token operator">:</span> bold<span class="token punctuation">;</span>
    text<span class="token operator">-</span>align<span class="token operator">:</span> center<span class="token punctuation">;</span>
    <span class="token literal-property property">margin</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token literal-property property">height</span><span class="token operator">:</span> 80px<span class="token punctuation">;</span>
    line<span class="token operator">-</span>height<span class="token operator">:</span> 80px<span class="token punctuation">;</span>
    <span class="token literal-property property">color</span><span class="token operator">:</span> #3d3d3d<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;waterfall&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>p id<span class="token operator">=</span><span class="token string">&quot;msg&quot;</span><span class="token operator">&gt;</span>æ­£åœ¨åŠ è½½ä¸­<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
</code></pre></div><h2 id="å·¥å…·å‡½æ•°"><a href="#å·¥å…·å‡½æ•°" class="header-anchor">#</a> å·¥å…·å‡½æ•°</h2> <p>â€ƒâ€ƒ;<code>js</code>éƒ¨åˆ†åŒ…æ‹¬å¾ˆå¤šå·¥å…·ç±»å‡½æ•°ï¼Œæ¥ä¸‹æ¥é€ä¸ªè¯¦è¿°ã€‚</p> <h3 id="getrandomint"><a href="#getrandomint" class="header-anchor">#</a> getRandomInt</h3> <p>â€ƒâ€ƒ;<code>getRandomInt</code>å‡½æ•°ç”¨äºè·å–æŒ‡å®šèŒƒå›´å†…çš„éšæœºæ•´æ•°ï¼ŒåŒ…æ‹¬ä¸¤ç«¯çš„è¾¹ç•Œå€¼åœ¨å†…ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getRandomInt</span><span class="token punctuation">(</span><span class="token parameter">min<span class="token punctuation">,</span> max</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>max <span class="token operator">-</span> min <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> min
<span class="token punctuation">}</span>
</code></pre></div><h3 id="getrandomheight"><a href="#getrandomheight" class="header-anchor">#</a> getRandomHeight</h3> <p>â€ƒâ€ƒ;<code>getRandomHeight</code>è·å–éšæœºé«˜åº¦ï¼Œä»‹äº<code>200</code>åˆ°<code>500</code>ä¹‹é—´ï¼Œå‡ ç™¾å¼ é«˜åº¦ä¸ä¸€è‡´çš„å›¾ç‰‡ä¸å¤ªå¥½æ”¶é›†ï¼Œåˆ©ç”¨éšæœºæ•°æ¨¡æ‹Ÿå³å¯ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getRandomHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">getRandomInt</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'px'</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="getrandomcolor"><a href="#getrandomcolor" class="header-anchor">#</a> getRandomColor</h3> <p>â€ƒâ€ƒ;<code>getRandomColor</code>è·å–éšæœºèƒŒæ™¯è‰²ï¼ŒåŒ…æ‹¬é€æ˜åº¦ï¼Œä»‹äºä¸º<code>0.1</code>åˆ°<code>1</code>ä¹‹é—´ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getRandomColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'rgba('</span> <span class="token operator">+</span> <span class="token function">getRandomInt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">', '</span> <span class="token operator">+</span> <span class="token function">getRandomInt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">', '</span> <span class="token operator">+</span> <span class="token function">getRandomInt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">', '</span> <span class="token operator">+</span> <span class="token function">getRandomInt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token string">')'</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="createitem"><a href="#createitem" class="header-anchor">#</a> createItem</h3> <p>â€ƒâ€ƒ;<code>createItem</code>ç”¨äºåˆ›å»º<code>div</code>å…ƒç´ é¡¹ï¼Œç”±äºå›¾ç‰‡åœ°å€ä¸å¯ç”¨ï¼Œæ‰€ä»¥ä»£ç ä¸­æ³¨é‡Šäº†ï¼Œå…ƒç´ é¡¹çš„é«˜åº¦å’ŒèƒŒæ™¯è‰²æ ¹æ®ä¸Šè¿°å…¶å®ƒå·¥å…·å‡½æ•°ç”Ÿæˆã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">createItem</span><span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>

  <span class="token comment">// var img = document.createElement('img')</span>
  <span class="token comment">// img.src = src</span>
  <span class="token comment">// div.appendChild(img)</span>

  div<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'item'</span>
  div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token function">getRandomColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token function">getRandomHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> div
<span class="token punctuation">}</span>
</code></pre></div><h3 id="request"><a href="#request" class="header-anchor">#</a> request</h3> <p>â€ƒâ€ƒ;<code>request</code>ç”¨æˆ·è¯·æ±‚è·å–å›¾ç‰‡ï¼Œå…¶ä¸­<code>params</code>ä¸º<code>pageNo</code>å’Œ<code>pageSize</code>ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'http://127.0.0.1:3000/imgs'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">params</span><span class="token operator">:</span> params<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="debounce"><a href="#debounce" class="header-anchor">#</a> debounce</h3> <p>â€ƒâ€ƒ;<code>debounce</code>é˜²æŠ–å‡½æ•°ï¼Œç”¨äºé™åˆ¶è§¦å‘é¢‘ç‡ï¼Œå–ä¸ªå‚æ•°åˆ—è¡¨è¿˜æŠŠæ•°ç»„åŸå‹æŠ¬å‡ºæ¥äº†ï¼Œå› ä¸ºè¦å…¼å®¹<code>IE</code>ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> delay</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  delay <span class="token operator">=</span> delay <span class="token operator">||</span> <span class="token number">100</span>
  <span class="token keyword">var</span> timer <span class="token operator">=</span> <span class="token keyword">null</span>

  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> args <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>timer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span>
      timer <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>

    timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="åŸç†éƒ¨åˆ†"><a href="#åŸç†éƒ¨åˆ†" class="header-anchor">#</a> åŸç†éƒ¨åˆ†</h2> <p>â€ƒâ€ƒç€‘å¸ƒæµå†…éƒ¨çš„å…ƒç´ è¦å½¢æˆäº¤é”™çš„æ ·å¼é£æ ¼ï¼Œåªèƒ½é€šè¿‡å®šä½å®ç°ï¼Œå› æ­¤å¤–å±‚<code>waterfall</code>éœ€è¦ç›¸å¯¹å®šä½ï¼Œå†…éƒ¨å…ƒç´ éœ€è¦ç»å¯¹å®šä½ã€‚</p> <h3 id="getcols"><a href="#getcols" class="header-anchor">#</a> getCols</h3> <p>â€ƒâ€ƒç„¶åå†ç¡®å®šé¡µé¢å…·ä½“æ˜¾ç¤ºå‡ åˆ—ï¼Œå…¶ä¸­<code>width</code>ä¸ºå…ƒç´ é¡¹å®½ï¼Œ<code>gap</code>ä¸ºé¡¹ä¸é¡¹ä¹‹é—´çš„é—´éš™ã€‚å…¶ä¸­<code>n * width + (n - 1) * gap</code>ä¸ºå¤šåˆ—å…ƒç´ é¡¹æ‰€å å®½åº¦ï¼Œåº”é»˜è®¤å°äº<code>body</code>çš„å®½åº¦ï¼Œä½†æ˜¯<code>body</code>å·¦å³éœ€è¦ç•™éƒ¨åˆ†é—´éš™ï¼Œå› æ­¤é»˜è®¤å°äº<code>bodyWidth - margin * 2</code>ã€‚è°ƒæ•´ç­‰å¼ï¼Œå†é€šè¿‡<code>~~</code>ï¼ˆç±»ä¼¼<code>parseInt</code>ï¼‰å–æ•´å³å¯ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getCols</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// n * width + (n - 1) * gap &lt;= bodyWidth - margin * 2</span>
  <span class="token keyword">return</span> <span class="token operator">~</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>offsetWidth <span class="token operator">-</span> <span class="token number">32</span> <span class="token operator">+</span> gap<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>width <span class="token operator">+</span> gap<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>â€ƒâ€ƒç€‘å¸ƒæµçš„æœ€æ ¹æœ¬åŸç†å°±æ˜¯ï¼Œé¦–è¡Œé“ºæ»¡å…ƒç´ åï¼Œåç»­å…ƒç´ å‡å®šä½åœ¨é«˜åº¦æœ€å°çš„åˆ—çš„åé¢ï¼Œä¾æ¬¡å¾€åå®šä½é“ºæ»¡ã€‚å› æ­¤å…¨å±€ä¸‹éœ€è¦ç»´æŠ¤<code>heights</code>æ•°ç»„ï¼Œç”¨äºå­˜æ”¾æ¯ä¸€åˆ—çš„å½“å‰é«˜åº¦ã€‚</p> <p><img src="/js/waterfall/theory.gif" alt=""></p> <h3 id="getminindex"><a href="#getminindex" class="header-anchor">#</a> getMinIndex</h3> <p>â€ƒâ€ƒ;<code>getMinIndex</code>ç”¨äºè·å–<code>heights</code>æ•°ç»„ä¸­å€¼æœ€å°çš„åˆ—çš„ç´¢å¼•ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getMinIndex</span><span class="token punctuation">(</span><span class="token parameter">array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> min <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> array<span class="token punctuation">)</span>

  <span class="token keyword">return</span> array<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>min<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="setwaterfallrect"><a href="#setwaterfallrect" class="header-anchor">#</a> setWaterFallRect</h3> <p>â€ƒâ€ƒæ³¨æ„ç”±äºå¤–å±‚<code>waterfall</code>å—å’Œå†…å±‚å…ƒç´ å®šä½çš„åŸå› ï¼Œå†…å±‚å…ƒç´ è„±ç¦»æ–‡æ¡£æµï¼Œé€ æˆå¤–å±‚é«˜åº¦å¡Œé™·äº†ã€‚å› æ­¤éœ€è¦æ ¹æ®åˆ—æ•°å’Œ<code>heights</code>å…±åŒè®¾ç½®å¤–å±‚å…ƒç´ çš„å®½é«˜ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">setWaterFallRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> wf <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#waterfall'</span><span class="token punctuation">)</span>
  <span class="token keyword">var</span> max <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> heights<span class="token punctuation">)</span>

  wf<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> max <span class="token operator">+</span> <span class="token string">'px'</span>
  wf<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> width <span class="token operator">*</span> cols <span class="token operator">+</span> <span class="token punctuation">(</span>cols <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> gap <span class="token operator">+</span> <span class="token string">'px'</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="waterfall"><a href="#waterfall" class="header-anchor">#</a> waterfall</h3> <p>â€ƒâ€ƒ;<code>waterfall</code>å‡½æ•°å³å®ç°ä¸Šè¿°åŠŸèƒ½ï¼Œé¦–è¡Œé“ºæ»¡åŒæ—¶å¡«å……é«˜åº¦å€¼åˆ°<code>heights</code>ä¸­ï¼Œåç»­çš„å…ƒç´ éœ€è¦åˆ¤æ–­<code>heights</code>æ•°ç»„ä¸­å€¼æœ€å°çš„ç´¢å¼•ï¼Œè®¡ç®—å‡º<code>left</code>å’Œ<code>top</code>å®šä½å€¼å¹¶åº”ç”¨äºå½“å‰å…ƒç´ ã€‚<code>for</code>å¾ªç¯ç»“æŸæ‰€æœ‰çš„å…ƒç´ é¡¹å¸ƒå±€å®šä½å®Œæˆï¼Œæ­¤æ—¶å†æ›´æ–°å¤–å±‚<code>waterfall</code>å—çš„å®½é«˜ã€‚</p> <p>â€ƒâ€ƒæ³¨æ„<code>for</code>å¾ªç¯ä¸­å˜é‡<code>i</code>åˆå§‹å€¼ä¸º<code>loaded</code>ï¼Œ<code>loaded</code>ç”¨äºå¯¹å·²ç»å®Œæˆå¸ƒå±€å®šä½çš„å…ƒç´ è®¡æ•°ã€‚å› ä¸ºéœ€è¦é…åˆæ‡’åŠ è½½ï¼Œæ¯æ¬¡æ‡’åŠ è½½æ–°å¢å…ƒç´ æ—¶ï¼Œéƒ½åªå¯¹æ–°å¢çš„å…ƒç´ è¿›è¡Œå¸ƒå±€å®šä½ï¼Œè€Œä¹‹å‰çš„å…ƒç´ åˆ™ä¸å†å¸ƒå±€ï¼Œä»¥æ­¤æ¥ä¼˜åŒ–æ€§èƒ½ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">waterfall</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  cols <span class="token operator">=</span> <span class="token function">getCols</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">var</span> items <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'#waterfall .item'</span><span class="token punctuation">)</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> loaded<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> items<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> item <span class="token operator">=</span> items<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    <span class="token keyword">var</span> height <span class="token operator">=</span> item<span class="token punctuation">.</span>offsetHeight

    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> cols<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      item<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token number">0</span>
      item<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> i <span class="token operator">*</span> <span class="token punctuation">(</span>width <span class="token operator">+</span> gap<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'px'</span>
      heights<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> minIndex <span class="token operator">=</span> <span class="token function">getMinIndex</span><span class="token punctuation">(</span>heights<span class="token punctuation">)</span>
      <span class="token keyword">var</span> top <span class="token operator">=</span> heights<span class="token punctuation">[</span>minIndex<span class="token punctuation">]</span> <span class="token operator">+</span> gap

      item<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> top <span class="token operator">+</span> <span class="token string">'px'</span>
      item<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> minIndex <span class="token operator">*</span> <span class="token punctuation">(</span>width <span class="token operator">+</span> gap<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'px'</span>
      heights<span class="token punctuation">[</span>minIndex<span class="token punctuation">]</span> <span class="token operator">=</span> top <span class="token operator">+</span> height
    <span class="token punctuation">}</span>

    loaded<span class="token operator">++</span>
  <span class="token punctuation">}</span>

  <span class="token function">setWaterFallRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="å®ç°éƒ¨åˆ†"><a href="#å®ç°éƒ¨åˆ†" class="header-anchor">#</a> å®ç°éƒ¨åˆ†</h2> <p>â€ƒâ€ƒåŸºç¡€çš„å·¥å…·å‡½æ•°å’ŒåŠŸèƒ½å‡½æ•°éƒ½å·²ç»å®Œæˆï¼Œé¦–å…ˆéœ€è¦åˆå§‹åŒ–æ•´ä¸ªç€‘å¸ƒæµç•Œé¢ï¼Œå…¶ä¸­<code>isReq</code>ç”¨ä½œèŠ‚æµé˜€ï¼Œåé¢æ¥å…¥æ‡’åŠ è½½æ—¶ï¼Œæ»šåŠ¨æ¡è§¦å‘è¿‡äºé¢‘ç¹ï¼Œè‹¥æ¥å£å¤„äºè¯·æ±‚è¿‡ç¨‹ä¸­ï¼Œåˆ™ä¸å†è¯·æ±‚ã€‚</p> <p>â€ƒâ€ƒ;<code>total</code>ç”¨äºè®°å½•è¯·æ±‚çš„å›¾ç‰‡æ€»æ•°ï¼Œæ¯æ¬¡è¯·æ±‚æˆåŠŸåˆ†é¡µç åŠ <code>1</code>ï¼Œä¸‹æ¬¡è¯·æ±‚åˆ™è¯·æ±‚ä¸‹ä¸€é¡µçš„æ•°æ®ã€‚</p> <p>â€ƒâ€ƒ;<code>createDocumentFragment</code>ç”¨äºå°†åˆ›å»ºçš„<code>DOM</code>å…ƒç´ åŠ å…¥åˆ°æ–‡æ¡£ç‰‡ä¸­ï¼Œå¾…æ‰€æœ‰çš„<code>DOM</code>åˆ›å»ºå®Œæˆå¹¶åŠ å…¥åˆ°æ–‡æ¡£ç‰‡ä¸­æ—¶ï¼Œå†å°†æ–‡æ¡£ç‰‡ä¸€æ¬¡æ€§æ’å…¥åˆ°<code>waterfall</code>å—ä¸­ã€‚</p> <p>â€ƒâ€ƒå¸¸è§„çš„æ–¹å¼æ˜¯åˆ›å»ºå®Œå…ƒç´ å°±<code>append</code>åˆ°<code>waterfall</code>ä¸­ï¼Œä½†æ˜¯æ¯æ¬¡æ’å…¥éƒ½ä¼šé€ æˆé¡µé¢é‡æ’ï¼Œè€Œç”±äº<code>createDocumentFragment</code>å­˜åœ¨äºå†…å­˜ä¸­ï¼Œä¸åœ¨<code>DOM</code>æ ‘ä¸­ï¼Œå› æ­¤å°†æ–‡æ¡£ç‰‡æ’å…¥åˆ°<code>waterfall</code>å—ä¸­æ—¶é¡µé¢ä»…ä»…é‡æ’ä¸€æ¬¡ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isReq<span class="token punctuation">)</span> <span class="token keyword">return</span>
  isReq <span class="token operator">=</span> <span class="token boolean">true</span>

  <span class="token function">request</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> lists <span class="token operator">=</span> res<span class="token punctuation">.</span>lists
    <span class="token keyword">var</span> frag <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createDocumentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    total <span class="token operator">=</span> res<span class="token punctuation">.</span>total
    isReq <span class="token operator">=</span> <span class="token boolean">false</span>
    params<span class="token punctuation">.</span>pageNo<span class="token operator">++</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> lists<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      frag<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token function">createItem</span><span class="token punctuation">(</span>lists<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#waterfall'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>frag<span class="token punctuation">)</span>

    <span class="token function">waterfall</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="æ‡’åŠ è½½"><a href="#æ‡’åŠ è½½" class="header-anchor">#</a> æ‡’åŠ è½½</h3> <p>â€ƒâ€ƒ;<code>window</code>ç»‘å®šæ»šåŠ¨æ¡äº‹ä»¶ï¼Œæ¯æ¬¡æ»šåŠ¨éƒ½ä¼šè§¦å‘<code>lazyLoad</code>æ‡’åŠ è½½ã€‚</p> <p>â€ƒâ€ƒæ³¨æ„æ–‡æ¡£æœªæ˜¾ç¤ºçš„å†…å®¹é«˜åº¦ä¸º<code>documentHeight - scrollTop - clientHeight</code>ï¼Œä¸€èˆ¬æ­¤éƒ¨åˆ†é«˜åº¦å°äºçª—å£é«˜åº¦çš„ä¸€åŠå°±åŠ è½½æ–°çš„æ•°æ®ã€‚</p> <p>â€ƒâ€ƒæ»¡è¶³æ­¤æ¡ä»¶çš„åŒæ—¶ï¼Œè‹¥å®Œæˆå¸ƒå±€çš„å…ƒç´ æ•°é‡<code>loaded</code>å¤§äºæˆ–è€…ç­‰äºè¯·æ±‚çš„å›¾ç‰‡æ•°é‡<code>total</code>ï¼Œå³è¡¨ç¤ºæœåŠ¡ç«¯è¿”å›çš„æ•°æ®å·²ç»å…¨éƒ¨åŠ è½½å®Œæˆï¼Œä¸ç”¨å†è¯·æ±‚æ•°æ®ï¼Œå› æ­¤æ³¨é”€æ»šåŠ¨æ¡äº‹ä»¶ã€‚</p> <p>â€ƒâ€ƒä¸ºä»€ä¹ˆæ­¤å¤„ä¸ç”¨åšæ»šåŠ¨æ¡é˜²æŠ–å‘¢ï¼ŸåŸå› åœ¨äº<code>init</code>å‡½æ•°åšäº†èŠ‚æµå¤„ç†ï¼Œå³ä¾¿æ˜¯<code>init</code>é¢‘ç¹è§¦å‘ï¼Œè·å–å›¾ç‰‡çš„è¯·æ±‚ä¹Ÿæœ€å¤šåªä¼šæœ‰ä¸€ä¸ªã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'scroll'</span><span class="token punctuation">,</span> lazyLoad<span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">lazyLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> scrollTop <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>scrollTop <span class="token operator">||</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>scrollTop
  <span class="token keyword">var</span> documentHeight <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>scrollHeight
  <span class="token keyword">var</span> clientHeight <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight

  <span class="token comment">// documentHeight - scrollTop - clientHeight &lt; 0.5 * clientHeight</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>documentHeight <span class="token operator">-</span> scrollTop <span class="token operator">&lt;</span> <span class="token number">1.5</span> <span class="token operator">*</span> clientHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>loaded <span class="token operator">&gt;=</span> total<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#msg'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'æ²¡æœ‰æ›´å¤šäº†'</span>
      window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'scroll'</span><span class="token punctuation">,</span> lazyLoad<span class="token punctuation">)</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>

    <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="å“åº”å¼"><a href="#å“åº”å¼" class="header-anchor">#</a> å“åº”å¼</h3> <p>â€ƒâ€ƒåœ¨æ­¤åŸºç¡€ä¸Šå†åšä¸€ä¸ªå“åº”å¼åŠŸèƒ½ï¼Œå³æµè§ˆå™¨çª—å£å®½åº¦æ”¹å˜ï¼ŒåŠ¨æ€åˆ‡æ¢åˆ—æ•°ã€‚</p> <p>â€ƒâ€ƒçª—å£å®½åº¦æ”¹å˜åï¼Œæ•´ä¸ªé¡µé¢çš„å…ƒç´ é¡¹éœ€è¦é‡æ–°å¸ƒå±€ï¼Œå› æ­¤<code>loaded</code>å’Œ<code>heights</code>éƒ½è¦é‡ç½®ã€‚</p> <p>â€ƒâ€ƒçª—å£å®½åº¦ä½äº<code>body</code>çš„æœ€å°å®½åº¦æ— éœ€é‡æ–°å¸ƒå±€ï¼Œå³æ— è®ºçª—å£å¦‚ä½•æ”¹å˜ï¼Œè‡³å°‘æ˜¾ç¤ºä¸¤åˆ—ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> <span class="token function">debounce</span><span class="token punctuation">(</span>resize<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>offsetWidth <span class="token operator">&lt;</span> <span class="token number">600</span><span class="token punctuation">)</span> <span class="token keyword">return</span>

  loaded <span class="token operator">=</span> <span class="token number">0</span>
  heights <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token function">waterfall</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="header-anchor">#</a> å®Œæ•´ä»£ç </h2> <p>â€ƒâ€ƒ;<a href="http://www.axios-js.com/" target="_blank" rel="noopener noreferrer">axios<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> å’Œ <a href="https://github.com/taylorhakes/promise-polyfill" target="_blank" rel="noopener noreferrer">promise-polyfill<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ä¸‹è½½æœ¬åœ°æˆ–<code>CDN</code>å¼•å…¥éƒ½å¯ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// index.html</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">&quot;en&quot;</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>waterfall<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;promise-polyfill.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;axios.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
    body <span class="token punctuation">{</span>
      <span class="token literal-property property">margin</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
      min<span class="token operator">-</span>width<span class="token operator">:</span> 600px<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    #waterfall <span class="token punctuation">{</span>
      <span class="token literal-property property">margin</span><span class="token operator">:</span> 16px auto<span class="token punctuation">;</span>
      <span class="token literal-property property">position</span><span class="token operator">:</span> relative<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">.</span>item <span class="token punctuation">{</span>
      <span class="token literal-property property">width</span><span class="token operator">:</span> 230px<span class="token punctuation">;</span>
      border<span class="token operator">-</span>radius<span class="token operator">:</span> 10px<span class="token punctuation">;</span>
      <span class="token literal-property property">position</span><span class="token operator">:</span> absolute<span class="token punctuation">;</span>
      box<span class="token operator">-</span>shadow<span class="token operator">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.24</span><span class="token punctuation">)</span> 0px 3px 8px<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    #msg <span class="token punctuation">{</span>
      font<span class="token operator">-</span>size<span class="token operator">:</span> 18px<span class="token punctuation">;</span>
      font<span class="token operator">-</span>weight<span class="token operator">:</span> bold<span class="token punctuation">;</span>
      text<span class="token operator">-</span>align<span class="token operator">:</span> center<span class="token punctuation">;</span>
      <span class="token literal-property property">margin</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token literal-property property">height</span><span class="token operator">:</span> 80px<span class="token punctuation">;</span>
      line<span class="token operator">-</span>height<span class="token operator">:</span> 80px<span class="token punctuation">;</span>
      <span class="token literal-property property">color</span><span class="token operator">:</span> #3d3d3d<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;waterfall&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>p id<span class="token operator">=</span><span class="token string">&quot;msg&quot;</span><span class="token operator">&gt;</span>æ­£åœ¨åŠ è½½ä¸­<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>

  <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">function</span> <span class="token function">getRandomInt</span><span class="token punctuation">(</span><span class="token parameter">min<span class="token punctuation">,</span> max</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>max <span class="token operator">-</span> min <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> min
      <span class="token punctuation">}</span>

      <span class="token keyword">function</span> <span class="token function">getRandomHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">getRandomInt</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'px'</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">function</span> <span class="token function">getRandomColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;rgba(&quot;</span> <span class="token operator">+</span> <span class="token function">getRandomInt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, &quot;</span> <span class="token operator">+</span> <span class="token function">getRandomInt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, &quot;</span> <span class="token operator">+</span> <span class="token function">getRandomInt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, &quot;</span> <span class="token operator">+</span> <span class="token function">getRandomInt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token string">&quot;)&quot;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">function</span> <span class="token function">createItem</span><span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>

        <span class="token comment">// var img = document.createElement('img')</span>
        <span class="token comment">// img.src = src</span>
        <span class="token comment">// div.appendChild(img)</span>

        div<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'item'</span>
        div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token function">getRandomColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token function">getRandomHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> div
      <span class="token punctuation">}</span>

      <span class="token keyword">function</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'http://127.0.0.1:3000/imgs'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">params</span><span class="token operator">:</span> params<span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">function</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> delay</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        delay <span class="token operator">=</span> delay <span class="token operator">||</span> <span class="token number">100</span>
        <span class="token keyword">var</span> timer <span class="token operator">=</span> <span class="token keyword">null</span>

        <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">var</span> args <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span>

          <span class="token keyword">if</span> <span class="token punctuation">(</span>timer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span>
            timer <span class="token operator">=</span> <span class="token keyword">null</span>
          <span class="token punctuation">}</span>

          timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">function</span> <span class="token function">getCols</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// n * width + (n - 1) * gap &lt;= bodyWidth - margin * 2</span>
        <span class="token keyword">return</span> <span class="token operator">~</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>offsetWidth <span class="token operator">-</span> <span class="token number">32</span> <span class="token operator">+</span> gap<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>width <span class="token operator">+</span> gap<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">function</span> <span class="token function">getMinIndex</span><span class="token punctuation">(</span><span class="token parameter">array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> min <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> array<span class="token punctuation">)</span>

        <span class="token keyword">return</span> array<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>min<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">function</span> <span class="token function">setWaterFallRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> wf <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#waterfall'</span><span class="token punctuation">)</span>
        <span class="token keyword">var</span> max <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> heights<span class="token punctuation">)</span>

        wf<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> max <span class="token operator">+</span> <span class="token string">'px'</span>
        wf<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> width <span class="token operator">*</span> cols <span class="token operator">+</span> <span class="token punctuation">(</span>cols <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> gap <span class="token operator">+</span> <span class="token string">'px'</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">function</span> <span class="token function">waterfall</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cols <span class="token operator">=</span> <span class="token function">getCols</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">var</span> items <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#waterfall .item'</span><span class="token punctuation">)</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> loaded<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> items<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">var</span> item <span class="token operator">=</span> items<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
          <span class="token keyword">var</span> height <span class="token operator">=</span> item<span class="token punctuation">.</span>offsetHeight

          <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> cols<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            item<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token number">0</span>
            item<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> i <span class="token operator">*</span> <span class="token punctuation">(</span>width <span class="token operator">+</span> gap<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'px'</span>
            heights<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> minIndex <span class="token operator">=</span> <span class="token function">getMinIndex</span><span class="token punctuation">(</span>heights<span class="token punctuation">)</span>
            <span class="token keyword">var</span> top <span class="token operator">=</span> heights<span class="token punctuation">[</span>minIndex<span class="token punctuation">]</span> <span class="token operator">+</span> gap

            item<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> top <span class="token operator">+</span> <span class="token string">'px'</span>
            item<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> minIndex <span class="token operator">*</span> <span class="token punctuation">(</span>width <span class="token operator">+</span> gap<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'px'</span>
            heights<span class="token punctuation">[</span>minIndex<span class="token punctuation">]</span> <span class="token operator">=</span> top <span class="token operator">+</span> height
          <span class="token punctuation">}</span>

          loaded<span class="token operator">++</span>
        <span class="token punctuation">}</span>

        <span class="token function">setWaterFallRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>isReq<span class="token punctuation">)</span> <span class="token keyword">return</span>
        isReq <span class="token operator">=</span> <span class="token boolean">true</span>

        <span class="token function">request</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">var</span> lists <span class="token operator">=</span> res<span class="token punctuation">.</span>lists
          <span class="token keyword">var</span> frag <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createDocumentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

          total <span class="token operator">=</span> res<span class="token punctuation">.</span>total
          isReq <span class="token operator">=</span> <span class="token boolean">false</span>
          params<span class="token punctuation">.</span>pageNo<span class="token operator">++</span>

          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> lists<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            frag<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token function">createItem</span><span class="token punctuation">(</span>lists<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>

          document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#waterfall'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>frag<span class="token punctuation">)</span>

          <span class="token function">waterfall</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">function</span> <span class="token function">lazyLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> scrollTop <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>scrollTop <span class="token operator">||</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>scrollTop
        <span class="token keyword">var</span> documentHeight <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>scrollHeight
        <span class="token keyword">var</span> clientHeight <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight

        <span class="token comment">// documentHeight - scrollTop - clientHeight &lt; 0.5 * clientHeight</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>documentHeight <span class="token operator">-</span> scrollTop <span class="token operator">&lt;</span> <span class="token number">1.5</span> <span class="token operator">*</span> clientHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>loaded <span class="token operator">&gt;=</span> total<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#msg'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">'æ²¡æœ‰æ›´å¤šäº†'</span>
            window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'scroll'</span><span class="token punctuation">,</span> lazyLoad<span class="token punctuation">)</span>
            <span class="token keyword">return</span>
          <span class="token punctuation">}</span>

          <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">function</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>offsetWidth <span class="token operator">&lt;</span> <span class="token number">600</span><span class="token punctuation">)</span> <span class="token keyword">return</span>

        loaded <span class="token operator">=</span> <span class="token number">0</span>
        heights <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token function">waterfall</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">var</span> width <span class="token operator">=</span> <span class="token number">230</span>

      <span class="token keyword">var</span> gap <span class="token operator">=</span> <span class="token number">16</span>

      <span class="token keyword">var</span> loaded <span class="token operator">=</span> <span class="token number">0</span>

      <span class="token keyword">var</span> cols <span class="token operator">=</span> <span class="token number">0</span>

      <span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">pageNo</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token literal-property property">pageSize</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">var</span> total <span class="token operator">=</span> <span class="token number">0</span>

      <span class="token keyword">var</span> heights <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

      <span class="token keyword">var</span> isReq <span class="token operator">=</span> <span class="token boolean">false</span>

      <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

      window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'scroll'</span><span class="token punctuation">,</span> lazyLoad<span class="token punctuation">)</span>

      window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> <span class="token function">debounce</span><span class="token punctuation">(</span>resize<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre></div><h2 id="æ•ˆæœå›¾"><a href="#æ•ˆæœå›¾" class="header-anchor">#</a> æ•ˆæœå›¾</h2> <h3 id="æ‡’åŠ è½½-2"><a href="#æ‡’åŠ è½½-2" class="header-anchor">#</a> æ‡’åŠ è½½</h3> <p><img src="/js/waterfall/lazyload.gif" alt=""></p> <h3 id="å“åº”å¼-2"><a href="#å“åº”å¼-2" class="header-anchor">#</a> å“åº”å¼</h3> <p><img src="/js/waterfall/reactive.gif" alt=""></p> <h2 id="ğŸ‰-å†™åœ¨æœ€å"><a href="#ğŸ‰-å†™åœ¨æœ€å" class="header-anchor">#</a> ğŸ‰ å†™åœ¨æœ€å</h2> <p>ğŸ»ä¼™ä¼´ä»¬ï¼Œå¦‚æœä½ å·²ç»çœ‹åˆ°äº†è¿™é‡Œï¼Œè§‰å¾—è¿™ç¯‡æ–‡ç« æœ‰å¸®åŠ©åˆ°ä½ çš„è¯ä¸å¦¨ç‚¹èµğŸ‘æˆ– <a href="https://github.com/dongwei1125/blog" target="_blank" rel="noopener noreferrer">Star<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> âœ¨æ”¯æŒä¸€ä¸‹å“¦ï¼</p> <p>æ‰‹åŠ¨ç å­—ï¼Œå¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºæŒ‡æ­£ğŸ’¬~</p> <p>ä½ çš„æ”¯æŒå°±æ˜¯æˆ‘æ›´æ–°çš„æœ€å¤§åŠ¨åŠ›ğŸ’ª~</p> <p><a href="https://github.com/dongwei1125" target="_blank" rel="noopener noreferrer">GitHub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> / <a href="https://gitee.com/dongwei1125" target="_blank" rel="noopener noreferrer">Gitee<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€<a href="https://dongwei1125.github.io/" target="_blank" rel="noopener noreferrer">GitHub Pages<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€<a href="https://juejin.cn/user/2621689331987783" target="_blank" rel="noopener noreferrer">æ˜é‡‘<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€<a href="https://blog.csdn.net/Don_GW" target="_blank" rel="noopener noreferrer">CSDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> åŒæ­¥æ›´æ–°ï¼Œæ¬¢è¿å…³æ³¨ğŸ˜‰~</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">æœ€åæ›´æ–°æ—¶é—´:</span> <span class="time">3/6/2022, 9:06:37 PM</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.0aa97f73.js" defer></script><script src="/assets/js/2.f850a8ef.js" defer></script><script src="/assets/js/55.937bfe09.js" defer></script>
  </body>
</html>
