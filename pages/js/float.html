<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JavaScript 浮点数陷阱 | DonV</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/header.jpg">
    <meta name="description" content="A paper about JavaScript, HTML and CSS.">
    
    <link rel="preload" href="/assets/css/0.styles.87611319.css" as="style"><link rel="preload" href="/assets/js/app.0aa97f73.js" as="script"><link rel="preload" href="/assets/js/2.f850a8ef.js" as="script"><link rel="preload" href="/assets/js/41.6cdce4cf.js" as="script"><link rel="preload" href="/assets/js/3.31ebf682.js" as="script"><link rel="prefetch" href="/assets/js/10.cb041c1b.js"><link rel="prefetch" href="/assets/js/11.1aadbcee.js"><link rel="prefetch" href="/assets/js/12.77cc8e56.js"><link rel="prefetch" href="/assets/js/13.7e8162d9.js"><link rel="prefetch" href="/assets/js/14.dea6ba67.js"><link rel="prefetch" href="/assets/js/15.a786d687.js"><link rel="prefetch" href="/assets/js/16.163edf25.js"><link rel="prefetch" href="/assets/js/17.3a0232cb.js"><link rel="prefetch" href="/assets/js/18.91bd2dd7.js"><link rel="prefetch" href="/assets/js/19.a36993f8.js"><link rel="prefetch" href="/assets/js/20.30dd9f79.js"><link rel="prefetch" href="/assets/js/21.5e3c83a3.js"><link rel="prefetch" href="/assets/js/22.88d5e321.js"><link rel="prefetch" href="/assets/js/23.b54a65a7.js"><link rel="prefetch" href="/assets/js/24.51df379f.js"><link rel="prefetch" href="/assets/js/25.79342bd2.js"><link rel="prefetch" href="/assets/js/26.643d5441.js"><link rel="prefetch" href="/assets/js/27.54b7d7b4.js"><link rel="prefetch" href="/assets/js/28.d01a4aee.js"><link rel="prefetch" href="/assets/js/29.7d932073.js"><link rel="prefetch" href="/assets/js/30.4c2f5636.js"><link rel="prefetch" href="/assets/js/31.b00c42d5.js"><link rel="prefetch" href="/assets/js/32.e9a0f488.js"><link rel="prefetch" href="/assets/js/33.f510b5fd.js"><link rel="prefetch" href="/assets/js/34.6e78f32f.js"><link rel="prefetch" href="/assets/js/35.04d666a2.js"><link rel="prefetch" href="/assets/js/36.900a3beb.js"><link rel="prefetch" href="/assets/js/37.19ddf8d7.js"><link rel="prefetch" href="/assets/js/38.35f899bd.js"><link rel="prefetch" href="/assets/js/39.fe9ea525.js"><link rel="prefetch" href="/assets/js/4.3c7083a8.js"><link rel="prefetch" href="/assets/js/40.0d116ce0.js"><link rel="prefetch" href="/assets/js/42.ab0bd0d5.js"><link rel="prefetch" href="/assets/js/43.66c8f8eb.js"><link rel="prefetch" href="/assets/js/44.ac02981e.js"><link rel="prefetch" href="/assets/js/45.479814b0.js"><link rel="prefetch" href="/assets/js/46.29956259.js"><link rel="prefetch" href="/assets/js/47.a89cf7d2.js"><link rel="prefetch" href="/assets/js/48.859e3502.js"><link rel="prefetch" href="/assets/js/49.d0fa0b25.js"><link rel="prefetch" href="/assets/js/5.206809f3.js"><link rel="prefetch" href="/assets/js/50.d051084c.js"><link rel="prefetch" href="/assets/js/51.fa831e6a.js"><link rel="prefetch" href="/assets/js/52.3ed98760.js"><link rel="prefetch" href="/assets/js/53.016b1c3c.js"><link rel="prefetch" href="/assets/js/54.c88e06c5.js"><link rel="prefetch" href="/assets/js/55.937bfe09.js"><link rel="prefetch" href="/assets/js/56.03003660.js"><link rel="prefetch" href="/assets/js/57.8bcda68a.js"><link rel="prefetch" href="/assets/js/58.286692ba.js"><link rel="prefetch" href="/assets/js/59.fbfe98aa.js"><link rel="prefetch" href="/assets/js/6.6f9d9bda.js"><link rel="prefetch" href="/assets/js/60.0975844e.js"><link rel="prefetch" href="/assets/js/61.0af6cf48.js"><link rel="prefetch" href="/assets/js/62.66c23699.js"><link rel="prefetch" href="/assets/js/63.7fda9b3f.js"><link rel="prefetch" href="/assets/js/7.6f64fba1.js"><link rel="prefetch" href="/assets/js/8.a163349f.js"><link rel="prefetch" href="/assets/js/9.9058d3cc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.87611319.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/header.jpg" alt="DonV" class="logo"> <span class="site-name can-hide">DonV</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/pages/js/nav.html" class="nav-link">
  JavaScript
</a></div><div class="nav-item"><a href="/pages/html/nav.html" class="nav-link">
  HTML
</a></div><div class="nav-item"><a href="/pages/css/nav.html" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/pages/other/nav.html" class="nav-link">
  其它
</a></div><div class="nav-item"><a href="/pages/app/nav.html" class="nav-link">
  应用
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于" class="dropdown-title"><span class="title">关于</span> <span class="arrow down"></span></button> <button type="button" aria-label="关于" class="mobile-dropdown-title"><span class="title">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/dongwei1125" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/dongwei1125" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/2621689331987783" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/Don_GW" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/~dongwei1125" target="_blank" rel="noopener noreferrer" class="nav-link external">
  NPM
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/pages/js/nav.html" class="nav-link">
  JavaScript
</a></div><div class="nav-item"><a href="/pages/html/nav.html" class="nav-link">
  HTML
</a></div><div class="nav-item"><a href="/pages/css/nav.html" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/pages/other/nav.html" class="nav-link">
  其它
</a></div><div class="nav-item"><a href="/pages/app/nav.html" class="nav-link">
  应用
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于" class="dropdown-title"><span class="title">关于</span> <span class="arrow down"></span></button> <button type="button" aria-label="关于" class="mobile-dropdown-title"><span class="title">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/dongwei1125" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/dongwei1125" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/2621689331987783" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/Don_GW" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/~dongwei1125" target="_blank" rel="noopener noreferrer" class="nav-link external">
  NPM
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>JavaScript 浮点数陷阱</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/js/float.html#前言" class="sidebar-link">前言</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/js/float.html#ieee-754" class="sidebar-link">IEEE 754</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/js/float.html#就近舍入" class="sidebar-link">就近舍入</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/js/float.html#number-max-value" class="sidebar-link">Number.MAX_VALUE</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/js/float.html#number-max-safe-integer" class="sidebar-link">Number.MAXSAFEINTEGER</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/js/float.html#_0-1-0-2-0-3" class="sidebar-link">0.1 + 0.2 != 0.3</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/js/float.html#_0-1" class="sidebar-link">0.1</a></li><li class="sidebar-sub-header"><a href="/pages/js/float.html#_0-2" class="sidebar-link">0.2</a></li><li class="sidebar-sub-header"><a href="/pages/js/float.html#对阶" class="sidebar-link">对阶</a></li><li class="sidebar-sub-header"><a href="/pages/js/float.html#求和" class="sidebar-link">求和</a></li><li class="sidebar-sub-header"><a href="/pages/js/float.html#规范化" class="sidebar-link">规范化</a></li><li class="sidebar-sub-header"><a href="/pages/js/float.html#小结" class="sidebar-link">小结</a></li></ul></li><li><a href="/pages/js/float.html#_1-005-tofixed-2" class="sidebar-link">1.005.toFixed(2)</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/js/float.html#number-max-value-1-不是-infinity" class="sidebar-link">Number.MAX_VALUE + 1 不是 Infinity</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/js/float.html#number-max-value-1-number-max-value" class="sidebar-link">Number.MAXVALUE + 1 === Number.MAXVALUE</a></li><li class="sidebar-sub-header"><a href="/pages/js/float.html#_2-970" class="sidebar-link">2 ^ 970</a></li><li class="sidebar-sub-header"><a href="/pages/js/float.html#number-max-value-2-970-infinity" class="sidebar-link">Number.MAX_VALUE + 2 ^ 970 === Infinity</a></li></ul></li><li><a href="/pages/js/float.html#参考" class="sidebar-link">参考</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/js/float.html#🎉-写在最后" class="sidebar-link">🎉 写在最后</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="javascript-浮点数陷阱"><a href="#javascript-浮点数陷阱" class="header-anchor">#</a> JavaScript 浮点数陷阱</h1> <p><img src="/js/float/banner.jpg" alt=""></p> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>  ;<code>JavaScript</code>中的浮点数经常会有奇怪的运算结果，例如<code>0.1 + 0.2 != 0.3</code>或者是<code>1.005.toFixed(2)</code>结果为<code>1.00</code>，又或者<code>Number.MAX_VALUE</code>与<code>Number.MAX_SAFE_INTEGER</code>的区别等等。</p> <p>  此处对<code>JavaScript</code>浮点数的存储标准和以上疑问做了比较细致的整理，希望对你有用。</p> <h2 id="ieee-754"><a href="#ieee-754" class="header-anchor">#</a> IEEE 754</h2> <p>  ;<code>JavaScript</code>与其它语言不同，<code>Number</code>类型是不区分整型和浮点的。对于所有的数字包括整数和小数相同存储，遵循<code>IEEE 754</code>的双精度标准，<code>64</code>位固定长度，也即是常说的<code>double</code>类型。</p> <p>  由于整数和小数都采用<code>64</code>位存储，对于内存来说整型和浮点型也就没有区别了。</p> <blockquote><p>位运算上，会将操作数转为<code>32</code>位有符号数，小数部分直接丢弃</p></blockquote> <p>  ;<code>64</code>位比特包括三个部分。</p> <ul><li>符号位（<code>S</code>，<code>sign</code>）：第<code>63</code>位，<code>0</code>表示正数，<code>1</code>表示负数</li> <li>指数位（<code>E</code>，<code>exponent</code>）：第<code>52</code>到<code>62</code>位，共<code>11</code>位，取值范围为<code>0~2047</code>。但是指数位是可以为负数的，偏移<code>2023</code>后取值范围变为<code>[-1023, 1024]</code></li> <li>尾数位（<code>M</code>，<code>mantissa</code>）：第<code>0</code>到<code>51</code>位，共<code>52</code>位。</li></ul> <p><img src="/js/float/ieee.png" alt=""></p> <p>  计算公式为。</p> <div class="math"><span class="latex"></span></div> <p>  ;<code>11.25</code>的<code>64</code>位表示。</p> <ul><li>将整数和小数部分转换成二进制，即<code>11.25 = 1011.01</code></li> <li>移动小数点，使其位于第<code>1</code>、<code>2</code>位之间，规范化为<code>1.01101 * 2 ^ 3</code></li> <li><code>11.25</code>为正数，<code>S = 0</code>。另外指数为<code>3</code>，则<code>E = 1023 + 3 = 1026</code>，即<code>100 0000 0010</code></li> <li>舍去整数部分<code>1</code>，剩下尾数部分<code>01101</code>，空位补<code>0</code>，即<code>0110 1000 ... 0000</code>（<code>52</code>位）</li> <li><code>11.25</code>的<code>64</code>位浮点数的二进制表示为<code>0 10000000010 01101000...0000</code></li></ul> <p><img src="/js/float/11.25.png" alt=""></p> <p>  (<a href="http://www.binaryconvert.com/convert_double.html" target="_blank" rel="noopener noreferrer">图片来源<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)</p> <blockquote><p>规范化后的整数部分必然为<code>1</code>，存储时可以省略，只记录小数点之后的部分, 也就节约了一位内存</p></blockquote> <h2 id="就近舍入"><a href="#就近舍入" class="header-anchor">#</a> 就近舍入</h2> <p>  在四舍五入中，<code>0 ~ 9</code>十个数，<code>0</code>比较特殊，不会存在舍去的情况，舍不舍去都是当前数。而剩下的<code>9</code>个数中，<code>1 ~ 4</code>舍去，<code>5 ~ 9</code>上入，概率上舍去为<code>4 / 9</code>，上入为<code>5 / 9</code>，因此并不是公平的。</p> <p>  就近舍入，或者叫银行家舍入，是四舍六入五成双。即<code>1 ~ 4</code>舍去，<code>6 ~ 9</code>上入，<code>5</code>的情况则看前一位是奇数还是偶数，偶数则舍去，奇数则上入，因此概率都是<code>50%</code>，更加合理。</p> <p>  二进制中的就近舍入，其中<code>1001</code>大于<code>1000</code>则上入<code>1</code>，<code>0111</code>小于<code>1000</code>则舍去，而对于<code>1000</code>的情况，看前一位是奇数还是偶数，若为<code>0</code>则舍去，为<code>1</code>则上入<code>1</code>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">1.001</span> <span class="token number">1001</span> <span class="token comment">// 1.010</span>
<span class="token number">1.001</span> <span class="token number">0111</span> <span class="token comment">// 1.001</span>
<span class="token number">1.001</span> <span class="token number">1000</span> <span class="token comment">// 1.010</span>

<span class="token number">1.100</span> <span class="token number">1001</span> <span class="token comment">// 1.101</span>
<span class="token number">1.100</span> <span class="token number">0111</span> <span class="token comment">// 1.100</span>
<span class="token number">1.100</span> <span class="token number">1000</span> <span class="token comment">// 1.100</span>
</code></pre></div><h2 id="number-max-value"><a href="#number-max-value" class="header-anchor">#</a> Number.MAX_VALUE</h2> <p>  ;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Number/MAX_VALUE" target="_blank" rel="noopener noreferrer">Number.MAX_VALUE<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 即<code>JavaScript</code>中所能表示的最大数值。</p> <p>  按照<code>IEEE 754</code>的<code>64</code>位标准，可以明显想到以下表示。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">0</span> <span class="token number">11111111111</span> <span class="token number">1111111111111111111111111111111111111111111111111111</span>
</code></pre></div><p>  但是注意指数位全为<code>1</code>用来表示<code>NaN</code>或<code>Infinity</code>，因此指数位最大为<code>111 1111 1110</code>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">0</span> <span class="token number">11111111110</span> <span class="token number">1111111111111111111111111111111111111111111111111111</span>
</code></pre></div><p>  转为十进制。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token number">1.1111111111111111111111111111111111111111111111111111</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token number">2046</span> <span class="token operator">-</span> <span class="token number">1023</span><span class="token punctuation">)</span>
<span class="token operator">=</span> <span class="token number">1.1111111111111111111111111111111111111111111111111111</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">^</span> <span class="token number">1023</span>
<span class="token operator">=</span> <span class="token number">1</span> <span class="token number">1111111111111111111111111111111111111111111111111111</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token number">1023</span> <span class="token operator">-</span> <span class="token number">52</span><span class="token punctuation">)</span>
<span class="token operator">=</span> <span class="token number">1</span> <span class="token number">1111111111111111111111111111111111111111111111111111</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">^</span> <span class="token number">971</span>
<span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">^</span> <span class="token number">53</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">^</span> <span class="token number">971</span>
<span class="token operator">=</span> <span class="token number">1.7976931348623157e+308</span>
</code></pre></div><p>  也即是<code>Number.MAX_VALUE</code>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">971</span><span class="token punctuation">)</span> <span class="token comment">// 1.7976931348623157e+308</span>
<span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">971</span><span class="token punctuation">)</span> <span class="token operator">===</span> Number<span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span> <span class="token comment">// true</span>
</code></pre></div><h2 id="number-max-safe-integer"><a href="#number-max-safe-integer" class="header-anchor">#</a> Number.MAX_SAFE_INTEGER</h2> <p>  ;<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Number/MAX_SAFE_INTEGER" target="_blank" rel="noopener noreferrer">Number.MAX_SAFE_INTEGER<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 表示<code>JavaScript</code>中最大的安全整数。</p> <p>  ;<code>Number.MAX_SAFE_INTEGER</code>二进制表示，注意指数刚好为<code>52</code>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">0</span> <span class="token number">10000110011</span> <span class="token number">1111111111111111111111111111111111111111111111111111</span>
</code></pre></div><p>  转为十进制。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token number">1.1111111111111111111111111111111111111111111111111111</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token number">1075</span> <span class="token operator">-</span> <span class="token number">1023</span><span class="token punctuation">)</span>
<span class="token operator">=</span> <span class="token number">1.1111111111111111111111111111111111111111111111111111</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">^</span> <span class="token number">52</span>
<span class="token operator">=</span> <span class="token number">1</span> <span class="token number">1111111111111111111111111111111111111111111111111111</span>
<span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">^</span> <span class="token number">53</span> <span class="token operator">-</span> <span class="token number">1</span>
<span class="token operator">=</span> <span class="token number">9007199254740991</span>
</code></pre></div><p>  然后来说说为什么叫安全整数，指的是当前整数转换为二进制时，可以完全存储在尾数位中，不会发生舍入。</p> <p>  而<code>Number.MAX_SAFE_INTEGER + 1</code>和<code>Number.MAX_SAFE_INTEGER + 2</code>都会存在舍去的情况。</p> <p>  ;<code>Number.MAX_SAFE_INTEGER + 2</code>，<code>9007199254740993</code>的二进制表示。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">100000000000000000000000000000000000000000000000000001</span>
</code></pre></div><p>  规范化。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">1.00000000000000000000000000000000000000000000000000001</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">^</span> <span class="token number">53</span>
</code></pre></div><p>  由于指数位只能容纳<code>52</code>位，低位为<code>1</code>且前一位为<code>0</code>，就近舍入时会被舍去。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">0000000000000000000000000000000000000000000000000000</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token number">0000000000000000000000000000000000000000000000000000</span>
</code></pre></div><p>  ;<code>64</code>位浮点数表示。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">0</span> <span class="token number">10000110100</span> <span class="token number">0000000000000000000000000000000000000000000000000000</span>
</code></pre></div><p>  另外<code>Number.MAX_SAFE_INTEGER + 1</code>，也会存在舍去的情况。</p> <p>  ;<code>9007199254740992</code>的浮点数表示。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">0</span> <span class="token number">10000110100</span> <span class="token number">0000000000000000000000000000000000000000000000000000</span>
</code></pre></div><p>  因此会造成以下结果。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Number<span class="token punctuation">.</span><span class="token constant">MAX_SAFE_INTEGER</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">===</span> Number<span class="token punctuation">.</span><span class="token constant">MAX_SAFE_INTEGER</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token comment">// true</span>
</code></pre></div><h2 id="_0-1-0-2-0-3"><a href="#_0-1-0-2-0-3" class="header-anchor">#</a> 0.1 + 0.2 != 0.3</h2> <h3 id="_0-1"><a href="#_0-1" class="header-anchor">#</a> 0.1</h3> <p>  先来将<code>0.1</code>转换为二进制，连续乘以<code>2</code>并取整。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">0.1</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">=</span> <span class="token number">0.2</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span> 整 <span class="token number">0</span> 余 <span class="token number">0.2</span>
<span class="token number">0.2</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">=</span> <span class="token number">0.4</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span> 整 <span class="token number">0</span> 余 <span class="token number">0.4</span>
<span class="token number">0.4</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">=</span> <span class="token number">0.8</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span> 整 <span class="token number">0</span> 余 <span class="token number">0.8</span>
<span class="token number">0.8</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">=</span> <span class="token number">1.6</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span> 整 <span class="token number">1</span> 余 <span class="token number">0.6</span>
<span class="token number">0.6</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">=</span> <span class="token number">1.2</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span> 整 <span class="token number">1</span> 余 <span class="token number">0.2</span>
<span class="token number">0.2</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">=</span> <span class="token number">0.4</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span> 整 <span class="token number">0</span> 余 <span class="token number">0.4</span>
</code></pre></div><p>  ;<code>0.1</code>的二进制表示，<code>0011</code>将无限循环下去。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">0.0</span> <span class="token number">0011</span> <span class="token number">0011</span> <span class="token number">0011</span> <span class="token punctuation">(</span><span class="token number">0011</span><span class="token punctuation">)</span>
</code></pre></div><p>  规范化，另外<code>0.1</code>为正数，<code>S = 0</code>，指数为<code>-4 + 1023 = 1019</code>，即<code>011 1111 1011</code>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">1.1</span> <span class="token number">0011</span> <span class="token number">0011</span> <span class="token punctuation">(</span><span class="token number">0011</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">^</span> <span class="token operator">-</span><span class="token number">4</span>
</code></pre></div><p>  尾数位最多存储<code>52</code>位，且采用就近舍入模式，向前进<code>1</code>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">1001100110011001100110011001100110011001100110011001</span><span class="token punctuation">(</span><span class="token number">10011</span><span class="token punctuation">)</span>
<span class="token number">1001100110011001100110011001100110011001100110011010</span>
</code></pre></div><p>  ;<code>0.1</code>的<code>64</code>位浮点数表示。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">0</span> <span class="token number">01111111011</span> <span class="token number">1001100110011001100110011001100110011001100110011010</span>
</code></pre></div><p><img src="/js/float/0.1.png" alt=""></p> <h3 id="_0-2"><a href="#_0-2" class="header-anchor">#</a> 0.2</h3> <p>  ;<code>0.2</code>的二进制。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">0.0011</span> <span class="token number">0011</span> <span class="token number">0011</span> <span class="token punctuation">(</span><span class="token number">0011</span><span class="token punctuation">)</span>
</code></pre></div><p>  规范化<code>0.2</code>，<code>S = 0</code>，指数为<code>-3 + 1023 = 1020</code>，即<code>011 1111 1100</code>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">1.1</span> <span class="token number">0011</span> <span class="token number">0011</span> <span class="token punctuation">(</span><span class="token number">0011</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">^</span> <span class="token operator">-</span><span class="token number">3</span>
</code></pre></div><p>  存储<code>52</code>位，其余舍去，向前进<code>1</code>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">1001100110011001100110011001100110011001100110011001</span><span class="token punctuation">(</span><span class="token number">10011</span><span class="token punctuation">)</span> 
<span class="token number">1001100110011001100110011001100110011001100110011010</span>
</code></pre></div><p>  ;<code>0.2</code>的<code>64</code>位浮点数表示。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">0</span> <span class="token number">01111111100</span> <span class="token number">1001100110011001100110011001100110011001100110011010</span>
</code></pre></div><p><img src="/js/float/0.2.png" alt=""></p> <p>  因此实际上<code>0.1</code>和<code>0.2</code>转换为<code>64</code>位的双精度浮点数时，都存在精度损失。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">0</span> <span class="token number">01111111011</span> <span class="token number">1001100110011001100110011001100110011001100110011010</span> <span class="token comment">// 0.1</span>
<span class="token number">0</span> <span class="token number">01111111100</span> <span class="token number">1001100110011001100110011001100110011001100110011010</span> <span class="token comment">// 0.2</span>
</code></pre></div><blockquote><p>浮点数运算三步骤，对阶、求和、规范化</p></blockquote> <h3 id="对阶"><a href="#对阶" class="header-anchor">#</a> 对阶</h3> <p>  ;<code>0.1</code>和<code>0.2</code>的指数部分阶次不一致，要先统一阶次，且遵循小阶向大阶看齐的原则。</p> <p>  比如十进制的<code>1.5 * 10 ^ 10 + 1.23 * 10 ^ 13</code>，保留小数点前后<code>1</code>位。</p> <ul><li>大阶向小阶看齐时，即<code>1.5 * 10 ^ 10 + 1230 * 10 ^ 10</code>，结果为<code>1231.5 * 10 ^ 10</code>，规则舍弃后为<code>1.5 * 10 ^ 10</code></li> <li>小阶向大阶看齐时，即<code>0.0015 * 10 ^ 13 + 1.23 * 10 ^ 13</code>，结果为<code>1.2315 * 10 ^ 13</code>，规则舍弃后为<code>1.2 * 10 ^ 13</code></li></ul> <p>  明显看到小阶向大阶更能接近实际结果。另外阶次若加<code>1</code>，尾数位就要右移<code>1</code>位，阶次相同时对阶完成。</p> <p>  为什么阶次加<code>1</code>尾数位就右移<code>1</code>位呢？</p> <p>  ;<code>0.1</code>的<code>64</code>位浮点数表示，值为<code>1.1001 1001 ... 1001 1001 1010 * 2 ^ -4</code>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">0</span> <span class="token number">01111111011</span> <span class="token punctuation">(</span><span class="token number">1.</span><span class="token punctuation">)</span><span class="token number">1001100110011001100110011001100110011001100110011010</span>
</code></pre></div><p>  此处若阶次加<code>1</code>，要保持值大小不变，小数点要左移<code>1</code>位，即<code>0.1 1001 1001 ... 1001 1001 1010 * 2 ^ -3</code>，也就相当于尾数位右移<code>1</code>位。右移后空位补<code>1</code>，也就是省略的整数部分的<code>1</code>。注意若还要右移，空位只能补<code>0</code>，原因在于整数部分后续都是<code>0</code>了。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">0</span> <span class="token number">01111111110</span> <span class="token punctuation">(</span><span class="token number">0.</span><span class="token punctuation">)</span><span class="token number">1100110011001100110011001100110011001100110011001101</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre></div><p>  因此对阶过程如下，由于低位为<code>0</code>，可以省去。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">0</span> <span class="token number">01111111011</span> <span class="token number">1001100110011001100110011001100110011001100110011010</span> <span class="token comment">// 0.1</span>
<span class="token number">0</span> <span class="token number">01111111100</span>  <span class="token number">100110011001100110011001100110011001100110011001101</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// 阶次加 1，尾数位右移 1 位</span>
<span class="token number">0</span> <span class="token number">01111111100</span> <span class="token number">1100110011001100110011001100110011001100110011001101</span> <span class="token comment">// 空位补 1</span>
</code></pre></div><blockquote><p>注意尾数位右移是将低位移出，会损失一定的精度，为了减小误差，将保留若干移出的位，在以后的规范化时再做舍入</p></blockquote> <h3 id="求和"><a href="#求和" class="header-anchor">#</a> 求和</h3> <p>  阶数相同，开始求和。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token number">0</span> <span class="token number">01111111100</span> <span class="token number">1100110011001100110011001100110011001100110011001101</span> <span class="token comment">// 0.1</span>
<span class="token operator">+</span> <span class="token number">0</span> <span class="token number">01111111100</span> <span class="token number">1001100110011001100110011001100110011001100110011010</span> <span class="token comment">// 0.2</span>
</code></pre></div><p>  更好理解的方式，注意尾数位产生了进位。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token number">0.1100110011001100110011001100110011001100110011001101</span>
<span class="token operator">+</span> <span class="token number">1.1001100110011001100110011001100110011001100110011010</span>
 <span class="token number">10.0110011001100110011001100110011001100110011001100111</span>
</code></pre></div><h3 id="规范化"><a href="#规范化" class="header-anchor">#</a> 规范化</h3> <p>  求和结果为<code>10.0 1100 1100 ... 1100 1100 111 * 2 ^ -3</code>，即<code>1.00 1100 1100 ... 1100 1100 111 * 2 ^ -2</code>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">1.00110011001100110011001100110011001100110011001100111</span>
</code></pre></div><p>  由于指数位只能容纳<code>52</code>位，就近舍入后向前进<code>1</code>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">0011001100110011001100110011001100110011001100110011</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token number">0011001100110011001100110011001100110011001100110100</span>
</code></pre></div><p>  ;<code>IEEE 754</code>的双精度<code>64</code>位表示。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">0</span> <span class="token number">01111111101</span> <span class="token number">0011001100110011001100110011001100110011001100110100</span>
</code></pre></div><p>  即<code>1.0011 0011 ... 0011 0011 0100 * 2 ^ -2</code>，转换为十进制也就是<code>0.30000000000000004</code>。</p> <h3 id="小结"><a href="#小结" class="header-anchor">#</a> 小结</h3> <p>  要明确的是，诸如<code>0.1</code>、<code>0.2</code>之类的数，虽然在十进制中能非常清晰地表达，但是在二进制中却是无穷尽的，无法精确表示。而<code>JavaScript</code>遵循<code>IEEE 754</code>的双精度标准，仅<code>64</code>位，进制的转换中要舍弃低位来存储，因此必然存在精度丢失。</p> <p>  另外在相加的过程中，对阶、求和、规范化都可能存在舍入，也会存在精度的丢失。</p> <h2 id="_1-005-tofixed-2"><a href="#_1-005-tofixed-2" class="header-anchor">#</a> 1.005.toFixed(2)</h2> <p>  ;<code>1.005</code>的二进制表示，<code>0000 1010 0011 1101 0111</code>将无限循环下去。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">1.000</span> <span class="token punctuation">(</span><span class="token number">0000</span> <span class="token number">1010</span> <span class="token number">0011</span> <span class="token number">1101</span> <span class="token number">0111</span><span class="token punctuation">)</span>
</code></pre></div><p>  ;<code>IEEE 754</code>的双精度<code>64</code>位表示。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">0</span> <span class="token number">01111111111</span> <span class="token number">0000000101000111101011100001010001111010111000010100</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token number">0</span> <span class="token number">01111111111</span> <span class="token number">0000000101000111101011100001010001111010111000010100</span>
</code></pre></div><p>  ;<code>1.005</code>截断后面位数后，已经小于<code>1.005</code>，利用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Number/toPrecision" target="_blank" rel="noopener noreferrer">Number.prototype.toPrecision<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 来看下<code>1.005</code>的<code>20</code>位精度。</p> <p><img src="/js/float/1.005.png" alt=""></p> <p>  因此<code>toFixed</code>保留两位小数，四舍五入时。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">1.005</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// 1.00</span>
</code></pre></div><h2 id="number-max-value-1-不是-infinity"><a href="#number-max-value-1-不是-infinity" class="header-anchor">#</a> Number.MAX_VALUE + 1 不是 Infinity</h2> <h3 id="number-max-value-1-number-max-value"><a href="#number-max-value-1-number-max-value" class="header-anchor">#</a> Number.MAX_VALUE + 1 === Number.MAX_VALUE</h3> <p>  ;<code>Number.MAX_VALUE</code>与<code>1</code>的<code>64</code>位浮点数表示为。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">0</span> <span class="token number">11111111110</span> <span class="token number">1111111111111111111111111111111111111111111111111111</span> <span class="token comment">// Number.MAX_VALUE</span>
<span class="token number">0</span> <span class="token number">01111111111</span> <span class="token number">0000000000000000000000000000000000000000000000000000</span> <span class="token comment">// 1</span>
</code></pre></div><p>  相加对阶时<code>1</code>的阶数将由<code>0</code>升到<code>1023</code>，尾数位将右移<code>1023</code>位。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token number">0</span> <span class="token number">11111111110</span> <span class="token number">1111111111111111111111111111111111111111111111111111</span> <span class="token comment">// Number.MAX_VALUE</span>
<span class="token operator">+</span> <span class="token number">0</span> <span class="token number">11111111110</span> <span class="token number">0000000000000000000000000000000000000000000000000000</span><span class="token punctuation">(</span><span class="token number">000.</span><span class="token punctuation">.</span><span class="token number">.0001</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
</code></pre></div><p>  求和。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token number">1.1111111111111111111111111111111111111111111111111111</span>
<span class="token operator">+</span> <span class="token number">0.0000000000000000000000000000000000000000000000000000</span><span class="token punctuation">(</span><span class="token number">000.</span><span class="token punctuation">.</span><span class="token number">.0001</span><span class="token punctuation">)</span>
  <span class="token number">1.1111111111111111111111111111111111111111111111111111</span><span class="token punctuation">(</span><span class="token number">000.</span><span class="token punctuation">.</span><span class="token number">.0001</span><span class="token punctuation">)</span>
</code></pre></div><p>  规范化时低位将舍弃，实际相当于<code>Number.MAX_VALUE</code>加<code>0</code>，所以会有以下结果。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Number<span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">===</span> Number<span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span> <span class="token comment">// true</span>
</code></pre></div><h3 id="_2-970"><a href="#_2-970" class="header-anchor">#</a> 2 ^ 970</h3> <p>  那到底<code>Number.MAX_VALUE</code>加上多少等于<code>Infinity</code>呢？</p> <p>  按照<code>IEEE 754</code>的规范，只要大于等于以下数，就会被表示为<code>Infinity</code>。</p> <div class="math"><span class="latex"></span></div> <p>  ;<code>64</code>位浮点数中，<code>E<sub>max</sub></code>为<code>1023</code>，<code>p</code>为<code>53</code>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token number">2</span> <span class="token operator">^</span> <span class="token number">1023</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token number">53</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">^</span> <span class="token number">1023</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">^</span> <span class="token operator">-</span><span class="token number">53</span><span class="token punctuation">)</span>
<span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">^</span> <span class="token number">970</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">^</span> <span class="token number">54</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre></div><p>  此结果与<code>Number.MAX_VALUE</code>差值为。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">^</span> <span class="token number">54</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">^</span> <span class="token number">970</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">^</span> <span class="token number">53</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">^</span> <span class="token number">971</span>
<span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">^</span> <span class="token number">970</span>
</code></pre></div><p>  因此<code>Number.MAX_VALUE</code>至少加上<code>2 ^ 970</code>才能等于<code>Infinity</code>。</p> <h3 id="number-max-value-2-970-infinity"><a href="#number-max-value-2-970-infinity" class="header-anchor">#</a> Number.MAX_VALUE + 2 ^ 970 === Infinity</h3> <p>  ;<code>Number.MAX_VALUE</code>与<code>2 ^ 970</code>的<code>64</code>位浮点数表示。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">0</span> <span class="token number">11111111110</span> <span class="token number">1111111111111111111111111111111111111111111111111111</span> <span class="token comment">// Number.MAX_VALUE</span>
<span class="token number">0</span> <span class="token number">11111001001</span> <span class="token number">0000000000000000000000000000000000000000000000000000</span> <span class="token comment">// 2 ^ 970</span>
</code></pre></div><p>  相加对阶时<code>2 ^ 970</code>阶数将由<code>970</code>升到<code>1023</code>，差值为<code>53</code>，尾数位将右移<code>53</code>位。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token number">0</span> <span class="token number">11111111110</span> <span class="token number">1111111111111111111111111111111111111111111111111111</span> <span class="token comment">// Number.MAX_VALUE</span>
<span class="token operator">+</span> <span class="token number">0</span> <span class="token number">11111111110</span> <span class="token number">0000000000000000000000000000000000000000000000000000</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 2 ^ 970</span>
</code></pre></div><p>  求和，就近舍入时，低位舍入，向前进<code>1</code>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token number">1.1111111111111111111111111111111111111111111111111111</span>
<span class="token operator">+</span> <span class="token number">0.0000000000000000000000000000000000000000000000000000</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token number">1.1111111111111111111111111111111111111111111111111111</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
 <span class="token number">10.0000000000000000000000000000000000000000000000000000</span>
</code></pre></div><p>  注意尾数位产生了进位，指数位则加<code>1</code>，尾数位右移<code>1</code>位。</p> <p>  结果的<code>64</code>位浮点数表示，而以下表示实际就是<code>Infinity</code>的<code>64</code>位浮点数表示。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">0</span> <span class="token number">11111111111</span> <span class="token number">0000000000000000000000000000000000000000000000000000</span>
</code></pre></div><h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <ul><li><a href="https://github.com/camsong/blog/issues/9" target="_blank" rel="noopener noreferrer">JavaScript 浮点数陷阱及解法<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://0.30000000000000004.com/" target="_blank" rel="noopener noreferrer">0.30000000000000004<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/qufei1993/Nodejs-Roadmap/blob/master/docs/javascript/floating-point-number-0.1-0.2.md" target="_blank" rel="noopener noreferrer">0.1 + 0.2 为什么不等于 0.3？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://zhuanlan.zhihu.com/p/343040291" target="_blank" rel="noopener noreferrer">为什么说 32 位浮点数的精度是 7 位有效数<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.zhihu.com/question/24423421" target="_blank" rel="noopener noreferrer">为什么 Number.MAX_VALUE + 1 不是 Infinity?<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="🎉-写在最后"><a href="#🎉-写在最后" class="header-anchor">#</a> 🎉 写在最后</h2> <p>🍻伙伴们，如果你已经看到了这里，觉得这篇文章有帮助到你的话不妨点赞👍或 <a href="https://github.com/dongwei1125/blog" target="_blank" rel="noopener noreferrer">Star<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ✨支持一下哦！</p> <p>手动码字，如有错误，欢迎在评论区指正💬~</p> <p>你的支持就是我更新的最大动力💪~</p> <p><a href="https://github.com/dongwei1125" target="_blank" rel="noopener noreferrer">GitHub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> / <a href="https://gitee.com/dongwei1125" target="_blank" rel="noopener noreferrer">Gitee<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<a href="https://dongwei1125.github.io/" target="_blank" rel="noopener noreferrer">GitHub Pages<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<a href="https://juejin.cn/user/2621689331987783" target="_blank" rel="noopener noreferrer">掘金<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<a href="https://blog.csdn.net/Don_GW" target="_blank" rel="noopener noreferrer">CSDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 同步更新，欢迎关注😉~</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间:</span> <span class="time">3/31/2022, 9:42:00 PM</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.0aa97f73.js" defer></script><script src="/assets/js/2.f850a8ef.js" defer></script><script src="/assets/js/41.6cdce4cf.js" defer></script><script src="/assets/js/3.31ebf682.js" defer></script>
  </body>
</html>
