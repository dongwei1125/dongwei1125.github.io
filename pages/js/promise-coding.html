<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>å‚è€ƒ Promise/A+ è§„èŒƒå’Œæµ‹è¯•ç”¨ä¾‹æ‰‹å†™ Promise | DonV</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/header.jpg">
    <meta name="description" content="A paper about JavaScript, HTML and CSS.">
    
    <link rel="preload" href="/assets/css/0.styles.87611319.css" as="style"><link rel="preload" href="/assets/js/app.0aa97f73.js" as="script"><link rel="preload" href="/assets/js/2.f850a8ef.js" as="script"><link rel="preload" href="/assets/js/46.29956259.js" as="script"><link rel="prefetch" href="/assets/js/10.cb041c1b.js"><link rel="prefetch" href="/assets/js/11.1aadbcee.js"><link rel="prefetch" href="/assets/js/12.77cc8e56.js"><link rel="prefetch" href="/assets/js/13.7e8162d9.js"><link rel="prefetch" href="/assets/js/14.dea6ba67.js"><link rel="prefetch" href="/assets/js/15.a786d687.js"><link rel="prefetch" href="/assets/js/16.163edf25.js"><link rel="prefetch" href="/assets/js/17.3a0232cb.js"><link rel="prefetch" href="/assets/js/18.91bd2dd7.js"><link rel="prefetch" href="/assets/js/19.a36993f8.js"><link rel="prefetch" href="/assets/js/20.30dd9f79.js"><link rel="prefetch" href="/assets/js/21.5e3c83a3.js"><link rel="prefetch" href="/assets/js/22.88d5e321.js"><link rel="prefetch" href="/assets/js/23.b54a65a7.js"><link rel="prefetch" href="/assets/js/24.51df379f.js"><link rel="prefetch" href="/assets/js/25.79342bd2.js"><link rel="prefetch" href="/assets/js/26.643d5441.js"><link rel="prefetch" href="/assets/js/27.54b7d7b4.js"><link rel="prefetch" href="/assets/js/28.d01a4aee.js"><link rel="prefetch" href="/assets/js/29.7d932073.js"><link rel="prefetch" href="/assets/js/3.31ebf682.js"><link rel="prefetch" href="/assets/js/30.4c2f5636.js"><link rel="prefetch" href="/assets/js/31.b00c42d5.js"><link rel="prefetch" href="/assets/js/32.e9a0f488.js"><link rel="prefetch" href="/assets/js/33.f510b5fd.js"><link rel="prefetch" href="/assets/js/34.6e78f32f.js"><link rel="prefetch" href="/assets/js/35.04d666a2.js"><link rel="prefetch" href="/assets/js/36.900a3beb.js"><link rel="prefetch" href="/assets/js/37.19ddf8d7.js"><link rel="prefetch" href="/assets/js/38.35f899bd.js"><link rel="prefetch" href="/assets/js/39.fe9ea525.js"><link rel="prefetch" href="/assets/js/4.3c7083a8.js"><link rel="prefetch" href="/assets/js/40.0d116ce0.js"><link rel="prefetch" href="/assets/js/41.6cdce4cf.js"><link rel="prefetch" href="/assets/js/42.ab0bd0d5.js"><link rel="prefetch" href="/assets/js/43.66c8f8eb.js"><link rel="prefetch" href="/assets/js/44.ac02981e.js"><link rel="prefetch" href="/assets/js/45.479814b0.js"><link rel="prefetch" href="/assets/js/47.a89cf7d2.js"><link rel="prefetch" href="/assets/js/48.859e3502.js"><link rel="prefetch" href="/assets/js/49.d0fa0b25.js"><link rel="prefetch" href="/assets/js/5.206809f3.js"><link rel="prefetch" href="/assets/js/50.d051084c.js"><link rel="prefetch" href="/assets/js/51.fa831e6a.js"><link rel="prefetch" href="/assets/js/52.3ed98760.js"><link rel="prefetch" href="/assets/js/53.016b1c3c.js"><link rel="prefetch" href="/assets/js/54.c88e06c5.js"><link rel="prefetch" href="/assets/js/55.937bfe09.js"><link rel="prefetch" href="/assets/js/56.03003660.js"><link rel="prefetch" href="/assets/js/57.8bcda68a.js"><link rel="prefetch" href="/assets/js/58.286692ba.js"><link rel="prefetch" href="/assets/js/59.fbfe98aa.js"><link rel="prefetch" href="/assets/js/6.6f9d9bda.js"><link rel="prefetch" href="/assets/js/60.0975844e.js"><link rel="prefetch" href="/assets/js/61.0af6cf48.js"><link rel="prefetch" href="/assets/js/62.66c23699.js"><link rel="prefetch" href="/assets/js/63.7fda9b3f.js"><link rel="prefetch" href="/assets/js/7.6f64fba1.js"><link rel="prefetch" href="/assets/js/8.a163349f.js"><link rel="prefetch" href="/assets/js/9.9058d3cc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.87611319.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/header.jpg" alt="DonV" class="logo"> <span class="site-name can-hide">DonV</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><a href="/pages/js/nav.html" class="nav-link">
  JavaScript
</a></div><div class="nav-item"><a href="/pages/html/nav.html" class="nav-link">
  HTML
</a></div><div class="nav-item"><a href="/pages/css/nav.html" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/pages/other/nav.html" class="nav-link">
  å…¶å®ƒ
</a></div><div class="nav-item"><a href="/pages/app/nav.html" class="nav-link">
  åº”ç”¨
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å…³äº" class="dropdown-title"><span class="title">å…³äº</span> <span class="arrow down"></span></button> <button type="button" aria-label="å…³äº" class="mobile-dropdown-title"><span class="title">å…³äº</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/dongwei1125" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/dongwei1125" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/2621689331987783" target="_blank" rel="noopener noreferrer" class="nav-link external">
  æ˜é‡‘
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/Don_GW" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/~dongwei1125" target="_blank" rel="noopener noreferrer" class="nav-link external">
  NPM
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><a href="/pages/js/nav.html" class="nav-link">
  JavaScript
</a></div><div class="nav-item"><a href="/pages/html/nav.html" class="nav-link">
  HTML
</a></div><div class="nav-item"><a href="/pages/css/nav.html" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/pages/other/nav.html" class="nav-link">
  å…¶å®ƒ
</a></div><div class="nav-item"><a href="/pages/app/nav.html" class="nav-link">
  åº”ç”¨
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å…³äº" class="dropdown-title"><span class="title">å…³äº</span> <span class="arrow down"></span></button> <button type="button" aria-label="å…³äº" class="mobile-dropdown-title"><span class="title">å…³äº</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/dongwei1125" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/dongwei1125" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/2621689331987783" target="_blank" rel="noopener noreferrer" class="nav-link external">
  æ˜é‡‘
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/Don_GW" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/~dongwei1125" target="_blank" rel="noopener noreferrer" class="nav-link external">
  NPM
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>å‚è€ƒ Promise/A+ è§„èŒƒå’Œæµ‹è¯•ç”¨ä¾‹æ‰‹å†™ Promise</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/js/promise-coding.html#å‰è¨€" class="sidebar-link">å‰è¨€</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/js/promise-coding.html#ç–‘é—®" class="sidebar-link">ç–‘é—®</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/js/promise-coding.html#ä»€ä¹ˆæ˜¯-promise-a-è§„èŒƒ" class="sidebar-link">ä»€ä¹ˆæ˜¯ Promise/A+ è§„èŒƒï¼Ÿ</a></li><li class="sidebar-sub-header"><a href="/pages/js/promise-coding.html#åŸç”Ÿ-promise-å®ç°äº†-promise-a" class="sidebar-link">åŸç”Ÿ Promise å®ç°äº† Promise/A+ï¼Ÿ</a></li><li class="sidebar-sub-header"><a href="/pages/js/promise-coding.html#å¦‚ä½•æ„å»ºå¼‚æ­¥ä»»åŠ¡" class="sidebar-link">å¦‚ä½•æ„å»ºå¼‚æ­¥ä»»åŠ¡ï¼Ÿ</a></li><li class="sidebar-sub-header"><a href="/pages/js/promise-coding.html#å¦‚ä½•åˆ›å»º-promise" class="sidebar-link">å¦‚ä½•åˆ›å»º promiseï¼Ÿ</a></li></ul></li><li><a href="/pages/js/promise-coding.html#æ‰‹å†™" class="sidebar-link">æ‰‹å†™</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/js/promise-coding.html#å®ä¾‹åˆå§‹å±æ€§" class="sidebar-link">å®ä¾‹åˆå§‹å±æ€§</a></li><li class="sidebar-sub-header"><a href="/pages/js/promise-coding.html#executor-æ‰§è¡Œå™¨" class="sidebar-link">executor æ‰§è¡Œå™¨</a></li><li class="sidebar-sub-header"><a href="/pages/js/promise-coding.html#çŠ¶æ€ä¸å¯å˜æ€§" class="sidebar-link">çŠ¶æ€ä¸å¯å˜æ€§</a></li><li class="sidebar-sub-header"><a href="/pages/js/promise-coding.html#æ–¹æ³•ä¼ å‚" class="sidebar-link">æ–¹æ³•ä¼ å‚</a></li><li class="sidebar-sub-header"><a href="/pages/js/promise-coding.html#then-æ–¹æ³•" class="sidebar-link">then æ–¹æ³•</a></li><li class="sidebar-sub-header"><a href="/pages/js/promise-coding.html#å¼‚æ­¥-executor" class="sidebar-link">å¼‚æ­¥ executor</a></li><li class="sidebar-sub-header"><a href="/pages/js/promise-coding.html#å¤šæ¬¡è°ƒç”¨-then" class="sidebar-link">å¤šæ¬¡è°ƒç”¨ then</a></li><li class="sidebar-sub-header"><a href="/pages/js/promise-coding.html#è¿”å›-promise" class="sidebar-link">è¿”å› promise</a></li><li class="sidebar-sub-header"><a href="/pages/js/promise-coding.html#å‡½æ•°å‚æ•°è¿”å›å€¼" class="sidebar-link">å‡½æ•°å‚æ•°è¿”å›å€¼</a></li><li class="sidebar-sub-header"><a href="/pages/js/promise-coding.html#å¤„ç†å‡½æ•°" class="sidebar-link">å¤„ç†å‡½æ•°</a></li><li class="sidebar-sub-header"><a href="/pages/js/promise-coding.html#æŠ›å‡ºå¼‚å¸¸" class="sidebar-link">æŠ›å‡ºå¼‚å¸¸</a></li><li class="sidebar-sub-header"><a href="/pages/js/promise-coding.html#å¼‚æ­¥ä»»åŠ¡" class="sidebar-link">å¼‚æ­¥ä»»åŠ¡</a></li><li class="sidebar-sub-header"><a href="/pages/js/promise-coding.html#å‚æ•°ä¼˜åŒ–" class="sidebar-link">å‚æ•°ä¼˜åŒ–</a></li></ul></li><li><a href="/pages/js/promise-coding.html#ç±»å‹" class="sidebar-link">ç±»å‹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/js/promise-coding.html#å¾ªç¯å¼•ç”¨" class="sidebar-link">å¾ªç¯å¼•ç”¨</a></li><li class="sidebar-sub-header"><a href="/pages/js/promise-coding.html#ä¼ é€’æ€§" class="sidebar-link">ä¼ é€’æ€§</a></li><li class="sidebar-sub-header"><a href="/pages/js/promise-coding.html#å¹¿ä¹‰å¯¹è±¡" class="sidebar-link">å¹¿ä¹‰å¯¹è±¡</a></li><li class="sidebar-sub-header"><a href="/pages/js/promise-coding.html#ä¼˜å…ˆçº§" class="sidebar-link">ä¼˜å…ˆçº§</a></li><li class="sidebar-sub-header"><a href="/pages/js/promise-coding.html#thenable" class="sidebar-link">thenable</a></li></ul></li><li><a href="/pages/js/promise-coding.html#æµ‹è¯•" class="sidebar-link">æµ‹è¯•</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/js/promise-coding.html#å°ç»“" class="sidebar-link">å°ç»“</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/js/promise-coding.html#æ‰©å±•" class="sidebar-link">æ‰©å±•</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/js/promise-coding.html#å‚è€ƒ" class="sidebar-link">å‚è€ƒ</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/js/promise-coding.html#ğŸ‰-å†™åœ¨æœ€å" class="sidebar-link">ğŸ‰ å†™åœ¨æœ€å</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="å‚è€ƒ-promise-a-è§„èŒƒå’Œæµ‹è¯•ç”¨ä¾‹æ‰‹å†™-promise"><a href="#å‚è€ƒ-promise-a-è§„èŒƒå’Œæµ‹è¯•ç”¨ä¾‹æ‰‹å†™-promise" class="header-anchor">#</a> å‚è€ƒ Promise/A+ è§„èŒƒå’Œæµ‹è¯•ç”¨ä¾‹æ‰‹å†™ Promise</h1> <p><img src="/js/promise-coding/banner.jpg" alt=""></p> <h2 id="å‰è¨€"><a href="#å‰è¨€" class="header-anchor">#</a> å‰è¨€</h2> <p>â€ƒâ€ƒè¿™å¯èƒ½æ˜¯æ‰‹å†™<code>promise</code>è¾ƒæ¸…æ™°çš„æ–‡ç« ä¹‹ä¸€ã€‚</p> <p>â€ƒâ€ƒç”±æµ…è‡³æ·±é€æ­¥åˆ†æäº†åŸç”Ÿæµ‹è¯•ç”¨ä¾‹ï¼Œä»¥åŠç›¸å…³<code>Promise/A+</code>è§„èŒƒã€‚é˜…è¯»ä¸Šæ¨èä»¥ç–‘é—®ç« èŠ‚ä¸ºåˆ‡å…¥é‡ç‚¹ï¼Œå¯¹æ¯”<code>Promise/A+</code>è§„èŒƒä¸<code>ECMAScript</code>è§„èŒƒçš„å†…åœ¨åŒºåˆ«ä¸è”ç³»ï¼Œç¡®å®šæ€æ ·æ„å»ºå¼‚æ­¥ä»»åŠ¡å’Œåˆ›å»º<code>promise</code>å®ä¾‹ã€‚ç„¶åå¼€å§‹æ‰‹å†™ç« èŠ‚ï¼Œè¿‡ç¨‹ä¸­ä»£ç ä¸æµ‹è¯•å¯å‚è€ƒ <a href="https://github.com/dongwei1125/promise-coding" target="_blank" rel="noopener noreferrer">promise-coding<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ä»“åº“ã€‚</p> <p>â€ƒâ€ƒä¹Ÿè¯•ç€å›ç­”ä»¥ä¸‹å…³é”®é—®é¢˜ã€‚</p> <ul><li>ä»€ä¹ˆæ˜¯å¹¿ä¹‰å¯¹è±¡ï¼Ÿ</li> <li>å¦‚ä½•æ£€éªŒ<code>promise</code>ç±»å‹ï¼Ÿ</li> <li><code>promise</code>ä¸<code>thenable</code>ä¸¤ç±»å‹æœ‰ä½•åŒºåˆ«ï¼Ÿ</li></ul> <h2 id="ç–‘é—®"><a href="#ç–‘é—®" class="header-anchor">#</a> ç–‘é—®</h2> <p>â€ƒâ€ƒå¦‚æœä¸å¤ªæ¸…æ¥š<code>Promise</code>ï¼Œå»ºè®®å‚è€ƒ<a href="https://es6.ruanyifeng.com/#docs/promise" target="_blank" rel="noopener noreferrer">ã€ŠECMAScript 6 å…¥é—¨ã€‹<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ï¼Œé¢„ä¹ ä¸‹<code>Promise</code>ç›¸å…³ç”¨æ³•çŸ¥è¯†ã€‚</p> <p>â€ƒâ€ƒé™¤æ­¤ä¹‹å¤–ï¼Œå¯¹è§„èŒƒä¹Ÿè¦æœ‰å¤§è‡´è®¤è¯†ï¼Œæˆ‘ä»¬å°†æ ¹æ®å‡ ä¸ªç–‘é—®æ¥ç»†è‡´é˜è¿°ã€‚</p> <h3 id="ä»€ä¹ˆæ˜¯-promise-a-è§„èŒƒ"><a href="#ä»€ä¹ˆæ˜¯-promise-a-è§„èŒƒ" class="header-anchor">#</a> ä»€ä¹ˆæ˜¯ Promise/A+ è§„èŒƒï¼Ÿ</h3> <p>â€ƒâ€ƒ;<code>Promise</code>æœ‰å¤šç§ç¤¾åŒºè§„èŒƒï¼Œä¾‹å¦‚ <a href="https://wiki.commonjs.org/wiki/Promises/A" target="_blank" rel="noopener noreferrer">Promise/A<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€<a href="https://wiki.commonjs.org/wiki/Promises/B" target="_blank" rel="noopener noreferrer">Promise/B<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€<a href="https://wiki.commonjs.org/wiki/Promises/D" target="_blank" rel="noopener noreferrer">Promise/D<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> å’Œ <a href="https://wiki.commonjs.org/wiki/Promises/KISS" target="_blank" rel="noopener noreferrer">Promises/KISS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ç­‰ã€‚</p> <p>â€ƒâ€ƒ;<a href="https://promisesaplus.com/" target="_blank" rel="noopener noreferrer">Promise/A+<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> åœ¨<code>Promise/A</code>ä¹‹ä¸Šï¼Œè§„èŒƒäº†æœ¯è¯­å¹¶æ‹“å±•äº†å‚æ•°è¡Œä¸ºï¼Œçœç•¥äº†ä¸€äº›æœ‰é—®é¢˜çš„éƒ¨åˆ†ã€‚</p> <p>â€ƒâ€ƒ;<code>Promise/A+</code>æœ‰å¾ˆå¤šå®ç°ï¼Œä¾‹å¦‚ç¬¬ä¸‰æ–¹åº“ <a href="https://github.com/kriskowal/q" target="_blank" rel="noopener noreferrer">q<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€<a href="https://github.com/cujojs/when" target="_blank" rel="noopener noreferrer">when<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> å’Œ <a href="https://github.com/petkaantonov/bluebird" target="_blank" rel="noopener noreferrer">bluebird<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ç­‰ã€‚å®é™…ä¸Šä»»ä½•<code>Promise</code>é€šè¿‡æµ‹è¯•ï¼Œéƒ½è¢«è®¤ä¸ºæ˜¯å¯¹<code>Promise/A+</code>è§„èŒƒçš„ä¸€ç§å®ç°ã€‚</p> <blockquote><p><code>Promise/A+</code>è§„èŒƒå®˜æ–¹æµ‹è¯•ç”¨ä¾‹ä¸º <a href="https://github.com/promises-aplus/promises-tests" target="_blank" rel="noopener noreferrer">promises-aplus-tests<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h3 id="åŸç”Ÿ-promise-å®ç°äº†-promise-a"><a href="#åŸç”Ÿ-promise-å®ç°äº†-promise-a" class="header-anchor">#</a> åŸç”Ÿ Promise å®ç°äº† Promise/A+ï¼Ÿ</h3> <p>â€ƒâ€ƒåœ¨<code>Promise/A+</code>è§„èŒƒ <a href="https://promisesaplus.com/implementations#the-ecmascript-specification" target="_blank" rel="noopener noreferrer">The ECMAScript Specification<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ç« èŠ‚ä¸­ã€‚</p> <blockquote><p><code>The ECMAScript Specification</code><br> <code>...</code><br> <code>Largely due to the actions of the Promises/A+ community, the Promise global specified by ECMAScript and present in any conforming JavaScript engine is indeed a Promises/A+ implementation!</code></p></blockquote> <p>â€ƒâ€ƒå™è¿°äº†<code>JavaScript</code>å¼•æ“ä¸­çš„<code>Promise</code>ä¹Ÿæ˜¯å¯¹<code>Promise/A+</code>è§„èŒƒçš„ä¸€ç§å®ç°ã€‚</p> <p>â€ƒâ€ƒä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p> <p>â€ƒâ€ƒ;<code>Promise/A+</code>è§„èŒƒå†…å®¹ä¸Šä»…è¯´æ˜äº†<code>Promise</code>çŠ¶æ€å’Œ<code>then</code>æ–¹æ³•ã€‚</p> <p>â€ƒâ€ƒ;<code>ECMAScript</code>è§„èŒƒä¸ä»…è§„å®š<code>Promise</code>ä¸ºæ„é€ å‡½æ•°ï¼Œè¿˜æ·»åŠ äº†é™æ€æ–¹æ³•ï¼Œä¾‹å¦‚<code>Promise.resolve</code>ã€<code>Promise.all</code>å’Œ<code>Promise.race</code>ç­‰ï¼Œæ–°å¢äº†åŸå‹æ–¹æ³•<code>Promise.prototype.catch</code>å’Œ<code>Promise.prototype.finally</code>ç­‰ã€‚å…¶ä¸­<code>Promise.prototype.then</code>ç›¸å…³å†…å®¹ï¼Œåˆ™æ˜¯æ ¹æ®<code>Promise/A+</code>è§„èŒƒè½¬åŒ–è€Œæ¥ã€‚</p> <p>â€ƒâ€ƒæˆ‘ä»¬çŸ¥é“ï¼Œ<code>JavaScript</code>å°±æ˜¯å¯¹<code>ECMAScript</code>è§„èŒƒçš„ä¸€ç§å®ç°ï¼Œè€Œ<code>ECMAScript</code>è§„èŒƒä¸­<code>Promise.prototype.then</code>ç›¸å…³å†…å®¹åˆç»§æ‰¿äº†<code>Promise/A+</code>è§„èŒƒã€‚</p> <p>â€ƒâ€ƒé‚£ä¹ˆå¯ä»¥è¯´ï¼Œ<code>JavaScript</code>å¼•æ“ä¸­çš„<code>Promise</code>ï¼Œå³åŸç”Ÿ<code>Promise</code>ï¼Œå°±æ˜¯å¯¹<code>Promise/A+</code>è§„èŒƒçš„ä¸€ç§å®ç°ã€‚</p> <h3 id="å¦‚ä½•æ„å»ºå¼‚æ­¥ä»»åŠ¡"><a href="#å¦‚ä½•æ„å»ºå¼‚æ­¥ä»»åŠ¡" class="header-anchor">#</a> å¦‚ä½•æ„å»ºå¼‚æ­¥ä»»åŠ¡ï¼Ÿ</h3> <p>â€ƒâ€ƒ;<code>Promise/A+</code>è§„èŒƒè§„å®š<code>then</code>æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>onFulfilled<span class="token punctuation">,</span> onRejected<span class="token punctuation">)</span>
</code></pre></div><p>â€ƒâ€ƒåœ¨ <a href="https://promisesaplus.com/#point-34" target="_blank" rel="noopener noreferrer">2.2.4<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> å°ç»“ä¸­æ˜ç¡®äº†å‚æ•°å¿…é¡»ä»¥å¼‚æ­¥å½¢å¼è¿è¡Œã€‚</p> <blockquote><p><code>2.2.4. onFulfilled or onRejected must not be called until the execution context stack contains only platform code.</code></p></blockquote> <p>â€ƒâ€ƒæ³¨è§£ <a href="https://promisesaplus.com/#point-67" target="_blank" rel="noopener noreferrer">3.1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> è¡¥å……å¯ç”¨å®ä»»åŠ¡<code>setTimeout</code>å’Œ<code>setImmediate</code>ï¼Œæˆ–è€…å¾®ä»»åŠ¡<code>MutationObserver</code>ï¼ˆæµè§ˆå™¨ç¯å¢ƒï¼‰å’Œ<code>process.nextTick</code>ï¼ˆ<code>node</code>ç¯å¢ƒï¼‰è¾¾åˆ°å¼‚æ­¥ã€‚</p> <blockquote><p><code>3.1. ...In practice, this requirement ensures that onFulfilled and onRejected execute asynchronously, after the event loop turn in which then is called, and with a fresh stack. This can be implemented with either a &quot;macro-task&quot; mechanism such as setTimeout or setImmediate, or with a &quot;micro-task&quot; mechanism such as MutationObserver or process.nextTick.</code></p></blockquote> <p>â€ƒâ€ƒç»¼ä¸Šæ‰€è¿°ï¼Œ<code>Promise/A+</code>è§„èŒƒä»…è§„å®šäº†å‚æ•°ä»¥å¼‚æ­¥å½¢å¼è¿è¡Œï¼Œå¹¶æœªè§„å®šæ˜¯å®ä»»åŠ¡è¿˜æ˜¯å¾®ä»»åŠ¡ã€‚</p> <blockquote><p>æ³¨æ„<code>V8</code>å¼•æ“å†…éƒ¨ä¸ºå¾®ä»»åŠ¡ï¼Œè€ƒè™‘ä¸€è‡´æ€§æ¨è <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/queueMicrotask" target="_blank" rel="noopener noreferrer">queueMicrotask<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> åˆ›å»ºå¾®ä»»åŠ¡ï¼Œå…¼å®¹æ€§ç›¸å¯¹è¾ƒå¥½</p></blockquote> <h3 id="å¦‚ä½•åˆ›å»º-promise"><a href="#å¦‚ä½•åˆ›å»º-promise" class="header-anchor">#</a> å¦‚ä½•åˆ›å»º promiseï¼Ÿ</h3> <p>â€ƒâ€ƒ;<code>Promise/A+</code>è§„èŒƒå¹¶æœªæåŠå¦‚ä½•åˆ›å»º<code>promise</code>ã€‚</p> <p>â€ƒâ€ƒ;<code>ECMAScript6</code>è§„èŒƒå‘å¸ƒä»¥æ¥ï¼Œå¤šæ•°æ˜¯ä»¥æ„é€ å‡½æ•°æ–¹å¼åˆ›å»º<code>promise</code>ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>executor<span class="token punctuation">)</span>
</code></pre></div><p>â€ƒâ€ƒå®é™…ä¸Šåœ¨æ­¤ä¹‹å‰ï¼Œè¿˜æµè¡Œä¸€ç§<code>Deferred</code>æ–¹å¼ï¼Œä¾‹å¦‚ <a href="http://api.jquery.com/jQuery.Deferred/" target="_blank" rel="noopener noreferrer">JQuery.Deferred<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>$<span class="token punctuation">.</span><span class="token function">Deferred</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>â€ƒâ€ƒæˆ‘ä»¬ä»¥å®šæ—¶å™¨ä¸ºä¾‹ï¼Œå¯¹æ¯”ä¸‹ä¸¤è€…å·®å¼‚ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ECMAScript6 Promise</span>
<span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token comment">// 1</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// JQuery Deferred</span>
<span class="token keyword">const</span> deferred <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token function">Deferred</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

deferred<span class="token punctuation">.</span><span class="token function">promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token comment">// 1</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  deferred<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
</code></pre></div><p>â€ƒâ€ƒä½ ä¹Ÿæ³¨æ„åˆ°äº†å§ï¼Œ<code>Deferred</code>æ–¹å¼ç›¸å¯¹æ›´åŠ çµæ´»ï¼Œå¯ä»¥åœ¨ä»»ä½•æ—¶æœºä¿®æ”¹çŠ¶æ€ã€‚è€Œ<code>Promise</code>æ–¹å¼è‡ªç”±åº¦å‡å°‘äº†å¾ˆå¤šï¼Œä¸ä»…ä»£ç å±‚çº§å¤šäº†ä¸€å±‚ï¼Œè€Œä¸”åªèƒ½åœ¨å‡½æ•°å‚æ•°ä¸­ä¿®æ”¹çŠ¶æ€ã€‚</p> <p>â€ƒâ€ƒå¯èƒ½ä½ ä¼šé—®ï¼Œé‚£ä¸ºä»€ä¹ˆ<code>TC39</code>æ”¾å¼ƒäº†<code>Deferred</code>ï¼Œè€Œå†³å®šäº†<code>Promise</code>æ„é€ å™¨æ–¹å¼å‘¢ï¼Ÿ</p> <p>â€ƒâ€ƒ;<code>Deferred</code>æ–¹å¼å­˜åœ¨ä¸€ä¸ªè¾ƒä¸¥é‡çš„ç¼ºé™·ï¼Œå³åœ¨ä¸šåŠ¡æµç¨‹é˜¶æ®µï¼Œä¸å®¹æ˜“æ•è·å¼‚å¸¸ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> deferred <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token function">Deferred</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

deferred<span class="token punctuation">.</span><span class="token function">promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Uncaught Error</span>

  deferred<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>â€ƒâ€ƒå¦‚æœæƒ³è®©<code>promise</code>æ•è·å¼‚å¸¸ï¼Œä¸šåŠ¡ä»£ç å¯ä¿®æ”¹ä¸ºã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    deferred<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  deferred<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>â€ƒâ€ƒè€Œ<code>Promise</code>æ„é€ å™¨æ–¹å¼åˆ™éå¸¸å®¹æ˜“ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

promise<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token comment">// Error</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>â€ƒâ€ƒä¸¤ç›¸æ¯”è¾ƒä¸‹<code>ECMAScript6</code>ç¡®å®šäº†ä»¥æ„é€ å™¨æ–¹å¼åˆ›å»º<code>promise</code>ã€‚</p> <blockquote><p>ä¸ªäººè®¤ä¸º<code>Deferred</code>æ›´å¤šæ˜¯ä¸€ä¸ªå‘å¸ƒè®¢é˜…å™¨ï¼Œè€Œ<code>Promise</code>åˆ™ç›¸å¯¹æ›´åŠ å¼ºå¤§ï¼Œæ˜¯ä¸€ä¸ªå¼‚æ­¥æµç¨‹è§£å†³æ–¹æ¡ˆï¼Œ<code>ECMAScript6</code>è§„èŒƒå°†å…¶ç‹¬ç«‹ä¸ºä¸€ä¸ªæ¨¡å—æ˜¯ç›¸å½“åˆç†çš„</p></blockquote> <h2 id="æ‰‹å†™"><a href="#æ‰‹å†™" class="header-anchor">#</a> æ‰‹å†™</h2> <p>â€ƒâ€ƒ;<code>Promise/A+</code>æ›´å¤šåœ°æ˜¯è§„èŒƒäº†ç®—æ³•é€»è¾‘ï¼Œå¹¶æœªè§„å®šè¯­æ³•å±‚é¢çš„å®ç°æ–¹å¼ã€‚</p> <p>â€ƒâ€ƒæˆ‘ä»¬å¯ä»¥å‚è€ƒåŸç”Ÿ<code>Promise</code>è¯­æ³•ï¼Œå¹¶ç»“åˆç®€å•ç”¨ä¾‹ï¼Œæ‰‹å†™ä»¥ç¬¦åˆ<code>Promise/A+</code>è§„èŒƒã€‚</p> <blockquote><p>æ³¨æ„<code>Promise/A+</code>è§„èŒƒç›¸å…³å†…å®¹å°†ç‰¹åˆ«æ ‡æ³¨</p></blockquote> <h3 id="å®ä¾‹åˆå§‹å±æ€§"><a href="#å®ä¾‹åˆå§‹å±æ€§" class="header-anchor">#</a> å®ä¾‹åˆå§‹å±æ€§</h3> <p>â€ƒâ€ƒåŸç”Ÿåˆ›å»º<code>Promise</code>å®ä¾‹ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// {</span>
<span class="token comment">//   [[PromiseState]]: 'pending',</span>
<span class="token comment">//   [[PromiseResult]]: undefined,</span>
<span class="token comment">// }</span>
</code></pre></div><p>â€ƒâ€ƒç›¸å…³ç‰¹å¾åŒ…æ‹¬ã€‚</p> <ul><li><code>Promise</code>ä¸ºæ„é€ å‡½æ•°</li> <li>é»˜è®¤çŠ¶æ€ä¸º<code>pending</code>ï¼Œé»˜è®¤ç»“æœä¸º<code>undefined</code></li> <li>ä¸‰ç§çŠ¶æ€åˆ†åˆ«ä¸ºç­‰å¾…æ€<code>pending</code>ã€è§£å†³æ€<code>fulfilled</code>å’Œæ‹’ç»æ€<code>rejected</code>â€”â€”<a href="https://promisesaplus.com/#promise-states" target="_blank" rel="noopener noreferrer">ã€ŒPromise/A+ 2.1ã€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>â€ƒâ€ƒä»£ç ç¼–å†™å¦‚ä¸‹ï¼Œå…¶ä¸­å±æ€§<code>[[PromiseState]]</code>ç”¨äºä¿å­˜çŠ¶æ€ï¼Œ<code>[[PromiseResult]]</code>ç”¨äºä¿å­˜ç»“æœã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> PromiseState <span class="token operator">=</span> <span class="token string">'[[PromiseState]]'</span>
<span class="token keyword">const</span> PromiseResult <span class="token operator">=</span> <span class="token string">'[[PromiseResult]]'</span>

<span class="token keyword">const</span> <span class="token constant">PENDING</span> <span class="token operator">=</span> <span class="token string">'pending'</span>
<span class="token keyword">const</span> <span class="token constant">FULFILLED</span> <span class="token operator">=</span> <span class="token string">'fulfilled'</span>
<span class="token keyword">const</span> <span class="token constant">REJECTED</span> <span class="token operator">=</span> <span class="token string">'rejected'</span>

<span class="token keyword">class</span> <span class="token class-name">Promise</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>PromiseState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">PENDING</span><span class="token punctuation">;</span>
  <span class="token punctuation">[</span>PromiseResult<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">undefined</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><code>ES2020</code>è§„èŒƒ <a href="https://github.com/tc39/proposal-class-fields#field-declarations" target="_blank" rel="noopener noreferrer">proposal-class-fields<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> å…è®¸å®ä¾‹å±æ€§å®šä¹‰åœ¨ç±»å†…éƒ¨çš„æœ€é¡¶å±‚ï¼Œç›¸å¯¹æ›´åŠ æ¸…æ™°ç®€æ´</p></blockquote> <h3 id="executor-æ‰§è¡Œå™¨"><a href="#executor-æ‰§è¡Œå™¨" class="header-anchor">#</a> executor æ‰§è¡Œå™¨</h3> <p>â€ƒâ€ƒåŸç”Ÿ<code>Promise</code>ä¼ å‚å‡½æ•°ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">executor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// {</span>
<span class="token comment">//   [[PromiseState]]: 'fulfilled',</span>
<span class="token comment">//   [[PromiseResult]]: 3,</span>
<span class="token comment">// }</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// {</span>
<span class="token comment">//   [[PromiseState]]: 'rejected',</span>
<span class="token comment">//   [[PromiseResult]]: 4,</span>
<span class="token comment">// }</span>
</code></pre></div><p>â€ƒâ€ƒç›¸å…³ç‰¹å¾åŒ…æ‹¬ã€‚</p> <ul><li>å®ä¾‹åˆ›å»ºè¿‡ç¨‹ä¸­å‚æ•°<code>executor</code>å°†åŒæ­¥æ‰§è¡Œ</li> <li>æ‰§è¡Œå™¨<code>executor</code>åŒ…æ‹¬<code>resolve</code>å’Œ<code>reject</code>ä¸¤ä¸ªå‡½æ•°å‚æ•°ï¼Œ<code>resolve</code>æ‰§è¡Œå®ä¾‹çŠ¶æ€ä¿®æ”¹ä¸ºè§£å†³æ€ï¼Œ<code>reject</code>æ‰§è¡Œå®ä¾‹çŠ¶æ€ä¿®æ”¹ä¸ºæ‹’ç»æ€</li></ul> <p>â€ƒâ€ƒä»¥ä¸‹ä¸ºä¼˜åŒ–ä»£ç ï¼Œæ³¨æ„ç§æœ‰æ–¹æ³•ç”¨ç®­å¤´å‡½æ•°ï¼Œå¯å°†å†…éƒ¨<code>this</code>æŒ‡å‘å®ä¾‹å¯¹è±¡ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Promise</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>

  <span class="token function-variable function">#resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">[</span>PromiseState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">FULFILLED</span>
    <span class="token keyword">this</span><span class="token punctuation">[</span>PromiseResult<span class="token punctuation">]</span> <span class="token operator">=</span> value
  <span class="token punctuation">}</span>
  <span class="token function-variable function">#reject</span> <span class="token operator">=</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">[</span>PromiseState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">REJECTED</span>
    <span class="token keyword">this</span><span class="token punctuation">[</span>PromiseResult<span class="token punctuation">]</span> <span class="token operator">=</span> reason
  <span class="token punctuation">}</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">executor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>#resolve<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>#reject<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><code>ES2020</code>è§„èŒƒ <a href="https://github.com/tc39/proposal-class-fields#private-fields" target="_blank" rel="noopener noreferrer">proposal-class-fields<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> å…è®¸å®ä¾‹å®šä¹‰ç§æœ‰å±æ€§æˆ–æ–¹æ³•ï¼Œä»…å¯åœ¨ç±»å†…éƒ¨ä½¿ç”¨ï¼Œå¤–éƒ¨æ— æ³•ä½¿ç”¨</p></blockquote> <h3 id="çŠ¶æ€ä¸å¯å˜æ€§"><a href="#çŠ¶æ€ä¸å¯å˜æ€§" class="header-anchor">#</a> çŠ¶æ€ä¸å¯å˜æ€§</h3> <p>â€ƒâ€ƒåŸç”Ÿ<code>Promise</code>ä¿®æ”¹çŠ¶æ€ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// {</span>
<span class="token comment">//   [[PromiseState]]: 'fulfilled',</span>
<span class="token comment">//   [[PromiseResult]]: 1,</span>
<span class="token comment">// }</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// {</span>
<span class="token comment">//   [[PromiseState]]: 'fulfilled',</span>
<span class="token comment">//   [[PromiseResult]]: 3,</span>
<span class="token comment">// }</span>
</code></pre></div><p>â€ƒâ€ƒç›¸å…³ç‰¹å¾åŒ…æ‹¬ã€‚</p> <ul><li>å¤„äºè§£å†³æ€æˆ–è€…æ‹’ç»æ€ï¼Œä¸€å®šä¸èƒ½å†ä¿®æ”¹ä¸ºä»»ä½•çŠ¶æ€â€”â€”<a href="https://promisesaplus.com/#point-14" target="_blank" rel="noopener noreferrer">ã€ŒPromise/A+ 2.1.2 / 2.1.3ã€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>å¤„äºç­‰å¾…æ€çš„æ—¶å€™ï¼Œå¯èƒ½å˜ä¸ºè§£å†³æ€æˆ–è€…æ‹’ç»æ€â€”â€”<a href="https://promisesaplus.com/#point-12" target="_blank" rel="noopener noreferrer">ã€ŒPromise/A+ 2.1.1ã€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>â€ƒâ€ƒä»£ç ä¼˜åŒ–ä¸ºã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function-variable function">#resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseState<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">[</span>PromiseState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">FULFILLED</span>
    <span class="token keyword">this</span><span class="token punctuation">[</span>PromiseResult<span class="token punctuation">]</span> <span class="token operator">=</span> value
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function-variable function">#reject</span> <span class="token operator">=</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseState<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">[</span>PromiseState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">REJECTED</span>
    <span class="token keyword">this</span><span class="token punctuation">[</span>PromiseResult<span class="token punctuation">]</span> <span class="token operator">=</span> reason
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="æ–¹æ³•ä¼ å‚"><a href="#æ–¹æ³•ä¼ å‚" class="header-anchor">#</a> æ–¹æ³•ä¼ å‚</h3> <p>â€ƒâ€ƒåŸç”Ÿ<code>Promise</code>ä¸Š<code>then</code>æ–¹æ³•ä¼ å‚ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span>
</code></pre></div><p>â€ƒâ€ƒç›¸å…³ç‰¹å¾åŒ…æ‹¬ã€‚</p> <ul><li><code>promise</code>å¿…é¡»æœ‰<code>then</code>æ–¹æ³•ï¼Œä¸”æ¥æ”¶ä¸¤ä¸ªå‚æ•°<code>onFulfilled</code>å’Œ<code>onRejected</code>â€”â€”<a href="https://promisesaplus.com/#the-then-method" target="_blank" rel="noopener noreferrer">ã€ŒPromise/A+ 2.2ã€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><code>onFulfilled</code>å’Œ<code>onRejected</code>éƒ½æ˜¯å¯é€‰å‚æ•°ï¼Œè‹¥ä¸æ˜¯å‡½æ•°ï¼Œå¿…é¡»è¢«å¿½ç•¥â€”â€”<a href="https://promisesaplus.com/#point-23" target="_blank" rel="noopener noreferrer">ã€ŒPromise/A+ 2.2.1ã€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><code>onFulfilled</code>å’Œ<code>onRejected</code>ä¸€å®šè¢«ä½œä¸ºæ™®é€šå‡½æ•°è°ƒç”¨â€”â€”<a href="https://promisesaplus.com/#point-35" target="_blank" rel="noopener noreferrer">ã€ŒPromise/A+ 2.2.5ã€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>â€ƒâ€ƒä»£ç ä¿®æ”¹ä¸ºã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Promise</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>

  <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    onFulfilled <span class="token operator">=</span> <span class="token keyword">typeof</span> onFulfilled <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> <span class="token function-variable function">onFulfilled</span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    onRejected <span class="token operator">=</span> <span class="token keyword">typeof</span> onRejected <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> <span class="token function-variable function">onRejected</span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>å‚æ•°ä¸ºéå‡½æ•°æ—¶ï¼Œä¸ºä¿è¯å¯è¢«è°ƒç”¨ï¼Œæš‚æ—¶è¿”å›æ™®é€šå‡½æ•°</p></blockquote> <h3 id="then-æ–¹æ³•"><a href="#then-æ–¹æ³•" class="header-anchor">#</a> then æ–¹æ³•</h3> <p>â€ƒâ€ƒåŸç”Ÿ<code>Promise</code>æ‰§è¡Œ<code>then</code>æ–¹æ³•ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token comment">// 1</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
p2<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token comment">// 2</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>â€ƒâ€ƒç›¸å…³ç‰¹å¾åŒ…æ‹¬ã€‚</p> <ul><li>å¦‚æœ<code>onFulfilled</code>æˆ–<code>onRejected</code>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¿…é¡»åœ¨<code>promise</code>è¢«è§£å†³æˆ–è¢«æ‹’ç»åè°ƒç”¨ï¼Œä¸”<code>promise</code>å€¼æˆ–åŸå› ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°â€”â€”<a href="https://promisesaplus.com/#point-26" target="_blank" rel="noopener noreferrer">ã€ŒPromise/A+ 2.2.2 / 2.2.3ã€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>â€ƒâ€ƒä»£ç ä¿®æ”¹ä¸ºã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseState<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseResult<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseState<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token constant">REJECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseResult<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="å¼‚æ­¥-executor"><a href="#å¼‚æ­¥-executor" class="header-anchor">#</a> å¼‚æ­¥ executor</h3> <p>â€ƒâ€ƒç›®å‰ä»£ç å¹¶æœªå®Œå…¨ç¬¦åˆ<a href="https://promisesaplus.com/#point-26" target="_blank" rel="noopener noreferrer">ã€ŒPromise/A+ 2.2.2 / 2.2.3ã€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>è§„èŒƒï¼Œä¾‹å¦‚<code>executor</code>ä¸ºå¼‚æ­¥æƒ…å†µæ—¶ï¼Œè¿˜ä¼šå­˜åœ¨ä¸€äº›é—®é¢˜ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>æ§åˆ¶å°æ²¡æœ‰æ‰“å°ä»»ä½•å†…å®¹</p></blockquote> <p>â€ƒâ€ƒä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p> <p>â€ƒâ€ƒå®ä¾‹<code>p</code>åœ¨åˆ›å»ºå®Œæˆåï¼Œè¿˜å¤„åœ¨ç­‰å¾…æ€ã€‚ç´§æ¥ç€æ‰§è¡Œ<code>then</code>æ–¹æ³•ï¼Œ<code>then</code>æ–¹æ³•å†…éƒ¨æ²¡æœ‰ç­‰å¾…æ€ç›¸å…³é€»è¾‘ï¼Œä¹Ÿå°±æ²¡æœ‰ä»»ä½•æ“ä½œã€‚<code>1s</code>å<code>resolve</code>æ‰§è¡Œï¼Œä¹Ÿä»…ä»…æ˜¯å°†<code>p</code>çŠ¶æ€ä¿®æ”¹ä¸ºè§£å†³æ€ã€‚</p> <p>â€ƒâ€ƒå¦‚ä½•è§£å†³å‘¢ï¼Ÿ</p> <p>â€ƒâ€ƒå¯ä»¥åœ¨ç­‰å¾…æ€å°±ä¿å­˜<code>onFulfilled</code>å’Œ<code>onRejected</code>å‡½æ•°ï¼Œåœ¨<code>resolve</code>ä¿®æ”¹çŠ¶æ€æ—¶å†æ‰§è¡Œã€‚</p> <p>â€ƒâ€ƒä»£ç ä¼˜åŒ–ä¸ºã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Promise</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>

  #onFulfilledCallBack <span class="token operator">=</span> <span class="token keyword">undefined</span>
  #onRejectedCallBack <span class="token operator">=</span> <span class="token keyword">undefined</span>
  <span class="token function-variable function">#resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseState<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>

      <span class="token keyword">this</span><span class="token punctuation">.</span>#onFulfilledCallBack<span class="token operator">?.</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseResult<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">#reject</span> <span class="token operator">=</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseState<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>

      <span class="token keyword">this</span><span class="token punctuation">.</span>#onRejectedCallBack<span class="token operator">?.</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseResult<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token operator">...</span>

  <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseState<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>#onFulfilledCallBack <span class="token operator">=</span> onFulfilled
      <span class="token keyword">this</span><span class="token punctuation">.</span>#onRejectedCallBack <span class="token operator">=</span> onRejected
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><code>?.</code>ä¸º<code>ES2020</code>è§„èŒƒä¸­ <a href="https://github.com/tc39/proposal-optional-chaining" target="_blank" rel="noopener noreferrer">proposal-optional-chaining<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> å¯é€‰é“¾æ“ä½œç¬¦</p></blockquote> <h3 id="å¤šæ¬¡è°ƒç”¨-then"><a href="#å¤šæ¬¡è°ƒç”¨-then" class="header-anchor">#</a> å¤šæ¬¡è°ƒç”¨ then</h3> <p>â€ƒâ€ƒåŸç”Ÿ<code>Promise</code>å¤šæ¬¡è°ƒç”¨<code>then</code>æ–¹æ³•ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// 3</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>â€ƒâ€ƒç›¸å…³ç‰¹å¾åŒ…æ‹¬ã€‚</p> <ul><li><code>then</code>æ–¹æ³•å‡½æ•°å‚æ•°æŒ‰è¯­æ³•é¡ºåºæ‰§è¡Œ</li> <li>åŒä¸€<code>promise</code>ä¸Š<code>then</code>æ–¹æ³•å¯èƒ½è¢«å¤šæ¬¡è°ƒç”¨â€”â€”<a href="https://promisesaplus.com/#point-36" target="_blank" rel="noopener noreferrer">ã€ŒPromise/A+ 2.2.6ã€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>â€ƒâ€ƒä»£ç ä¼˜åŒ–å¦‚ä¸‹ï¼Œæ³¨æ„ä¸ºäº†ä¿è¯é¡ºåºï¼Œä¸¤æ•°ç»„å†…å‡½æ•°éƒ½æ˜¯å…ˆè¿›å…ˆå‡ºã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Promise</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>

  #onFulfilledCallBacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  #onRejectedCallBacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token function-variable function">#resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseState<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>

      <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>#onFulfilledCallBacks<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>#onFulfilledCallBacks<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseResult<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">#reject</span> <span class="token operator">=</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseState<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>

      <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>#onRejectedCallBacks<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>#onRejectedCallBacks<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseResult<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token operator">...</span>

  <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseState<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>#onFulfilledCallBacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>onFulfilled<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>#onRejectedCallBacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="è¿”å›-promise"><a href="#è¿”å›-promise" class="header-anchor">#</a> è¿”å› promise</h3> <p>â€ƒâ€ƒåŸç”Ÿ<code>Promise</code>è¿”å›å€¼ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// {</span>
<span class="token comment">//   [[PromiseState]]: 'pending',</span>
<span class="token comment">//   [[PromiseResult]]: undefined,</span>
<span class="token comment">// }</span>
</code></pre></div><p>â€ƒâ€ƒç›¸å…³ç‰¹å¾åŒ…æ‹¬ã€‚</p> <ul><li><code>then</code>æ–¹æ³•å¿…é¡»è¿”å›ä¸€ä¸ªæ–°<code>promise</code>â€”â€”<a href="https://promisesaplus.com/#point-40" target="_blank" rel="noopener noreferrer">ã€ŒPromise/A+ 2.2.7ã€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>â€ƒâ€ƒä»£ç æš‚æ—¶ä¿®æ”¹ä¸ºã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseState<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> promise
<span class="token punctuation">}</span>
</code></pre></div><h3 id="å‡½æ•°å‚æ•°è¿”å›å€¼"><a href="#å‡½æ•°å‚æ•°è¿”å›å€¼" class="header-anchor">#</a> å‡½æ•°å‚æ•°è¿”å›å€¼</h3> <p>â€ƒâ€ƒåŸç”Ÿ<code>Promise</code>å‡½æ•°å‚æ•°<code>onFulfilled</code>è¿”å›æ•°å€¼ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">1</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// {</span>
<span class="token comment">//   [[PromiseState]]: 'fulfilled',</span>
<span class="token comment">//   [[PromiseResult]]: 1,</span>
<span class="token comment">// }</span>
</code></pre></div><p>â€ƒâ€ƒç›¸å…³ç‰¹å¾åŒ…æ‹¬ã€‚</p> <ul><li>å¦‚æœ<code>onFulfilled</code>æˆ–<code>onRejected</code>è¿”å›ä¸€ä¸ªå€¼<code>x</code>ï¼Œè¿è¡Œ<code>promise</code>è§£å†³ç¨‹åºâ€”â€”<a href="https://promisesaplus.com/#point-41" target="_blank" rel="noopener noreferrer">ã€ŒPromise/A+ 2.2.7.1ã€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>å¦‚æœ<code>x</code>ä¸æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–å‡½æ•°ï¼Œç”¨<code>x</code>è§£å†³<code>promise</code>â€”â€”<a href="https://promisesaplus.com/#point-64" target="_blank" rel="noopener noreferrer">ã€ŒPromise/A+ 2.3.4ã€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>â€ƒâ€ƒä½•ä¸º<code>promise</code>è§£å†³ç¨‹åºå‘¢ï¼Ÿ</p> <p>â€ƒâ€ƒ;<a href="https://promisesaplus.com/#the-promise-resolution-procedure" target="_blank" rel="noopener noreferrer">ã€ŒPromise/A+ 2.3ã€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>å™è¿°æ˜¯ä¸€ä¸ªæŠ½è±¡æ“ä½œï¼Œå¯è¡¨ç¤ºä¸º<code>[[Resolve]](promise, x)</code>ã€‚å…¶ä¸­ä¸»è¦æ ¹æ®<code>x</code>ç±»å‹ï¼Œå†³å®šæ–°<code>promise</code>çš„çŠ¶æ€å’Œç»“æœã€‚</p> <p>â€ƒâ€ƒæ¯”å¦‚<code>x</code>ä¸æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–å‡½æ•°ï¼Œä¾‹å¦‚æ•°å€¼ï¼Œåˆ™æ–°<code>promise</code>çŠ¶æ€å°†ç¡®å®šä¸ºè§£å†³æ€ï¼Œç»“æœä¸º<code>x</code>ï¼Œå³ç”¨<code>x</code>è§£å†³<code>promise</code>ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// {</span>
<span class="token comment">//   [[PromiseState]]: 'fulfilled',</span>
<span class="token comment">//   [[PromiseResult]]: x,</span>
<span class="token comment">// }</span>
</code></pre></div><p>â€ƒâ€ƒé‚£ä¹ˆå¦‚ä½•åœ¨<code>onFulfilled</code>æˆ–<code>onRejected</code>è¿”å›æ•°å€¼<code>x</code>æ—¶ï¼Œåˆä¿®æ”¹æ–°<code>promise</code>çŠ¶æ€å’Œç»“æœå‘¢ï¼Ÿ</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseState<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseResult<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token operator">...</span>

  <span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> promise
<span class="token punctuation">}</span>
</code></pre></div><p>â€ƒâ€ƒä½ å¯èƒ½æƒ³åˆ°äº†ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>

  <span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseState<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseResult<span class="token punctuation">]</span><span class="token punctuation">)</span>

    promise<span class="token punctuation">.</span><span class="token function">#resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token operator">...</span>

  <span class="token keyword">return</span> promise
<span class="token punctuation">}</span>
</code></pre></div><p>â€ƒâ€ƒå¯ä¿®æ”¹çŠ¶æ€ä¹Ÿç¬¦åˆè§„èŒƒï¼Œä½†ä¸ªäººè®¤ä¸ºæ­¤æ–¹å¼å­˜åœ¨ä¸€äº›ç¼ºé™·ã€‚</p> <p>â€ƒâ€ƒå°†å®ä¾‹å±æ€§<code>resolve</code>ç§æœ‰åŒ–ï¼Œå°±æ˜¯ä¸ºäº†é™åˆ¶å¤–éƒ¨è®¿é—®ã€‚ä»¥<code>promise.#resolve</code>è®¿é—®ï¼Œè€Œé<code>this.#resolve</code>ï¼Œå·²ç»å¤„äºå¤–éƒ¨è®¿é—®çš„èŒƒç•´äº†ï¼Œæ€è·¯ä¸Šä¸æ˜¯å¾ˆåˆç†ã€‚</p> <p>â€ƒâ€ƒè¿˜æœ‰æ›´å¥½çš„åŠæ³•å—ï¼Ÿ</p> <p>â€ƒâ€ƒæˆ‘ä»¬çŸ¥é“åœ¨<code>executor</code>æ‰§è¡Œå™¨ä¸Šï¼Œ<code>resolve</code>å’Œ<code>reject</code>ä¸¤ä¸ªå‚æ•°ä¹Ÿå¯ä¿®æ”¹çŠ¶æ€ã€‚</p> <p>â€ƒâ€ƒå¦‚æœå°†<code>if</code>è¯­å¥ä½“è¿ç§»è‡³<code>executor</code>å†…éƒ¨ï¼Œæœ‰æ²¡æœ‰å¯èƒ½å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¯ä»¥çš„ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>

  <span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseState<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseResult<span class="token punctuation">]</span><span class="token punctuation">)</span>

      <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token operator">...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> promise
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><code>if</code>è¯­å¥ä½“åœ¨<code>executor</code>å¤–éƒ¨æ—¶ï¼ŒåŒæ­¥æ‰§è¡Œã€‚åœ¨<code>executor</code>å†…éƒ¨æ—¶ï¼Œä¹Ÿæ˜¯åŒæ­¥æ‰§è¡Œ</p></blockquote> <p>â€ƒâ€ƒç›¸å…³ç‰¹å¾å®Œå…¨å®ç°äº†å—ï¼Ÿå¹¶æ²¡æœ‰ã€‚</p> <p>â€ƒâ€ƒè‹¥<code>executor</code>ä¸ºå¼‚æ­¥æƒ…å†µæ—¶ï¼Œè¿˜å­˜åœ¨ä¸€äº›é—®é¢˜ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> p2 <span class="token operator">=</span> p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span>
  <span class="token comment">// {</span>
  <span class="token comment">//   [[PromiseState]]: 'pending',</span>
  <span class="token comment">//   [[PromiseResult]]: undefined,</span>
  <span class="token comment">// }</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>æ§åˆ¶å°æ‰“å°å†…å®¹ä¸åŸç”Ÿä¸ä¸€è‡´</p></blockquote> <p>â€ƒâ€ƒä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p> <p>â€ƒâ€ƒå®ä¾‹<code>p1</code>å¤„äºç­‰å¾…æ€ï¼Œæ‰§è¡Œ<code>then</code>æ–¹æ³•å°†<code>onFulfilled</code>ä¿å­˜è‡³æ•°ç»„ä¸­ã€‚<code>1s</code>å<code>resolve</code>æ‰§è¡Œï¼Œ<code>p1</code>çŠ¶æ€ä¿®æ”¹ä¸ºè§£å†³æ€ï¼Œç´§æ¥ç€å–å‡ºè¿è¡Œ<code>onFulfilled</code>ï¼Œ<code>p2</code>çŠ¶æ€æ— ä»»ä½•å˜åŒ–ã€‚</p> <p>â€ƒâ€ƒæˆ‘ä»¬å¯ä»¥åœ¨<code>onFulfilled</code>æ‰§è¡Œæ—¶ï¼Œå¯¹è¿”å›å€¼<code>x</code>ç¨åŠ å¤„ç†ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseState<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#onFulfilledCallBacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseResult<span class="token punctuation">]</span><span class="token punctuation">)</span>

      <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="å¤„ç†å‡½æ•°"><a href="#å¤„ç†å‡½æ•°" class="header-anchor">#</a> å¤„ç†å‡½æ•°</h3> <p>â€ƒâ€ƒä¸ºäº†ç»Ÿä¸€å¤„ç†ä¸åŒç±»å‹<code>x</code>å€¼ï¼Œå¹¶ä¸¥æ ¼å®ç°è§„èŒƒ<a href="https://promisesaplus.com/#the-promise-resolution-procedure" target="_blank" rel="noopener noreferrer">ã€ŒPromise/A+ 2.3ã€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ä¸­å„å­ç« èŠ‚ã€‚</p> <p>â€ƒâ€ƒä¿®æ”¹ä»£ç å¹¶åˆ›å»º<code>resolvePromise</code>å‡½æ•°ï¼Œå‚æ•°æš‚æ—¶ä¸º<code>x</code>å’Œ<code>resolve</code>ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Promise</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>

  <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>

    <span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseState<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseResult<span class="token punctuation">]</span><span class="token punctuation">)</span>

        <span class="token function">resolvePromise</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> resolve<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token operator">...</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseState<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>#onFulfilledCallBacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseResult<span class="token punctuation">]</span><span class="token punctuation">)</span>

          <span class="token function">resolvePromise</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> resolve<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token operator">...</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> promise
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">resolvePromise</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>â€ƒâ€ƒç ”è¯»éƒ¨åˆ†å­ç« èŠ‚ã€‚</p> <blockquote><p><code>2.3.1. If <strong>promise</strong> and <strong>x</strong> refer to the same object, reject promise with a TypeError as the reason.</code><br> <code>2.3.2.2. If/when x is fulfilled, <strong>fulfill</strong> promise with the same value.</code> <code>2.3.2.3. If/when x is rejected, <strong>reject</strong> promise with the same reason.</code></p></blockquote> <p>â€ƒâ€ƒå¯ç¡®è®¤å‚æ•°<code>promise</code>å’Œ<code>x</code>ã€<code>resolve</code>ã€<code>reject</code>ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseState<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseResult<span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token operator">...</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseState<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#onFulfilledCallBacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseResult<span class="token punctuation">]</span><span class="token punctuation">)</span>

      <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">resolvePromise</span><span class="token punctuation">(</span><span class="token parameter">promise<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="æŠ›å‡ºå¼‚å¸¸"><a href="#æŠ›å‡ºå¼‚å¸¸" class="header-anchor">#</a> æŠ›å‡ºå¼‚å¸¸</h3> <p>â€ƒâ€ƒåŸç”Ÿ<code>Promise</code>æŠ›å‡ºå¼‚å¸¸ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token comment">// Error</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>â€ƒâ€ƒç›¸å…³ç‰¹å¾åŒ…æ‹¬ã€‚</p> <ul><li>å¦‚æœ<code>onFulfilled</code>æˆ–<code>onRejected</code>æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸<code>e</code>ï¼Œæ–°<code>promise</code>ä¸ºæ‹’ç»æ€ä¸”åŸå› ä¸º<code>e</code>â€”â€”<a href="https://promisesaplus.com/#point-42" target="_blank" rel="noopener noreferrer">ã€ŒPromise/A+ 2.2.7.2ã€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>â€ƒâ€ƒä»£ç ä¼˜åŒ–ä¸ºã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseState<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseResult<span class="token punctuation">]</span><span class="token punctuation">)</span>

      <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>â€ƒâ€ƒç±»ä¼¼åœ°<code>executor</code>ä¸ºå¼‚æ­¥æƒ…å†µæ—¶ï¼Œä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Uncaught Error</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>æœªæ•è·åˆ°å¼‚å¸¸</p></blockquote> <p>â€ƒâ€ƒä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p> <p>â€ƒâ€ƒå®ä¾‹<code>p</code>å¤„äºç­‰å¾…æ€ï¼Œæ‰§è¡Œ<code>then</code>æ–¹æ³•å°†<code>onFulfilled</code>ä¿å­˜ã€‚<code>1s</code>å<code>resolve</code>æ‰§è¡Œï¼Œ<code>p</code>çŠ¶æ€ä¿®æ”¹ä¸ºè§£å†³æ€ï¼Œç´§æ¥ç€å–å‡º<code>onFulfilled</code>ï¼Œè¿è¡Œå†…éƒ¨æŠ›å‡ºäº†å¼‚å¸¸ã€‚</p> <p>â€ƒâ€ƒä»£ç ä¼˜åŒ–ä¸ºã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseState<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#onFulfilledCallBacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseResult<span class="token punctuation">]</span><span class="token punctuation">)</span>

        <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="å¼‚æ­¥ä»»åŠ¡"><a href="#å¼‚æ­¥ä»»åŠ¡" class="header-anchor">#</a> å¼‚æ­¥ä»»åŠ¡</h3> <p>â€ƒâ€ƒåŸç”Ÿ<code>Promise</code>å¼‚æ­¥ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token comment">// 1</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// 3</span>
</code></pre></div><blockquote><p>æ³¨æ„æ‰“å°é¡ºåº<code>2 3 1</code></p></blockquote> <p>â€ƒâ€ƒç›¸å…³ç‰¹å¾åŒ…æ‹¬ã€‚</p> <ul><li><code>onFulfilled</code>æˆ–<code>onRejected</code>å¿…é¡»ä»¥å¼‚æ­¥å½¢å¼è¿è¡Œâ€”â€”<a href="https://promisesaplus.com/#point-34" target="_blank" rel="noopener noreferrer">ã€ŒPromise/A+ 2.2.4ã€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>â€ƒâ€ƒä»£ç ç®€å•ä¿®æ”¹ä¸ºã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> queueTask <span class="token operator">=</span> queueMicrotask

<span class="token keyword">class</span> <span class="token class-name">Promise</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>

  <span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseState<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token function">queueTask</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseResult<span class="token punctuation">]</span><span class="token punctuation">)</span>

            <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token operator">...</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> promise
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>â€ƒâ€ƒæ³¨æ„<code>try...catch</code>å¹¶ä¸èƒ½æ•è·åˆ°å¼‚æ­¥å‡½æ•°å†…æŠ›å‡ºçš„å¼‚å¸¸ï¼Œä¾‹å¦‚ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Uncaught Error</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>â€ƒâ€ƒé‚£å¦‚ä½•ä¼˜åŒ–å‘¢ï¼Ÿ</p> <p>â€ƒâ€ƒæˆ‘ä»¬å¯ä»¥å°†å…¨éƒ¨<code>try...catch</code>è¯­å¥æ”¾åˆ°å¼‚æ­¥å‡½æ•°ä¸­ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseState<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">queueTask</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseResult<span class="token punctuation">]</span><span class="token punctuation">)</span>

        <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>â€ƒâ€ƒç±»ä¼¼åœ°<code>executor</code>ä¸ºå¼‚æ­¥æƒ…å†µæ—¶ï¼Œä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>

    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// 3</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token comment">// 2</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>æ‰“å°é¡ºåº<code>1 2 3</code>ï¼ˆåŸç”Ÿæ‰“å°é¡ºåº<code>1 3 2</code>ï¼‰</p></blockquote> <p>â€ƒâ€ƒä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p> <p>â€ƒâ€ƒ;<code>onFulfilled</code>æ²¡æœ‰ä»¥å¼‚æ­¥å½¢å¼è¿è¡Œã€‚</p> <p>â€ƒâ€ƒä»£ç ä¿®æ”¹ä¸ºã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseState<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#onFulfilledCallBacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">queueTask</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseResult<span class="token punctuation">]</span><span class="token punctuation">)</span>

          <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>â€ƒâ€ƒåˆå¹¶é‡å¤ä»£ç ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">resolved</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">queueTask</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseResult<span class="token punctuation">]</span><span class="token punctuation">)</span>

        <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> <span class="token function-variable function">rejected</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">queueTask</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseResult<span class="token punctuation">]</span><span class="token punctuation">)</span>

        <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseState<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">resolved</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseState<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token constant">REJECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">rejected</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>PromiseState<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#onFulfilledCallBacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>resolved<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#onRejectedCallBacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>rejected<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="å‚æ•°ä¼˜åŒ–"><a href="#å‚æ•°ä¼˜åŒ–" class="header-anchor">#</a> å‚æ•°ä¼˜åŒ–</h3> <p>â€ƒâ€ƒåŸç”Ÿ<code>Promise</code>å€¼ç©¿é€ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span>
<span class="token comment">// {</span>
<span class="token comment">//   [[PromiseState]]: 'fulfilled',</span>
<span class="token comment">//   [[PromiseResult]]: 1,</span>
<span class="token comment">// }</span>

<span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
p2<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span>
<span class="token comment">// {</span>
<span class="token comment">//   [[PromiseState]]: 'rejected',</span>
<span class="token comment">//   [[PromiseResult]]: 2,</span>
<span class="token comment">// }</span>
</code></pre></div><p>â€ƒâ€ƒç›¸å…³ç‰¹å¾åŒ…æ‹¬ã€‚</p> <ul><li>å¦‚æœ<code>onFulfilled</code>ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ä¸”åŸ<code>promise</code>è¢«è§£å†³ï¼Œæ–°<code>promise</code>å¿…é¡»ä¹Ÿè¢«è§£å†³ï¼Œä¸”å€¼ä¸åŸ<code>promise</code>ç›¸åŒâ€”â€”<a href="https://promisesaplus.com/#point-43" target="_blank" rel="noopener noreferrer">ã€ŒPromise/A+ 2.2.7.3ã€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>å¦‚æœ<code>onRejected</code>ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ä¸”åŸ<code>promise</code>è¢«æ‹’ç»ï¼Œæ–°<code>promise</code>å¿…é¡»ä¹Ÿè¢«æ‹’ç»ï¼Œä¸”åŸå› ä¸åŸ<code>promise</code>ç›¸åŒâ€”â€”<a href="https://promisesaplus.com/#point-44" target="_blank" rel="noopener noreferrer">ã€ŒPromise/A+ 2.2.7.4ã€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>â€ƒâ€ƒä»£ç ä¼˜åŒ–å¦‚ä¸‹ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  onFulfilled <span class="token operator">=</span> <span class="token keyword">typeof</span> onFulfilled <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> <span class="token function-variable function">onFulfilled</span> <span class="token operator">:</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> value
  onRejected <span class="token operator">=</span> <span class="token keyword">typeof</span> onRejected <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> <span class="token function-variable function">onRejected</span> <span class="token operator">:</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> reason <span class="token punctuation">}</span>

  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>æ³¨æ„<code>throw</code>æŠ›å‡ºå¼‚å¸¸å°†è¢«<code>try...catch</code>æ•è·ï¼Œè¿›è€Œæ‹’ç»æ–°<code>promise</code></p></blockquote> <h2 id="ç±»å‹"><a href="#ç±»å‹" class="header-anchor">#</a> ç±»å‹</h2> <p>â€ƒâ€ƒå¦‚ä½•å¤„ç†ä¸åŒç±»å‹<code>x</code>å‘¢ï¼Ÿ</p> <p>â€ƒâ€ƒè¿˜æ˜¯å‚è€ƒè§„èŒƒ<a href="https://promisesaplus.com/#the-promise-resolution-procedure" target="_blank" rel="noopener noreferrer">ã€ŒPromise/A+ 2.3ã€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>å„å­ç« èŠ‚ï¼Œä»¥ä¼˜åŒ–<code>resolvePromise</code>å¤„ç†å‡½æ•°ã€‚</p> <h3 id="å¾ªç¯å¼•ç”¨"><a href="#å¾ªç¯å¼•ç”¨" class="header-anchor">#</a> å¾ªç¯å¼•ç”¨</h3> <p>â€ƒâ€ƒåŸç”Ÿ<code>Promise</code>å¾ªç¯å¼•ç”¨ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> p2 <span class="token operator">=</span> p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> p2
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// {</span>
<span class="token comment">//   [[PromiseState]]: 'rejected',</span>
<span class="token comment">//   [[PromiseResult]]: TypeError: Chaining cycle detected for promise #&lt;Promise&gt;,</span>
<span class="token comment">// }</span>
</code></pre></div><p>â€ƒâ€ƒç›¸å…³ç‰¹å¾åŒ…æ‹¬ã€‚</p> <ul><li>å¦‚æœ<code>promise</code>å’Œ<code>x</code>å¼•ç”¨åŒä¸€å¯¹è±¡ï¼Œåˆ™æ‹’ç»<code>promise</code>ï¼ŒåŸå› ä¸ºä¸€ä¸ª<code>TypeError</code>â€”â€”<a href="https://promisesaplus.com/#point-48" target="_blank" rel="noopener noreferrer">ã€ŒPromise/A+ 2.3.1ã€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>â€ƒâ€ƒä»£ç ä¼˜åŒ–ä¸ºã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">resolvePromise</span><span class="token punctuation">(</span><span class="token parameter">promise<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>promise <span class="token operator">===</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'Chaining cycle detected for promise #&lt;Promise&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="ä¼ é€’æ€§"><a href="#ä¼ é€’æ€§" class="header-anchor">#</a> ä¼ é€’æ€§</h3> <p>â€ƒâ€ƒåŸç”Ÿ<code>Promise</code>å‡½æ•°å‚æ•°<code>onFulfilled</code>è¿”å›<code>promise</code>ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> p2
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// {</span>
<span class="token comment">//   [[PromiseState]]: 'rejected',</span>
<span class="token comment">//   [[PromiseResult]]: 1,</span>
<span class="token comment">// }</span>
</code></pre></div><p>â€ƒâ€ƒç›¸å…³ç‰¹å¾åŒ…æ‹¬ã€‚</p> <ul><li>å¦‚æœ<code>x</code>æ˜¯ç­‰å¾…æ€ï¼Œ<code>promise</code>å¿…é¡»ä¿æŒç­‰å¾…æ€ï¼Œç›´åˆ°<code>x</code>è¢«è§£å†³æˆ–è¢«æ‹’ç»â€”â€”<a href="https://promisesaplus.com/#point-50" target="_blank" rel="noopener noreferrer">ã€ŒPromise/A+ 2.3.2.1ã€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>å¦‚æœ<code>x</code>æ˜¯è§£å†³æ€ï¼Œç”¨ç›¸åŒçš„å€¼è§£å†³<code>promise</code>â€”â€”<a href="https://promisesaplus.com/#point-51" target="_blank" rel="noopener noreferrer">ã€ŒPromise/A+ 2.3.2.2ã€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>å¦‚æœ<code>x</code>æ˜¯æ‹’ç»æ€ï¼Œç”¨ç›¸åŒçš„åŸå› æ‹’ç»<code>promise</code>â€”â€”<a href="https://promisesaplus.com/#point-52" target="_blank" rel="noopener noreferrer">ã€ŒPromise/A+ 2.3.2.3ã€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>â€ƒâ€ƒä¹Ÿå°±æ˜¯<code>promise</code>çŠ¶æ€ä¸<code>x</code>å§‹ç»ˆéƒ½ä¿æŒä¸€è‡´ã€‚</p> <p>â€ƒâ€ƒå¯èƒ½ä¼šå­˜åœ¨<code>x</code>åˆå§‹ä¸ºç­‰å¾…æ€ï¼Œç„¶ååˆè½¬å˜ä¸ºè§£å†³æ€æˆ–æ‹’ç»æ€ã€‚è¿‡ç¨‹ä¸­ä¸¤è€…çŠ¶æ€å§‹ç»ˆä¸€è‡´ï¼Œè‹¥<code>x</code>çŠ¶æ€è½¬å˜ï¼Œ<code>promise</code>çŠ¶æ€ä¹Ÿå°†è½¬å˜ã€‚</p> <p>â€ƒâ€ƒé‚£å¦‚ä½•çŸ¥é“<code>x</code>çŠ¶æ€è½¬å˜å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯<code>then</code>æ–¹æ³•ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>x<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>onFulfilled<span class="token punctuation">,</span> onRejected<span class="token punctuation">)</span>
</code></pre></div><p>â€ƒâ€ƒ;<code>x</code>è½¬å˜ä¸ºè§£å†³æ€æ—¶å°†è¿è¡Œ<code>onFulfilled</code>ï¼Œè½¬å˜ä¸ºæ‹’ç»æ€æ—¶å°†è¿è¡Œ<code>onRejected</code>ã€‚</p> <p>â€ƒâ€ƒé‚£æˆ‘ä»¬å°±å¯åœ¨<code>onFulfilled</code>æˆ–<code>onRejected</code>å†…éƒ¨å»ä¿®æ”¹<code>promise</code>çŠ¶æ€ã€‚</p> <p>â€ƒâ€ƒä»£ç ä¼˜åŒ–ä¸ºã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">resolvePromise</span><span class="token punctuation">(</span><span class="token parameter">promise<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    x<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>â€ƒâ€ƒç®€åŒ–ä¸ºã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">resolvePromise</span><span class="token punctuation">(</span><span class="token parameter">promise<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    x<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="å¹¿ä¹‰å¯¹è±¡"><a href="#å¹¿ä¹‰å¯¹è±¡" class="header-anchor">#</a> å¹¿ä¹‰å¯¹è±¡</h3> <p>â€ƒâ€ƒä½•ä¸ºå¹¿ä¹‰å¯¹è±¡å‘¢ï¼Ÿ</p> <p>â€ƒâ€ƒèƒ½æ·»åŠ å±æ€§æˆ–æ–¹æ³•çš„å˜é‡ï¼Œéƒ½ç§°ä¹‹ä¸ºå¹¿ä¹‰ä¸Šçš„å¯¹è±¡ï¼Œä¾‹å¦‚æ•°ç»„ã€å‡½æ•°ç­‰ã€‚</p> <p>â€ƒâ€ƒåˆ›å»º<code>isObject</code>å·¥å…·å‡½æ•°ï¼Œæ›´å¤šå‚è€ƒ <a href="https://www.lodashjs.com/docs/lodash.isObject" target="_blank" rel="noopener noreferrer">lodash.isObject<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">isObject</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> type <span class="token operator">=</span> <span class="token keyword">typeof</span> value

  <span class="token keyword">return</span> value <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">||</span> type <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>â€ƒâ€ƒç„¶åé˜…è¯»è§„èŒƒ<a href="https://promisesaplus.com/#point-53" target="_blank" rel="noopener noreferrer">ã€ŒPromise/A+ 2.3.3ã€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>å°èŠ‚ï¼Œçœç•¥éƒ¨åˆ†æš‚æ—¶ä¸è€ƒè™‘ã€‚</p> <ul><li>å¦‚æœ<code>x</code>æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–å‡½æ•°ï¼ˆå¹¿ä¹‰å¯¹è±¡ï¼‰
<ul><li>è®©<code>then</code>ä¸º<code>x.then</code></li> <li>å¦‚æœè·å–<code>x.then</code>å¯¼è‡´æŠ›å‡ºäº†ä¸€ä¸ªå¼‚å¸¸<code>e</code>ï¼Œç”¨<code>e</code>ä½œä¸ºåŸå› æ‹’ç»<code>promise</code></li> <li>å¦‚æœ<code>then</code>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨<code>x</code>ä½œä¸º<code>this</code>è°ƒç”¨å®ƒï¼Œä¸”åŒ…å«ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«ä¸º<code>resolvePromise</code>å’Œ<code>rejectPromise</code> <ul><li>å¦‚æœ<code>resolvePromise</code>ç”¨ä¸€ä¸ªå€¼<code>y</code>è°ƒç”¨ï¼Œè¿è¡Œ<code>[[Resolve]](promise, y)</code></li> <li>å¦‚æœ<code>rejectPromise</code>ç”¨ä¸€ä¸ªåŸå› <code>r</code>è°ƒç”¨ï¼Œç”¨<code>r</code>æ‹’ç»<code>promise</code></li> <li><code>...</code></li> <li>å¦‚æœè°ƒç”¨<code>then</code>æŠ›å‡ºäº†ä¸€ä¸ªå¼‚å¸¸<code>e</code> <ul><li><code>...</code></li> <li>å¦åˆ™ç”¨<code>e</code>ä½œä¸ºä½œä¸ºåŸå› æ‹’ç»<code>promise</code></li></ul></li></ul></li> <li>å¦‚æœ<code>then</code>ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨<code>x</code>è§£å†³<code>promise</code></li></ul></li></ul> <p>â€ƒâ€ƒè½¬è¯‘ä¸ºä»£ç ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">resolvePromise</span><span class="token punctuation">(</span><span class="token parameter">promise<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> then

      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        then <span class="token operator">=</span> x<span class="token punctuation">.</span>then
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> then <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token function">then</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>
            x<span class="token punctuation">,</span>
            <span class="token parameter">y</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> y<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token parameter">r</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token function">reject</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>â€ƒâ€ƒè§„èŒƒä¸­è¿è¡Œ<code>[[Resolve]](promise, y)</code>ï¼Œå³é€’å½’<code>resolvePromise</code>ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p> <p>â€ƒâ€ƒåŸå› åœ¨äº<code>y</code>å€¼å¯èƒ½è¿˜æ˜¯<code>promise</code>æˆ–è€…å¹¿ä¹‰å¯¹è±¡ç­‰ç­‰ã€‚</p> <p>â€ƒâ€ƒæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªåŸç”Ÿ<code>Promise</code>ç¤ºä¾‹ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> thenable1 <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">reslove</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">reslove</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> thenable2 <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>thenable1<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> thenable2
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// {</span>
<span class="token comment">//   [[PromiseState]]: 'fulfilled',</span>
<span class="token comment">//   [[PromiseResult]]: 1,</span>
<span class="token comment">// }</span>
</code></pre></div><h3 id="ä¼˜å…ˆçº§"><a href="#ä¼˜å…ˆçº§" class="header-anchor">#</a> ä¼˜å…ˆçº§</h3> <p>â€ƒâ€ƒä»¥ä¸‹ä¸ºåˆšæ‰çœç•¥çš„éƒ¨åˆ†ã€‚</p> <ul><li>å¦‚æœ<code>then</code>æ˜¯ä¸€ä¸ªå‡½æ•°<code>...</code> <ul><li><code>...</code></li> <li><code>...</code></li> <li>å¦‚æœ<code>resolvePromise</code>å’Œ<code>rejectPromise</code>éƒ½è¢«è°ƒç”¨ï¼Œæˆ–è€…å¯¹å…¶ä¸­ä¸€ä¸ªå¤šæ¬¡è°ƒç”¨ï¼Œé‚£ä¹ˆç¬¬ä¸€æ¬¡è°ƒç”¨ä¼˜å…ˆï¼Œä»¥åçš„è°ƒç”¨éƒ½ä¼šè¢«å¿½ç•¥</li> <li>å¦‚æœè°ƒç”¨<code>then</code>æŠ›å‡ºäº†<code>...</code> <ul><li>å¦‚æœ<code>resolvePromise</code>æˆ–<code>rejectPromise</code>å·²ç»è¢«è°ƒç”¨ï¼Œåˆ™å¿½ç•¥å®ƒ</li> <li><code>...</code></li></ul></li></ul></li></ul> <p>â€ƒâ€ƒä¸ºäº†é™åˆ¶å“ªç§æƒ…å†µå‘¢ï¼Ÿ</p> <p>â€ƒâ€ƒè¿˜æ˜¯æ¥çœ‹ä¸€ä¸ªåŸç”Ÿ<code>Promise</code>ç¤ºä¾‹ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> thenable1 <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">reslove</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">reslove</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> thenable2 <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>thenable1<span class="token punctuation">)</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> thenable2
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// {</span>
<span class="token comment">//   [[PromiseState]]: 'fulfilled',</span>
<span class="token comment">//   [[PromiseResult]]: 2,</span>
<span class="token comment">// }</span>
</code></pre></div><p>â€ƒâ€ƒä»£ç å¦‚ä½•ä¼˜åŒ–å‘¢ï¼Ÿ</p> <p>â€ƒâ€ƒæˆ‘ä»¬å¯å®šä¹‰å¸ƒå°”å˜é‡<code>called</code>ï¼Œæ ‡è®°æ˜¯å¦è¿è¡Œå‚æ•°<code>resolvePromise</code>æˆ–<code>rejectPromise</code>ã€‚ç„¶ååœ¨ç¬¬ä¸€æ¬¡è¿è¡Œæ—¶å°†<code>called</code>ä¿®æ”¹ä¸º<code>true</code>ï¼Œè€Œä»¥åçš„éƒ½ä¼š<code>return</code>è¢«å¿½ç•¥ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> then <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> called <span class="token operator">=</span> <span class="token boolean">false</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token function">then</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>
      x<span class="token punctuation">,</span>
      <span class="token parameter">y</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>called<span class="token punctuation">)</span> <span class="token keyword">return</span>
        called <span class="token operator">=</span> <span class="token boolean">true</span>

        <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> y<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token parameter">r</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>called<span class="token punctuation">)</span> <span class="token keyword">return</span>
        called <span class="token operator">=</span> <span class="token boolean">true</span>

        <span class="token function">reject</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>called<span class="token punctuation">)</span> <span class="token keyword">return</span>
    called <span class="token operator">=</span> <span class="token boolean">true</span>

    <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="thenable"><a href="#thenable" class="header-anchor">#</a> thenable</h3> <p>â€ƒâ€ƒè§„èŒƒ<a href="https://promisesaplus.com/#point-6" target="_blank" rel="noopener noreferrer">ã€ŒPromise/A+ 1.1ã€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>å°ç»“é™ˆè¿°äº†ã€‚</p> <p>â€ƒâ€ƒ;<code>promise</code>æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–å‡½æ•°ï¼ˆå¹¿ä¹‰å¯¹è±¡ï¼‰ï¼Œå­˜åœ¨<code>then</code>æ–¹æ³•ä¸”è¡Œä¸ºç¬¦åˆè§„èŒƒã€‚</p> <p>â€ƒâ€ƒç¬¬ä¸‰æ–¹<code>Promise</code>åº“ã€åŸç”Ÿ<code>Promise</code>ä»¥åŠæˆ‘ä»¬æ‰‹å†™ç‰ˆæœ¬<code>Promise</code>ï¼Œåˆ›å»ºçš„<code>promise</code>å®ä¾‹ï¼Œå…¶å®éƒ½æ˜¯æ ‡å‡†çš„<code>promise</code>ç±»å‹ã€‚</p> <p>â€ƒâ€ƒè€Œä»£ç ä¸­<code>x instanceof Promise</code>è¯­å¥ï¼Œæ£€éªŒæ˜¯å¦ä¸º<code>promise</code>ç±»å‹ï¼Œå°±æœ‰é—®é¢˜äº†ã€‚ä¾‹å¦‚<code>x</code>è¢«ç¬¬ä¸‰æ–¹åº“åˆ›å»ºï¼Œä¹Ÿæ˜¯æ ‡å‡†<code>promise</code>ç±»å‹ï¼Œä½†æ˜¯å¹¶ä¸ä¼šè¿è¡Œ<code>if</code>è¯­å¥ä½“ï¼Œè€Œæ˜¯é”™è¯¯åœ°è¿è¡Œ<code>else</code>è¯­å¥ä½“ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">resolvePromise</span><span class="token punctuation">(</span><span class="token parameter">promise<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>â€ƒâ€ƒè¿˜æœ‰æ–¹æ³•å¯ç¡®å®š<code>x</code>ä¸º<code>promise</code>ç±»å‹å—ï¼Ÿç­”æ¡ˆæ˜¯æ²¡æœ‰ã€‚</p> <p>â€ƒâ€ƒæ€ä¹ˆåŠå‘¢ï¼Ÿ</p> <p>â€ƒâ€ƒæ—¢ç„¶æ— æ³•æ£€éªŒ<code>promise</code>ç±»å‹ï¼Œé‚£å°±é€€è€Œæ±‚å…¶æ¬¡ï¼Œæ£€éªŒç±»ä¼¼<code>promise</code>ç±»å‹çš„ï¼Œå³é¸­å¼è¾©å‹ã€‚</p> <blockquote><p>é¸­å­ç±»å‹ï¼ˆ<code>duck typing</code>ï¼‰ï¼Œä¹Ÿå«é¸­å¼è¾©å‹ï¼Œä¸€åªé¸Ÿèµ°èµ·æ¥åƒé¸­å­ã€æ¸¸æ³³èµ·æ¥åƒé¸­å­ã€å«èµ·æ¥ä¹Ÿåƒé¸­å­ï¼Œé‚£ä¹ˆè¿™åªé¸Ÿå°±å¯ä»¥è¢«ç§°ä¸ºé¸­å­</p></blockquote> <p>â€ƒâ€ƒè§„èŒƒ<a href="https://promisesaplus.com/#point-6" target="_blank" rel="noopener noreferrer">ã€ŒPromise/A+ 1.2ã€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>æå‡ºäº†<code>thenable</code>ç±»å‹ï¼Œå³å®šä¹‰äº†<code>then</code>æ–¹æ³•çš„å¯¹è±¡æˆ–å‡½æ•°ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><code>thenable</code>æ˜¯<code>promise</code>çš„é¸­å­ç±»å‹</p></blockquote> <p>â€ƒâ€ƒæ£€éªŒæ˜¯å¦ä¸º<code>promise</code>ç±»å‹ï¼Œåˆ™é™çº§ä¸ºæ£€éªŒæ˜¯å¦ä¸º<code>thenable</code>ç±»å‹ã€‚</p> <p>â€ƒâ€ƒä»£ç ä¿®æ”¹ä¸ºã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">resolvePromise</span><span class="token punctuation">(</span><span class="token parameter">promise<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>promise <span class="token operator">===</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'Chaining cycle detected for promise #&lt;Promise&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> then

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      then <span class="token operator">=</span> x<span class="token punctuation">.</span>then
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> then <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> called <span class="token operator">=</span> <span class="token boolean">false</span>

      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token function">then</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>
          x<span class="token punctuation">,</span>
          <span class="token parameter">y</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>called<span class="token punctuation">)</span> <span class="token keyword">return</span>
            called <span class="token operator">=</span> <span class="token boolean">true</span>

            <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> y<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token parameter">r</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>called<span class="token punctuation">)</span> <span class="token keyword">return</span>
            called <span class="token operator">=</span> <span class="token boolean">true</span>

            <span class="token function">reject</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>called<span class="token punctuation">)</span> <span class="token keyword">return</span>
        called <span class="token operator">=</span> <span class="token boolean">true</span>

        <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="header-anchor">#</a> æµ‹è¯•</h2> <p>â€ƒâ€ƒå®‰è£…å®˜æ–¹æµ‹è¯•ç”¨ä¾‹ <a href="https://github.com/promises-aplus/promises-tests" target="_blank" rel="noopener noreferrer">promises-aplus-tests<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>npm i promises<span class="token operator">-</span>aplus<span class="token operator">-</span>tests <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><p>â€ƒâ€ƒ;<code>promise</code>ä»£ç ä¸­æ–°å¢ä»¥ä¸‹ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// promise.js</span>
<span class="token keyword">class</span> <span class="token class-name">Promise</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>

Promise<span class="token punctuation">.</span><span class="token function-variable function">deferred</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  result<span class="token punctuation">.</span>promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    result<span class="token punctuation">.</span>resolve <span class="token operator">=</span> resolve
    result<span class="token punctuation">.</span>reject <span class="token operator">=</span> reject
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> result
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Promise
</code></pre></div><p>â€ƒâ€ƒæ–°å¢æµ‹è¯•å‘½ä»¤ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// package.json</span>
<span class="token punctuation">{</span>
  <span class="token operator">...</span>
  <span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;promises-aplus-tests promise.js&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
  <span class="token string-property property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;promises-aplus-tests&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.1.2&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>â€ƒâ€ƒè¿è¡Œ<code>npm run test</code>ã€‚</p> <p><img src="/js/promise-coding/test.gif" alt=""></p> <h2 id="å°ç»“"><a href="#å°ç»“" class="header-anchor">#</a> å°ç»“</h2> <p>â€ƒâ€ƒå…¨æ–‡å…±è®¡ä¸¤ä¸‡äº”åƒå­—æœ‰ä½™ï¼Œå‚è€ƒ<code>Promise/A+</code>è§„èŒƒæ‰‹å†™äº†<code>then</code>æ–¹æ³•å’Œ<code>promise</code>è§£å†³ç¨‹åºã€‚</p> <p>â€ƒâ€ƒç›¸å…³ä»£ç å¯å‚è€ƒ <a href="https://github.com/dongwei1125/promise-coding" target="_blank" rel="noopener noreferrer">promise-coding<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ä»“åº“ï¼Œæ”¯æŒ<code>node</code>å’Œæµè§ˆå™¨ç¯å¢ƒæµ‹è¯•ã€‚</p> <p>â€ƒâ€ƒå¦‚ä½•æ‰‹å†™<code>Promise</code>åˆ°æ­¤å°±ç»“æŸäº†ã€‚</p> <h2 id="æ‰©å±•"><a href="#æ‰©å±•" class="header-anchor">#</a> æ‰©å±•</h2> <p>â€ƒâ€ƒå­¦æœ‰ä½™åŠ›æˆ–æ„çŠ¹æœªå°½çš„ä¼™ä¼´ä»¬ã€‚</p> <p>â€ƒâ€ƒè´´å‡ºä¸¤ä¸ªä»£ç ç‰‡æ®µï¼Œå¯åœ¨åŸç”Ÿ<code>Promise</code>ä¸æ‰‹å†™<code>Promise</code>ç¯å¢ƒä¸‹è¿è¡Œã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 1</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 2</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>â€ƒâ€ƒçœ‹çœ‹èƒ½å¦åˆ†æå‡ºä¸¤è€…ä¹‹é—´çš„ç»†å¾®å·®å¼‚ï¼Ÿç­”æ¡ˆæ˜¯ä¸èƒ½ã€‚</p> <p>â€ƒâ€ƒæ›´å¤šè¯·æŒç»­å…³æ³¨æ›´æ–‡ï¼Œæˆ–åœ¨å‚è€ƒé“¾æ¥ä¸­æ¢ç´¢ä¸€äºŒã€‚</p> <h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="header-anchor">#</a> å‚è€ƒ</h2> <ul><li><a href="https://www.ituring.com.cn/article/66566" target="_blank" rel="noopener noreferrer">Promise/A+ è§„èŒƒè¯‘æ–‡<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.zhihu.com/question/456775221" target="_blank" rel="noopener noreferrer">åŸç”Ÿ Promise å’Œæ‰‹å†™ Promise çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.zhihu.com/question/430549238" target="_blank" rel="noopener noreferrer">resolve æ—¶åº<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.zhihu.com/question/453677175" target="_blank" rel="noopener noreferrer">V8 æºç è§£è¯» Promise<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="ğŸ‰-å†™åœ¨æœ€å"><a href="#ğŸ‰-å†™åœ¨æœ€å" class="header-anchor">#</a> ğŸ‰ å†™åœ¨æœ€å</h2> <p>ğŸ»ä¼™ä¼´ä»¬ï¼Œå¦‚æœä½ å·²ç»çœ‹åˆ°äº†è¿™é‡Œï¼Œè§‰å¾—è¿™ç¯‡æ–‡ç« æœ‰å¸®åŠ©åˆ°ä½ çš„è¯ä¸å¦¨ç‚¹èµğŸ‘æˆ– <a href="https://github.com/dongwei1125/blog" target="_blank" rel="noopener noreferrer">Star<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> âœ¨æ”¯æŒä¸€ä¸‹å“¦ï¼</p> <p>æ‰‹åŠ¨ç å­—ï¼Œå¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºæŒ‡æ­£ğŸ’¬~</p> <p>ä½ çš„æ”¯æŒå°±æ˜¯æˆ‘æ›´æ–°çš„æœ€å¤§åŠ¨åŠ›ğŸ’ª~</p> <p><a href="https://github.com/dongwei1125" target="_blank" rel="noopener noreferrer">GitHub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> / <a href="https://gitee.com/dongwei1125" target="_blank" rel="noopener noreferrer">Gitee<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€<a href="https://dongwei1125.github.io/" target="_blank" rel="noopener noreferrer">GitHub Pages<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€<a href="https://juejin.cn/user/2621689331987783" target="_blank" rel="noopener noreferrer">æ˜é‡‘<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€<a href="https://blog.csdn.net/Don_GW" target="_blank" rel="noopener noreferrer">CSDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> åŒæ­¥æ›´æ–°ï¼Œæ¬¢è¿å…³æ³¨ğŸ˜‰~</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">æœ€åæ›´æ–°æ—¶é—´:</span> <span class="time">3/1/2023, 10:49:04 PM</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.0aa97f73.js" defer></script><script src="/assets/js/2.f850a8ef.js" defer></script><script src="/assets/js/46.29956259.js" defer></script>
  </body>
</html>
