<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>关于 JS 与 CSS 是否阻塞 DOM 的渲染和解析 | DonV</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/header.jpg">
    <meta name="description" content="A paper about JavaScript, HTML and CSS.">
    
    <link rel="preload" href="/assets/css/0.styles.87611319.css" as="style"><link rel="preload" href="/assets/js/app.0aa97f73.js" as="script"><link rel="preload" href="/assets/js/2.f850a8ef.js" as="script"><link rel="preload" href="/assets/js/29.7d932073.js" as="script"><link rel="prefetch" href="/assets/js/10.cb041c1b.js"><link rel="prefetch" href="/assets/js/11.1aadbcee.js"><link rel="prefetch" href="/assets/js/12.77cc8e56.js"><link rel="prefetch" href="/assets/js/13.7e8162d9.js"><link rel="prefetch" href="/assets/js/14.dea6ba67.js"><link rel="prefetch" href="/assets/js/15.a786d687.js"><link rel="prefetch" href="/assets/js/16.163edf25.js"><link rel="prefetch" href="/assets/js/17.3a0232cb.js"><link rel="prefetch" href="/assets/js/18.91bd2dd7.js"><link rel="prefetch" href="/assets/js/19.a36993f8.js"><link rel="prefetch" href="/assets/js/20.30dd9f79.js"><link rel="prefetch" href="/assets/js/21.5e3c83a3.js"><link rel="prefetch" href="/assets/js/22.88d5e321.js"><link rel="prefetch" href="/assets/js/23.b54a65a7.js"><link rel="prefetch" href="/assets/js/24.51df379f.js"><link rel="prefetch" href="/assets/js/25.79342bd2.js"><link rel="prefetch" href="/assets/js/26.643d5441.js"><link rel="prefetch" href="/assets/js/27.54b7d7b4.js"><link rel="prefetch" href="/assets/js/28.d01a4aee.js"><link rel="prefetch" href="/assets/js/3.31ebf682.js"><link rel="prefetch" href="/assets/js/30.4c2f5636.js"><link rel="prefetch" href="/assets/js/31.b00c42d5.js"><link rel="prefetch" href="/assets/js/32.e9a0f488.js"><link rel="prefetch" href="/assets/js/33.f510b5fd.js"><link rel="prefetch" href="/assets/js/34.6e78f32f.js"><link rel="prefetch" href="/assets/js/35.04d666a2.js"><link rel="prefetch" href="/assets/js/36.900a3beb.js"><link rel="prefetch" href="/assets/js/37.19ddf8d7.js"><link rel="prefetch" href="/assets/js/38.35f899bd.js"><link rel="prefetch" href="/assets/js/39.fe9ea525.js"><link rel="prefetch" href="/assets/js/4.3c7083a8.js"><link rel="prefetch" href="/assets/js/40.0d116ce0.js"><link rel="prefetch" href="/assets/js/41.6cdce4cf.js"><link rel="prefetch" href="/assets/js/42.ab0bd0d5.js"><link rel="prefetch" href="/assets/js/43.66c8f8eb.js"><link rel="prefetch" href="/assets/js/44.ac02981e.js"><link rel="prefetch" href="/assets/js/45.479814b0.js"><link rel="prefetch" href="/assets/js/46.29956259.js"><link rel="prefetch" href="/assets/js/47.a89cf7d2.js"><link rel="prefetch" href="/assets/js/48.859e3502.js"><link rel="prefetch" href="/assets/js/49.d0fa0b25.js"><link rel="prefetch" href="/assets/js/5.206809f3.js"><link rel="prefetch" href="/assets/js/50.d051084c.js"><link rel="prefetch" href="/assets/js/51.fa831e6a.js"><link rel="prefetch" href="/assets/js/52.3ed98760.js"><link rel="prefetch" href="/assets/js/53.016b1c3c.js"><link rel="prefetch" href="/assets/js/54.c88e06c5.js"><link rel="prefetch" href="/assets/js/55.937bfe09.js"><link rel="prefetch" href="/assets/js/56.03003660.js"><link rel="prefetch" href="/assets/js/57.8bcda68a.js"><link rel="prefetch" href="/assets/js/58.286692ba.js"><link rel="prefetch" href="/assets/js/59.fbfe98aa.js"><link rel="prefetch" href="/assets/js/6.6f9d9bda.js"><link rel="prefetch" href="/assets/js/60.0975844e.js"><link rel="prefetch" href="/assets/js/61.0af6cf48.js"><link rel="prefetch" href="/assets/js/62.66c23699.js"><link rel="prefetch" href="/assets/js/63.7fda9b3f.js"><link rel="prefetch" href="/assets/js/7.6f64fba1.js"><link rel="prefetch" href="/assets/js/8.a163349f.js"><link rel="prefetch" href="/assets/js/9.9058d3cc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.87611319.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/header.jpg" alt="DonV" class="logo"> <span class="site-name can-hide">DonV</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/pages/js/nav.html" class="nav-link">
  JavaScript
</a></div><div class="nav-item"><a href="/pages/html/nav.html" class="nav-link">
  HTML
</a></div><div class="nav-item"><a href="/pages/css/nav.html" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/pages/other/nav.html" class="nav-link">
  其它
</a></div><div class="nav-item"><a href="/pages/app/nav.html" class="nav-link">
  应用
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于" class="dropdown-title"><span class="title">关于</span> <span class="arrow down"></span></button> <button type="button" aria-label="关于" class="mobile-dropdown-title"><span class="title">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/dongwei1125" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/dongwei1125" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/2621689331987783" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/Don_GW" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/~dongwei1125" target="_blank" rel="noopener noreferrer" class="nav-link external">
  NPM
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/pages/js/nav.html" class="nav-link">
  JavaScript
</a></div><div class="nav-item"><a href="/pages/html/nav.html" class="nav-link">
  HTML
</a></div><div class="nav-item"><a href="/pages/css/nav.html" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/pages/other/nav.html" class="nav-link">
  其它
</a></div><div class="nav-item"><a href="/pages/app/nav.html" class="nav-link">
  应用
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于" class="dropdown-title"><span class="title">关于</span> <span class="arrow down"></span></button> <button type="button" aria-label="关于" class="mobile-dropdown-title"><span class="title">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/dongwei1125" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/dongwei1125" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/2621689331987783" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/Don_GW" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/~dongwei1125" target="_blank" rel="noopener noreferrer" class="nav-link external">
  NPM
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>关于 JS 与 CSS 是否阻塞 DOM 的渲染和解析</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/html/perform/block-dom.html#前言" class="sidebar-link">前言</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/html/perform/block-dom.html#准备工作" class="sidebar-link">准备工作</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/html/perform/block-dom.html#css-不会阻塞-dom-解析-但是会阻塞-dom-渲染" class="sidebar-link">CSS 不会阻塞 DOM 解析，但是会阻塞 DOM 渲染</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/html/perform/block-dom.html#js-会阻塞-dom-解析" class="sidebar-link">JS 会阻塞 DOM 解析</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/html/perform/block-dom.html#css-会阻塞-js-的执行" class="sidebar-link">CSS 会阻塞 JS 的执行</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/html/perform/block-dom.html#js-会触发页面渲染" class="sidebar-link">JS 会触发页面渲染</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/html/perform/block-dom.html#body-内的-css" class="sidebar-link">Body 内的 CSS</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/html/perform/block-dom.html#综上所述" class="sidebar-link">综上所述</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/html/perform/block-dom.html#🎉-写在最后" class="sidebar-link">🎉 写在最后</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="关于-js-与-css-是否阻塞-dom-的渲染和解析"><a href="#关于-js-与-css-是否阻塞-dom-的渲染和解析" class="header-anchor">#</a> 关于 JS 与 CSS 是否阻塞 DOM 的渲染和解析</h1> <p><img src="/html/perform/block-dom/banner.jpg" alt=""></p> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>  最近系统梳理<code>HTML5</code>所有涉及到的标签时，梳理至<code>&lt;link&gt;</code>和<code>&lt;script&gt;</code>标签时，碰巧想到一个困扰很久的问题，即一般把<code>&lt;script&gt;</code>放在<code>&lt;body&gt;</code>尾部，<code>&lt;link&gt;</code>标签放在<code>&lt;head&gt;</code>内部，而页面通过<code>CDN</code>引入第三方框架或库时，基本都是将其<code>&lt;script&gt;</code>标签放在<code>&lt;link&gt;</code>标签前面。</p> <p>  可能此方式已经成为了约定俗成，但是究竟其好处在哪里，或者说其它的方式为什么不可取，想必你也和我有同样的疑问，那就接着来往下看吧。</p> <h2 id="准备工作"><a href="#准备工作" class="header-anchor">#</a> 准备工作</h2> <p>  首先需要做的准备工作是，搭建一个服务器，目的是为了返回<code>css</code>样式和<code>js</code>脚本，并且让服务器根据传递的参数，固定延时返回数据。</p> <p>  其目录结构如下，其中<code>index.js</code>和<code>style.css</code>就是用于返回的数据，<code>app.js</code>为服务器启动文件，<code>index.html</code>是用来测试案例的文件，剩余文件或文件夹可以忽略。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>├── <span class="token keyword">static</span>
│   ├── index<span class="token punctuation">.</span>js
│   ├── style<span class="token punctuation">.</span>css
├── app<span class="token punctuation">.</span>js
├── index<span class="token punctuation">.</span>html
├── <span class="token keyword">package</span><span class="token punctuation">.</span>json
├── node_modules<span class="token operator">/</span>
</code></pre></div><p>  涉及的相关代码也贴一下吧，方便复制调试。有必要说明一下，本地运行<code>node app.js</code>启动后，浏览器输入<code>http://127.0.0.1:3000/</code>就能访问到<code>index.html</code>，而访问<code>style.css</code>可以输入<code>http://127.0.0.1:3000/static/style.css?sleep=3000</code>，其中<code>sleep</code>参数则可自由控制<code>css</code>文件延时返回，例如想要文件<code>5s</code>后返回就设置<code>sleep=5000</code>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// app.js</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">3000</span>

<span class="token keyword">const</span> <span class="token function-variable function">sleepFun</span> <span class="token operator">=</span> <span class="token parameter">time</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">res</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> time<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">filter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> sleep <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>query <span class="token operator">||</span> <span class="token number">0</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>sleep<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">sleepFun</span><span class="token punctuation">(</span>sleep<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>filter<span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/static/'</span><span class="token punctuation">,</span> express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'./static/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./index.html'</span><span class="token punctuation">,</span> <span class="token string">'UTF-8'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span>

    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">app is running at http://127.0.0.1:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// static/index.js</span>
<span class="token keyword">var</span> p <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>

<span class="token comment">// static/style.css</span>
p <span class="token punctuation">{</span>
  <span class="token literal-property property">color</span><span class="token operator">:</span> lightblue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>  接着就是<code>index.html</code>的准备工作，其中<code>HTML</code>部分的架子就长下面那样，然后你只需要记住<code>DOMContentLoaded</code>事件将在页面<code>DOM</code>解析完成后触发。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">&quot;zh-CN&quot;</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> p <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span>

      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>hello world<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre></div><h2 id="css-不会阻塞-dom-解析-但是会阻塞-dom-渲染"><a href="#css-不会阻塞-dom-解析-但是会阻塞-dom-渲染" class="header-anchor">#</a> CSS 不会阻塞 DOM 解析，但是会阻塞 DOM 渲染</h2> <p>  首先在<code>index.html</code>插入如下<code>&lt;link&gt;</code>标签，然后在浏览器输入<code>http://127.0.0.1:3000/</code>访问此页面。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> p <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span>

      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">&quot;stylesheet&quot;</span> href<span class="token operator">=</span><span class="token string">&quot;./static/style.css?sleep=3000&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>hello world<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
</code></pre></div><p>  页面初始显示为空白，控制台打印出了<code>p</code>元素，同时浏览器标签页上加载<code>loading</code>，<code>3s</code>后页面显示出浅蓝色的<code>hello world</code>。</p> <p><img src="/html/perform/block-dom/css.gif" alt=""></p> <p>  以上情况也就说明，<code>CSS</code>不会阻塞<code>DOM</code>的解析，如果说<code>CSS</code>阻塞<code>DOM</code>解析的话，那么<code>p</code>标签不会被解析，进而<code>DOM</code>不会被解析完成，<code>CSS</code>请求过程中也就不可能会触发<code>DOMContentLoaded</code>事件。而且在<code>css</code>请求过程中，控制台立即打印出了<code>p</code>元素，因此<code>CSS</code>不会阻塞<code>DOM</code>的解析。</p> <p>  另一个情况就是，虽然<code>DOM</code>很早就被解析完成，但是<code>p</code>标签却迟迟没有渲染，原因在于<code>CSS</code>样式还未请求完成，在样式获取后<code>hello world</code>才被渲染出来，所以说<code>CSS</code>会阻塞页面渲染。</p> <p>  简单阐述一下浏览器的解析渲染过程，解析<code>DOM</code>生成<code>DOM Tree</code>，解析<code>CSS</code>生成<code>CSSOM Tree</code>，两者结合生成<code>render tree</code>渲染树，最后浏览器根据渲染树渲染至页面。由此可以看出<code>DOM Tree</code>的解析和<code>CSSOM Tree</code>的解析是互不影响的，两者是并行的。因此<code>CSS</code>不会阻塞页面<code>DOM</code>的解析，但是由于<code>render tree</code>的生成是依赖<code>DOM Tree</code>和<code>CSSOM Tree</code>的，因此<code>CSS</code>必然会阻塞<code>DOM</code>的渲染。</p> <p>  更为严谨一点的说，<code>CSS</code>会阻塞<code>render tree</code>的生成，进而会阻塞<code>DOM</code>的渲染。</p> <h2 id="js-会阻塞-dom-解析"><a href="#js-会阻塞-dom-解析" class="header-anchor">#</a> JS 会阻塞 DOM 解析</h2> <p>  为了避免加载<code>CSS</code>造成的干扰，如下仅关注<code>JS</code>的执行情况，其中<code>for</code>循环的循环体中逻辑暂不考虑，仅仅是让<code>JS</code>执行更多时间。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> p <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span>

      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    <span class="token keyword">const</span> p <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>hello world<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
</code></pre></div><p>  浏览器访问页面，初始时为空白且控制台打印<code>null</code>，浏览器<code>loading</code>短暂延时后，控制台打印出<code>p</code>标签同时页面渲染出<code>hello world</code>。</p> <p><img src="/html/perform/block-dom/js.gif" alt=""></p> <p>  以上情况很容易说明<code>JS</code>会阻塞<code>DOM</code>解析了，<code>JS</code>执行初控制台打印<code>null</code>，因为此时<code>p</code>标签还未被解析，<code>for</code>循环执行时，可以明显感觉到执行耗时，执行完成<code>p</code>标签被解析，此时触发<code>DOMContentLoaded</code>事件，控制台打印出<code>p</code>标签，同时页面渲染出<code>hello world</code>。</p> <p>  比较合理的解释就是，首先浏览器无法知晓<code>JS</code>的具体内容，倘若先解析<code>DOM</code>，万一<code>JS</code>内部全部删除掉<code>DOM</code>，那么浏览器就白忙活了，所以就干脆暂停解析<code>DOM</code>，等到<code>JS</code>执行完成再继续解析。</p> <h2 id="css-会阻塞-js-的执行"><a href="#css-会阻塞-js-的执行" class="header-anchor">#</a> CSS 会阻塞 JS 的执行</h2> <p>  如下在页内<code>JS</code>脚本前插入<code>&lt;link&gt;</code>标签，并且延时<code>3s</code>获取<code>CSS</code>样式。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> p <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span>

      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">&quot;stylesheet&quot;</span> href<span class="token operator">=</span><span class="token string">&quot;./static/style.css?sleep=3000&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;./static/index.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>hello world<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
</code></pre></div><p>  初始页面空白，浏览器<code>loading</code>加载<code>3s</code>后，控制台打印出<code>null</code>，紧接着打印出<code>p</code>标签，同时页面渲染出浅蓝色<code>p</code>标签。</p> <p><img src="/html/perform/block-dom/css-js.gif" alt=""></p> <p>  此情况好像是<code>CSS</code>不仅阻塞了<code>DOM</code>的解析，并且也阻塞了<code>DOM</code>渲染。</p> <p>  但是首先要思考下是什么阻塞了<code>DOM</code>的解析，刚刚已经证明了<code>CSS</code>不会阻塞<code>DOM</code>的解析，所以只可能是<code>JS</code>阻塞了<code>DOM</code>解析。但是<code>JS</code>只有两行代码，不会阻塞长达<code>3s</code>左右的时间。所以只有一个可能就是<code>CSS</code>会阻塞<code>JS</code>的执行。</p> <p>  因此输出结果也能大致分析出来了，首先解析到第一个<code>&lt;script&gt;</code>标签，<code>document</code>绑定上<code>DOMContentLoaded</code>事件，紧接着解析到<code>link</code>标签，浏览器请求<code>CSS</code>样式，由于<code>CSS</code>不会阻塞<code>DOM</code>解析，因此浏览器继续向下解析，发现第二个<code>&lt;script&gt;</code>标签，浏览器请求<code>JS</code>脚本，此时<code>JS</code>获取完成，但是由于<code>CSS</code>还在获取，<code>JS</code>需要一直等待其获取完成，所以不能立即执行。</p> <p>  而第二个<code>&lt;script&gt;</code>不能立即执行，导致它后面的<code>p</code>标签也没办法解析，原因则是<code>JS</code>会阻塞<code>DOM</code>解析。只有等待到<code>CSS</code>样式获取成功后，此时<code>JS</code>立即执行，控制台输出<code>null</code>，然后浏览器继续解析到<code>p</code>标签，解析完成，<code>DOMContentLoaded</code>事件触发，控制台输出<code>p</code>标签，最后浅蓝色<code>hello world</code>渲染至页面。</p> <p>  其实这样做也是有道理的，设想<code>JS</code>脚本中的内容是获取<code>DOM</code>元素的<code>CSS</code>样式属性，如果<code>JS</code>想要获取到<code>DOM</code>最新的正确的样式，势必需要所有的<code>CSS</code>加载完成，否则获取的样式可能是错误或者不是最新的。因此要等到<code>JS</code>脚本前面的<code>CSS</code>加载完成，<code>JS</code>才能再执行，并且不管<code>JS</code>脚本中是否获取<code>DOM</code>元素的样式，浏览器都要这样做。</p> <p>  回溯文章开头的那个疑问，所以一般将<code>&lt;script&gt;</code>放在<code>&lt;link&gt;</code>标签前面是有道理的。</p> <h2 id="js-会触发页面渲染"><a href="#js-会触发页面渲染" class="header-anchor">#</a> JS 会触发页面渲染</h2> <p>  如下<code>CSS</code>采用页内方式，其中颜色名及其<code>rgb</code>值分别为浅绿色<code>lightgreen</code>（<code>rgb(144, 238, 144)</code>）、粉色<code>pink</code>（<code>rgb(255, 192, 203)</code>）。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// index.html</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
    p <span class="token punctuation">{</span>
      <span class="token literal-property property">color</span><span class="token operator">:</span> lightgreen<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>hello<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;./static/index.js?sleep=2000&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>beautiful<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
    p <span class="token punctuation">{</span>
      <span class="token literal-property property">color</span><span class="token operator">:</span> pink<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;./static/index.js?sleep=4000&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>world<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
    p <span class="token punctuation">{</span>
      <span class="token literal-property property">color</span><span class="token operator">:</span> lightblue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>

<span class="token comment">// static/index.js</span>
<span class="token keyword">var</span> p <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> style <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getComputedStyle</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>style<span class="token punctuation">.</span>color<span class="token punctuation">)</span>
</code></pre></div><p>  页面初始渲染出浅绿色<code>hello</code>，紧接着<code>2s</code>后渲染出粉色<code>hello beautiful</code>且控制台打印<code>rgb(144, 238, 144)</code>，然后又<code>2s</code>后渲染出浅蓝色<code>hello beautiful world</code>且控制台打印<code>rgb(255, 192, 203)</code>。</p> <p><img src="/html/perform/block-dom/js-draw.gif" alt=""></p> <p>  上述结果大致分析为浏览器首先解析第一个<code>&lt;style&gt;</code>标签和<code>hello</code>文本的<code>p</code>标签，此时继续向下解析发现了第一个<code>&lt;script&gt;</code>标签，紧接着触发一次渲染，由于此过程非常快所以页面初始就能看到浅绿色<code>hello</code>。</p> <p>  然后浏览器发出<code>JS</code>请求，<code>2s</code>后<code>JS</code>获取完成立即运行控制台输出<code>rgb(144, 238, 144)</code>，<code>JS</code>运行完成后浏览器继续向下解析到<code>beautiful</code>文本的<code>p</code>标签和第二个<code>&lt;style&gt;</code>标签，再继续向下解析发现了第二个<code>&lt;script&gt;</code>标签，触发一次渲染，这个过程也是非常快，所以可以看到控制台输出结果和渲染粉色<code>hello beautiful</code>几乎是同时的。</p> <p>  解析到第二个<code>&lt;script&gt;</code>标签时，浏览器不会发出请求（稍作解释），<code>2s</code>后获取到<code>JS</code>脚本并执行，控制台输出<code>rgb(255, 192, 203)</code>，紧接着浏览器继续向下解析到<code>world</code>文本的<code>p</code>标签和第三个<code>&lt;style&gt;</code>标签，此时<code>DOM</code>解析完成，再进行正常的渲染，这个过程也是非常快，所以也能看到控制台输出结果和渲染浅蓝色<code>hello beautiful world</code>几乎是同时的。</p> <p>  现在来解答刚才那个问题，浏览器解析<code>DOM</code>时，虽然会一行一行向下解析，但是它会预先加载具有引用标记的外部资源（例如带有<code>src</code>标记的<code>&lt;script&gt;</code>标签），而在解析到此标签时，则无需再去加载，直接运行，以此提高运行效率。所以就会有上述两个输出结果间隔<code>2s</code>的情况，而不是<code>4s</code>，因为浏览器预先就一起加载了两个<code>&lt;script&gt;</code>脚本，第一个<code>&lt;script&gt;</code>脚本加载完成时，第二个<code>&lt;script&gt;</code>脚本还剩大概<code>2s</code>加载完成。</p> <p>  而这个结论才是解释为何<code>CSS</code>会阻塞<code>JS</code>的执行的真正原因，浏览器无法预先知道脚本的具体内容，因此在碰到<code>&lt;script&gt;</code>标签时，只好先渲染一次页面，确保<code>&lt;script&gt;</code>脚本内能获取到<code>DOM</code>的最新的样式。倘若在决定渲染页面时，还有尚未加载完成的<code>CSS</code>样式，只能等待其加载完成再去渲染页面。</p> <h2 id="body-内的-css"><a href="#body-内的-css" class="header-anchor">#</a> Body 内的 CSS</h2> <p>  来看一个较为特殊的情况。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> p <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span>

      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>hello<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">&quot;stylesheet&quot;</span> href<span class="token operator">=</span><span class="token string">&quot;./static/style.css?sleep=3000&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>world<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
</code></pre></div><p>  按照上述的所有结论，预先分析一下运行结果，首先浏览器解析<code>&lt;script&gt;</code>脚本，<code>document</code>上绑定了<code>DOMContentLoaded</code>事件，紧接着浏览器继续向下解析，发现了文本为<code>hello</code>的<code>p</code>标签和<code>&lt;link&gt;</code>标签，浏览器发起<code>CSS</code>请求，由于<code>CSS</code>不会阻塞<code>DOM</code>解析，浏览器继续向下解析至文本为<code>world</code>的<code>p</code>标签，此时页面解析完成，<code>DOMContentLoaded</code>事件触发控制台输出<code>p</code>标签，<code>3s</code>后页面渲染出浅蓝色<code>hello world</code>。</p> <p>  因此初始时页面空白，浏览器<code>loading</code>加载<code>3s</code>后，控制台打印出<code>p</code>标签，同时页面渲染出浅蓝色<code>hello world</code>。</p> <p>  但是实际结果并不是这样，先来看看<code>Chrome</code>浏览器下的表现。</p> <p><img src="/html/perform/block-dom/Chrome.gif" alt=""></p> <p>  再来看看<code>Firefox</code>浏览器下的表现。</p> <p><img src="/html/perform/block-dom/Firefox.gif" alt=""></p> <p>  接着再来看看<code>Opera</code>浏览器下的表现。</p> <p><img src="/html/perform/block-dom/Opera.gif" alt=""></p> <p>  ;<code>IE11</code>及以下浏览器的表现。</p> <p><img src="/html/perform/block-dom/IE11.gif" alt=""></p> <p>  ;<code>Edge</code>浏览器下的表现。</p> <p><img src="/html/perform/block-dom/Edge.gif" alt=""></p> <p>  怎么样，蒙了吧，<code>5</code>种浏览器<code>3</code>种表现形式，并且没有一种表现与预先分析的一致。</p> <p>  其实造成这种差异的原因，是一种被称为浏览器样式闪烁（<a href="https://webkit.org/blog/66/the-fouc-problem/" target="_blank" rel="noopener noreferrer">FOUC<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，<code>Flash of Unstyled Content</code>）的现象。</p> <p>  由于浏览器引擎的架构方式不一致，在浏览器解析到<code>Body</code>内的<code>CSS</code>的时候，浏览器引擎是可以做出选择的。</p> <p>  一种选择是它可以在请求<code>CSS</code>的时候暂停后续<code>DOM</code>的解析，在<code>CSS</code>加载完成后再继续往后解析，此情况就会造成<code>CSS</code>阻塞<code>DOM</code>的解析，导致页面<code>DOM</code>解析及其样式渲染推迟，而此表现形式就与<code>JS</code>的情况相似。</p> <p>  另一种选择是它也可以在请求<code>CSS</code>的时候继续往后解析，此时<code>CSS</code>的加载与<code>DOM</code>的解析就是并行的，等到<code>CSS</code>加载完成后再更新样式，此情况下部分<code>DOM</code>样式就会从默认样式立即跳转到有样式状态，形成样式闪烁。</p> <p>  此小结不必太过于纠结，只需记住<code>Body</code>内的<code>CSS</code>会由于浏览器的差异，呈现不同的表现形式，而这种现象一般称为<code>FOUC</code>，代码中应当极力避免此种情况发生即可。</p> <h2 id="综上所述"><a href="#综上所述" class="header-anchor">#</a> 综上所述</h2> <p>  综合上述所有情况，可以得出如下结论。</p> <ul><li><code>CSS</code>不会阻塞<code>DOM</code>解析，但是会阻塞<code>DOM</code>渲染，严谨一点则是<code>CSS</code>会阻塞<code>render tree</code>的生成，进而会阻塞<code>DOM</code>的渲染</li> <li><code>JS</code>会阻塞<code>DOM</code>解析</li> <li><code>CSS</code>会阻塞<code>JS</code>的执行</li> <li>浏览器遇到<code>&lt;script&gt;</code>标签且没有<code>defer</code>或<code>async</code>属性时会触发页面渲染</li> <li><code>Body</code>内部的外链<code>CSS</code>较为特殊，会形成<code>FOUC</code>现象，请慎用</li></ul> <h2 id="🎉-写在最后"><a href="#🎉-写在最后" class="header-anchor">#</a> 🎉 写在最后</h2> <p>🍻伙伴们，如果你已经看到了这里，觉得这篇文章有帮助到你的话不妨点赞👍或 <a href="https://github.com/dongwei1125/blog" target="_blank" rel="noopener noreferrer">Star<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ✨支持一下哦！</p> <p>手动码字，如有错误，欢迎在评论区指正💬~</p> <p>你的支持就是我更新的最大动力💪~</p> <p><a href="https://github.com/dongwei1125" target="_blank" rel="noopener noreferrer">GitHub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> / <a href="https://gitee.com/dongwei1125" target="_blank" rel="noopener noreferrer">Gitee<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<a href="https://dongwei1125.github.io/" target="_blank" rel="noopener noreferrer">GitHub Pages<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<a href="https://juejin.cn/user/2621689331987783" target="_blank" rel="noopener noreferrer">掘金<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<a href="https://blog.csdn.net/Don_GW" target="_blank" rel="noopener noreferrer">CSDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 同步更新，欢迎关注😉~</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间:</span> <span class="time">3/6/2022, 9:06:37 PM</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.0aa97f73.js" defer></script><script src="/assets/js/2.f850a8ef.js" defer></script><script src="/assets/js/29.7d932073.js" defer></script>
  </body>
</html>
