<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>比较全面的 Git 命令手册，几乎涵盖日常所有的使用场景（下） | DonV</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/header.jpg">
    <meta name="description" content="A paper about JavaScript, HTML and CSS.">
    
    <link rel="preload" href="/assets/css/0.styles.87611319.css" as="style"><link rel="preload" href="/assets/js/app.0aa97f73.js" as="script"><link rel="preload" href="/assets/js/2.f850a8ef.js" as="script"><link rel="preload" href="/assets/js/56.03003660.js" as="script"><link rel="prefetch" href="/assets/js/10.cb041c1b.js"><link rel="prefetch" href="/assets/js/11.1aadbcee.js"><link rel="prefetch" href="/assets/js/12.77cc8e56.js"><link rel="prefetch" href="/assets/js/13.7e8162d9.js"><link rel="prefetch" href="/assets/js/14.dea6ba67.js"><link rel="prefetch" href="/assets/js/15.a786d687.js"><link rel="prefetch" href="/assets/js/16.163edf25.js"><link rel="prefetch" href="/assets/js/17.3a0232cb.js"><link rel="prefetch" href="/assets/js/18.91bd2dd7.js"><link rel="prefetch" href="/assets/js/19.a36993f8.js"><link rel="prefetch" href="/assets/js/20.30dd9f79.js"><link rel="prefetch" href="/assets/js/21.5e3c83a3.js"><link rel="prefetch" href="/assets/js/22.88d5e321.js"><link rel="prefetch" href="/assets/js/23.b54a65a7.js"><link rel="prefetch" href="/assets/js/24.51df379f.js"><link rel="prefetch" href="/assets/js/25.79342bd2.js"><link rel="prefetch" href="/assets/js/26.643d5441.js"><link rel="prefetch" href="/assets/js/27.54b7d7b4.js"><link rel="prefetch" href="/assets/js/28.d01a4aee.js"><link rel="prefetch" href="/assets/js/29.7d932073.js"><link rel="prefetch" href="/assets/js/3.31ebf682.js"><link rel="prefetch" href="/assets/js/30.4c2f5636.js"><link rel="prefetch" href="/assets/js/31.b00c42d5.js"><link rel="prefetch" href="/assets/js/32.e9a0f488.js"><link rel="prefetch" href="/assets/js/33.f510b5fd.js"><link rel="prefetch" href="/assets/js/34.6e78f32f.js"><link rel="prefetch" href="/assets/js/35.04d666a2.js"><link rel="prefetch" href="/assets/js/36.900a3beb.js"><link rel="prefetch" href="/assets/js/37.19ddf8d7.js"><link rel="prefetch" href="/assets/js/38.35f899bd.js"><link rel="prefetch" href="/assets/js/39.fe9ea525.js"><link rel="prefetch" href="/assets/js/4.3c7083a8.js"><link rel="prefetch" href="/assets/js/40.0d116ce0.js"><link rel="prefetch" href="/assets/js/41.6cdce4cf.js"><link rel="prefetch" href="/assets/js/42.ab0bd0d5.js"><link rel="prefetch" href="/assets/js/43.66c8f8eb.js"><link rel="prefetch" href="/assets/js/44.ac02981e.js"><link rel="prefetch" href="/assets/js/45.479814b0.js"><link rel="prefetch" href="/assets/js/46.29956259.js"><link rel="prefetch" href="/assets/js/47.a89cf7d2.js"><link rel="prefetch" href="/assets/js/48.859e3502.js"><link rel="prefetch" href="/assets/js/49.d0fa0b25.js"><link rel="prefetch" href="/assets/js/5.206809f3.js"><link rel="prefetch" href="/assets/js/50.d051084c.js"><link rel="prefetch" href="/assets/js/51.fa831e6a.js"><link rel="prefetch" href="/assets/js/52.3ed98760.js"><link rel="prefetch" href="/assets/js/53.016b1c3c.js"><link rel="prefetch" href="/assets/js/54.c88e06c5.js"><link rel="prefetch" href="/assets/js/55.937bfe09.js"><link rel="prefetch" href="/assets/js/57.8bcda68a.js"><link rel="prefetch" href="/assets/js/58.286692ba.js"><link rel="prefetch" href="/assets/js/59.fbfe98aa.js"><link rel="prefetch" href="/assets/js/6.6f9d9bda.js"><link rel="prefetch" href="/assets/js/60.0975844e.js"><link rel="prefetch" href="/assets/js/61.0af6cf48.js"><link rel="prefetch" href="/assets/js/62.66c23699.js"><link rel="prefetch" href="/assets/js/63.7fda9b3f.js"><link rel="prefetch" href="/assets/js/7.6f64fba1.js"><link rel="prefetch" href="/assets/js/8.a163349f.js"><link rel="prefetch" href="/assets/js/9.9058d3cc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.87611319.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/header.jpg" alt="DonV" class="logo"> <span class="site-name can-hide">DonV</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/pages/js/nav.html" class="nav-link">
  JavaScript
</a></div><div class="nav-item"><a href="/pages/html/nav.html" class="nav-link">
  HTML
</a></div><div class="nav-item"><a href="/pages/css/nav.html" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/pages/other/nav.html" class="nav-link">
  其它
</a></div><div class="nav-item"><a href="/pages/app/nav.html" class="nav-link">
  应用
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于" class="dropdown-title"><span class="title">关于</span> <span class="arrow down"></span></button> <button type="button" aria-label="关于" class="mobile-dropdown-title"><span class="title">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/dongwei1125" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/dongwei1125" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/2621689331987783" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/Don_GW" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/~dongwei1125" target="_blank" rel="noopener noreferrer" class="nav-link external">
  NPM
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/pages/js/nav.html" class="nav-link">
  JavaScript
</a></div><div class="nav-item"><a href="/pages/html/nav.html" class="nav-link">
  HTML
</a></div><div class="nav-item"><a href="/pages/css/nav.html" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/pages/other/nav.html" class="nav-link">
  其它
</a></div><div class="nav-item"><a href="/pages/app/nav.html" class="nav-link">
  应用
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于" class="dropdown-title"><span class="title">关于</span> <span class="arrow down"></span></button> <button type="button" aria-label="关于" class="mobile-dropdown-title"><span class="title">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/dongwei1125" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/dongwei1125" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/2621689331987783" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/Don_GW" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.npmjs.com/~dongwei1125" target="_blank" rel="noopener noreferrer" class="nav-link external">
  NPM
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>比较全面的 Git 命令手册，几乎涵盖日常所有的使用场景（下）</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/other/git/lower.html#git-内部原理" class="sidebar-link">Git 内部原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/other/git/lower.html#git-对象" class="sidebar-link">Git 对象</a></li><li class="sidebar-sub-header"><a href="/pages/other/git/lower.html#git-引用" class="sidebar-link">Git 引用</a></li><li class="sidebar-sub-header"><a href="/pages/other/git/lower.html#包文件" class="sidebar-link">包文件</a></li><li class="sidebar-sub-header"><a href="/pages/other/git/lower.html#引用规格" class="sidebar-link">引用规格</a></li><li class="sidebar-sub-header"><a href="/pages/other/git/lower.html#恢复与移除" class="sidebar-link">恢复与移除</a></li></ul></li><li><a href="/pages/other/git/lower.html#gitk" class="sidebar-link">Gitk</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/other/git/lower.html#菜单栏" class="sidebar-link">菜单栏</a></li><li class="sidebar-sub-header"><a href="/pages/other/git/lower.html#提交历史" class="sidebar-link">提交历史</a></li><li class="sidebar-sub-header"><a href="/pages/other/git/lower.html#提交信息" class="sidebar-link">提交信息</a></li><li class="sidebar-sub-header"><a href="/pages/other/git/lower.html#版本树" class="sidebar-link">版本树</a></li></ul></li><li><a href="/pages/other/git/lower.html#git-gui" class="sidebar-link">Git Gui</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/other/git/lower.html#菜单栏-2" class="sidebar-link">菜单栏</a></li><li class="sidebar-sub-header"><a href="/pages/other/git/lower.html#差异对比" class="sidebar-link">差异对比</a></li><li class="sidebar-sub-header"><a href="/pages/other/git/lower.html#工作区变更" class="sidebar-link">工作区变更</a></li><li class="sidebar-sub-header"><a href="/pages/other/git/lower.html#暂存区" class="sidebar-link">暂存区</a></li><li class="sidebar-sub-header"><a href="/pages/other/git/lower.html#提交信息-3" class="sidebar-link">提交信息</a></li></ul></li><li><a href="/pages/other/git/lower.html#🎉-写在最后" class="sidebar-link">🎉 写在最后</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="比较全面的-git-命令手册-几乎涵盖日常所有的使用场景-下"><a href="#比较全面的-git-命令手册-几乎涵盖日常所有的使用场景-下" class="header-anchor">#</a> 比较全面的 Git 命令手册，几乎涵盖日常所有的使用场景（下）</h1> <p><img src="/other/git/banner.jpg" alt=""></p> <h2 id="git-内部原理"><a href="#git-内部原理" class="header-anchor">#</a> Git 内部原理</h2> <h3 id="git-对象"><a href="#git-对象" class="header-anchor">#</a> Git 对象</h3> <h4 id="blob-对象"><a href="#blob-对象" class="header-anchor">#</a> Blob 对象</h4> <p>  ;<code>Blob</code>对象即文件快照，<code>Git</code>暂存时会保存文件快照于目录<code>.git/objects</code>下。<code>git init</code>初始化的仓库下<code>.git/objects</code>默认创建空的<code>pack</code>和<code>info</code>子目录。<code>Git</code>的核心是一个简单的键值对数据库（<code>key-value data store</code>），可理解为文件目录和文件为键<code>key</code>，目录内文件内容为对应值<code>value</code>。</p> <p>  运行如下底层命令，向<code>Git</code>数据库插入内容。其中<code>echo 'content'</code>输出<code>content</code>文本，<code>|</code>为管道符，即前一命令的输出作为后一命令的输入。<code>-w</code>表示将内容写入数据库，<code>--stdin</code>表示从管道读取内容。如下命令可大致概括为<code>echo 'content'</code>输出<code>content</code>文本传入管道中，<code>git hash-object --stdin</code>从管道读取<code>content</code>文本，再指定<code>-w</code>选项将其写入<code>Git</code>数据库，即保存于<code>.git/objects</code>目录下。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>echo <span class="token string">'content'</span> <span class="token operator">|</span> git hash<span class="token operator">-</span>object <span class="token operator">-</span>w <span class="token operator">--</span>stdin
d95f3ad1<span class="token operator">...</span>
</code></pre></div><p>  ;<code>d95f3ad1...</code>即<code>blob</code>对象的<code>SHA-1</code>校验和，在目录<code>.git/objects</code>中体现为前两位用于命名子目录，余下的<code>38</code>位则用作文件名。如下<code>find</code>用来在指定目录下查找文件，<code>-type</code>表示指定文件类型，<code>f</code>表示文件类型为一般文件。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>find <span class="token punctuation">.</span>git<span class="token operator">/</span>objects <span class="token operator">-</span>type f
<span class="token punctuation">.</span>git<span class="token operator">/</span>objects<span class="token operator">/</span>d9<span class="token operator">/</span>5f3ad1<span class="token operator">...</span>
</code></pre></div><p>  ;<code>d95f3ad1...</code>也即键<code>key</code>，运行如下命令获取<code>Git</code>数据库中键对应的值。其中<code>-p</code>表示自动判断内容的类型并显示为格式友好的内容，也可指定<code>-t</code>选项查看对象类型。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git cat<span class="token operator">-</span>file <span class="token operator">-</span>p d95f3ad1
content
</code></pre></div><p>  可能<code>echo</code>方式写入内容到<code>Git</code>数据库稍显复杂，也可取文件内容写入数据库。如下将<code>readme.md</code>文件的内容写入数据库。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git hash<span class="token operator">-</span>object <span class="token operator">-</span>w readme<span class="token punctuation">.</span>md
</code></pre></div><h4 id="极简版本控制"><a href="#极简版本控制" class="header-anchor">#</a> 极简版本控制</h4> <p>  创建一个新文件并将其内容存入数据库。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>echo <span class="token string">'hello world'</span> <span class="token operator">&gt;</span> readme<span class="token punctuation">.</span>md
git hash<span class="token operator">-</span>object <span class="token operator">-</span>w readme<span class="token punctuation">.</span>md
3b18e512<span class="token operator">...</span>
</code></pre></div><p>  再次写入新内容并存入版本库。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>echo <span class="token string">'hi git'</span> <span class="token operator">&gt;</span> readme<span class="token punctuation">.</span>md
git hash<span class="token operator">-</span>object <span class="token operator">-</span>w readme<span class="token punctuation">.</span>md
<span class="token number">2984e649</span><span class="token operator">...</span>
</code></pre></div><p>  暂时查看数据库写入情况。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>find <span class="token punctuation">.</span>git<span class="token operator">/</span>objects <span class="token operator">-</span>type f
<span class="token punctuation">.</span>git<span class="token operator">/</span>objects<span class="token operator">/</span><span class="token number">29</span><span class="token operator">/</span><span class="token number">84e649</span><span class="token operator">...</span>
<span class="token punctuation">.</span>git<span class="token operator">/</span>objects<span class="token operator">/</span>3b<span class="token operator">/</span><span class="token number">18e512</span><span class="token operator">...</span>
</code></pre></div><p>  控制文件内容为第一个版本。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git cat<span class="token operator">-</span>file <span class="token operator">-</span>p 3b18e512 <span class="token operator">&gt;</span> readme<span class="token punctuation">.</span>md
cat readme<span class="token punctuation">.</span>md
hello world
</code></pre></div><p>  控制文件内容为第二个版本。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git cat<span class="token operator">-</span>file <span class="token operator">-</span>p <span class="token number">2984e649</span> <span class="token operator">&gt;</span> readme<span class="token punctuation">.</span>md
cat readme<span class="token punctuation">.</span>md
hi git
</code></pre></div><h4 id="tree-对象"><a href="#tree-对象" class="header-anchor">#</a> Tree 对象</h4> <p>  上述数据库中仅保存了文件内容，文件名尚未保存，而且记住每一个版本所对应的<code>SHA-1</code>校验和也不现实。<code>Tree</code>对象即树对象，则能很好解决此问题，一个树对象包含一条或者多条树对象记录，每条记录有一个指向数据对象（<code>blob</code>对象）或子树对象的<code>SHA-1</code>指针，以及相应的模式、类型、文件名或目录名。</p> <p>  某个树对象内容可能如下。其中<code>master^{tree}</code>表示<code>master</code>分支最新的提交所指向的树对象，<code>readme.md</code>和<code>file.txt</code>都是数据对象，<code>dist</code>为子树对象。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git cat<span class="token operator">-</span>file <span class="token operator">-</span>p master<span class="token operator">^</span><span class="token punctuation">{</span>tree<span class="token punctuation">}</span>
<span class="token number">100644</span> blob a906cb12<span class="token operator">...</span>      readme<span class="token punctuation">.</span>md
<span class="token number">100644</span> blob 8f941322<span class="token operator">...</span>      file<span class="token punctuation">.</span>txt
<span class="token number">040000</span> tree 99f1a699<span class="token operator">...</span>      dist
</code></pre></div><p>  查看子树对象。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git cat<span class="token operator">-</span>file <span class="token operator">-</span>p 99f1a699
<span class="token number">100644</span> blob 47c63436<span class="token operator">...</span>      index<span class="token punctuation">.</span>html
</code></pre></div><p>  内部数据存储大致如下。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>       readme<span class="token punctuation">.</span>md <span class="token operator">--</span><span class="token operator">&gt;</span> blob
     <span class="token operator">/</span>
tree —— file<span class="token punctuation">.</span>txt <span class="token operator">--</span><span class="token operator">&gt;</span> blob
     \
       dist <span class="token operator">--</span><span class="token operator">&gt;</span> tree —— index<span class="token punctuation">.</span>html <span class="token operator">--</span><span class="token operator">&gt;</span> blob
</code></pre></div><p>  ;<code>Git</code>是根据暂存区的状态来创建对应的树对象，因此需要将一些修改或文件加入暂存区。运行如下命令将修改暂存，若文件名不在暂存区中需指定<code>--add</code>选项，<code>--cacheinfo</code>表示将指定的信息加入暂存区，包括文件模式、<code>SHA-1</code>校验和与文件名，并且<code>SHA-1</code>校验和需指定完整值。如下命令可大致概括为暂存数据对象<code>3b18e512...</code>对应的修改，同时文件模式为<code>100644</code>，文件名为<code>readme.md</code>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git update<span class="token operator">-</span>index <span class="token operator">--</span>add <span class="token operator">--</span>cacheinfo <span class="token number">100644</span> \
3b18e512<span class="token operator">...</span> readme<span class="token punctuation">.</span>md
</code></pre></div><p>  查看暂存区详细状态。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git ls<span class="token operator">-</span>files <span class="token operator">-</span>s
<span class="token number">100644</span> 3b18e512<span class="token operator">...</span> <span class="token number">0</span>       readme<span class="token punctuation">.</span>md
</code></pre></div><p>  运行如下命令，将暂存区内容写入一个树对象。其中<code>7394b8cc...</code>为树对象<code>SHA-1</code>校验和。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git write<span class="token operator">-</span>tree
7394b8cc<span class="token operator">...</span>
</code></pre></div><p>  查看树对象内容和数据库写入情况</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git cat<span class="token operator">-</span>file <span class="token operator">-</span>p 7394b8cc
<span class="token number">100644</span> blob 3b18e512<span class="token operator">...</span>    readme<span class="token punctuation">.</span>md
find <span class="token punctuation">.</span>git<span class="token operator">/</span>objects <span class="token operator">-</span>type f
<span class="token punctuation">.</span>git<span class="token operator">/</span>objects<span class="token operator">/</span><span class="token number">73</span><span class="token operator">/</span>94b8cc<span class="token operator">...</span>
</code></pre></div><h4 id="子树对象"><a href="#子树对象" class="header-anchor">#</a> 子树对象</h4> <p>  如上已经创建一个树对象，接下来再创建一个新树对象。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git update<span class="token operator">-</span>index <span class="token operator">--</span>add <span class="token operator">--</span>cacheinfo <span class="token number">100644</span> \
<span class="token number">2984e649</span><span class="token operator">...</span> readme<span class="token punctuation">.</span>md
</code></pre></div><p>  也可暂存新文件，<code>Git</code>会根据新文件内容创建数据对象并写入数据库，再将数据对象<code>SHA-1</code>校验和、文件模式和文件名加入到暂存区。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>echo <span class="token string">'file'</span> <span class="token operator">&gt;</span> file<span class="token punctuation">.</span>txt
git update<span class="token operator">-</span>index <span class="token operator">--</span>add file<span class="token punctuation">.</span>txt
</code></pre></div><p>  暂存区现在包括<code>readme.md</code>新版本和一个新文件<code>file.txt</code>，将暂存区内容再次写入一个新树对象。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git write<span class="token operator">-</span>tree
e331c9c2<span class="token operator">...</span>
</code></pre></div><p>  查看暂存区域。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git ls<span class="token operator">-</span>files <span class="token operator">-</span>s
<span class="token number">100644</span> f73f3093<span class="token operator">...</span> <span class="token number">0</span>       file<span class="token punctuation">.</span>txt
<span class="token number">100644</span> <span class="token number">2984e649</span><span class="token operator">...</span> <span class="token number">0</span>       readme<span class="token punctuation">.</span>md
</code></pre></div><p>  现在数据库存在两个树对象<code>7394b8cc...</code>和<code>e331c9c2...</code>，运行如下命令将第一个树对象加入到暂存区域。其中<code>--prefix</code>表示将一个已有的树对象作为子树加入暂存区，<code>dist</code>为子目录名。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git read<span class="token operator">-</span>tree <span class="token operator">--</span>prefix<span class="token operator">=</span>dist 7394b8cc
</code></pre></div><p>  再次写入一个新树对象。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git write<span class="token operator">-</span>tree
ccf028c6<span class="token operator">...</span>
</code></pre></div><p>  查看新树对象。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git cat<span class="token operator">-</span>file <span class="token operator">-</span>p ccf028c6
<span class="token number">040000</span> tree 7394b8cc<span class="token operator">...</span>    dist
<span class="token number">100644</span> blob f73f3093<span class="token operator">...</span>    file<span class="token punctuation">.</span>txt
<span class="token number">100644</span> blob <span class="token number">2984e649</span><span class="token operator">...</span>    readme<span class="token punctuation">.</span>md
</code></pre></div><h4 id="提交对象"><a href="#提交对象" class="header-anchor">#</a> 提交对象</h4> <p>  现在已有三个树对象<code>7394b8cc...</code>、<code>e331c9c2...</code>和<code>ccf028c6...</code>，分别跟踪了不同文件快照。若想重用这些快照，需要记住如上三个<code>SHA-1</code>校验和。同时也不知道是谁保存了这些快照、在什么时刻保存的，以及为什么保存这些快照，以上则引出了提交对象。</p> <p>  运行如下命令创建一个提交对象。其中<code>'A'</code>即为提交信息，<code>7394b8cc</code>为创建后的提交对象指向的树对象。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>echo <span class="token string">'A'</span> <span class="token operator">|</span> git commit<span class="token operator">-</span>tree 7394b8cc
f0dcf2c3<span class="token operator">...</span>
</code></pre></div><p>  查看提交对象<code>f0dcf2c3</code>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git cat<span class="token operator">-</span>file <span class="token operator">-</span>p f0dcf2c3
tree 7394b8cc<span class="token operator">...</span>
author <span class="token operator">...</span>
committer <span class="token operator">...</span>

<span class="token constant">A</span>
</code></pre></div><p>  根据另外两个树对象创建提交对象，其中<code>e331c9c2</code>表示树对象校验和，<code>-p</code>表示指定父提交对象，<code>f0dcf2c3</code>为父提交对象校验和。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>echo <span class="token string">'B'</span> <span class="token operator">|</span> git commit<span class="token operator">-</span>tree e331c9c2 <span class="token operator">-</span>p f0dcf2c3
5d3d89ce<span class="token operator">...</span>
echo <span class="token string">'C'</span> <span class="token operator">|</span> git commit<span class="token operator">-</span>tree ccf028c6 <span class="token operator">-</span>p 5d3d89ce
b41c0107<span class="token operator">...</span>
</code></pre></div><p>  查看提交对象<code>5d3d89ce</code>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git cat<span class="token operator">-</span>file <span class="token operator">-</span>p 5d3d89ce
tree e331c9c2<span class="token operator">...</span>
parent f0dcf2c3<span class="token operator">...</span>
author <span class="token operator">...</span>
committer <span class="token operator">...</span>

<span class="token constant">B</span>
</code></pre></div><p>  此时<code>Git</code>内部关系大致如下，但是暂时还不能<code>git log</code>查看提交历史，因为还不存在分支。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>                                   readme<span class="token punctuation">.</span><span class="token function">md</span> <span class="token punctuation">(</span><span class="token number">2984e649</span><span class="token punctuation">)</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token function">blob</span> <span class="token punctuation">(</span>hi git<span class="token punctuation">)</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">|</span>
                                 <span class="token operator">/</span>                                                                            <span class="token operator">|</span>
<span class="token constant">C</span> <span class="token punctuation">(</span>b41c0107<span class="token punctuation">)</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token function">tree</span> <span class="token punctuation">(</span>ccf028c6<span class="token punctuation">)</span> —— dist <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token function">tree</span> <span class="token punctuation">(</span>7394b8cc<span class="token punctuation">)</span> —— readme<span class="token punctuation">.</span><span class="token function">md</span> <span class="token punctuation">(</span>3b18e512<span class="token punctuation">)</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token function">blob</span> <span class="token punctuation">(</span>hello world<span class="token punctuation">)</span> <span class="token operator">--</span><span class="token operator">|</span><span class="token operator">--</span><span class="token operator">|</span>
<span class="token operator">|</span>                                \                                                                            <span class="token operator">|</span>  <span class="token operator">|</span>
<span class="token operator">|</span>                                  file<span class="token punctuation">.</span><span class="token function">txt</span> <span class="token punctuation">(</span>f73f3093<span class="token punctuation">)</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token function">blob</span> <span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>
<span class="token operator">|</span>                                                                                                          <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>
<span class="token constant">B</span> <span class="token punctuation">(</span>5d3d89ce<span class="token punctuation">)</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token function">tree</span> <span class="token punctuation">(</span>e331c9c2<span class="token punctuation">)</span> —— readme<span class="token punctuation">.</span><span class="token function">md</span> <span class="token punctuation">(</span><span class="token number">2984e649</span><span class="token punctuation">)</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token function">blob</span> <span class="token punctuation">(</span>hi git<span class="token punctuation">)</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">|</span><span class="token operator">--</span><span class="token operator">|</span>  <span class="token operator">|</span>
<span class="token operator">|</span>                                \                                                                         <span class="token operator">|</span>     <span class="token operator">|</span>
<span class="token operator">|</span>                                  file<span class="token punctuation">.</span><span class="token function">txt</span> <span class="token punctuation">(</span>f73f3093<span class="token punctuation">)</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token function">blob</span> <span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">|</span>     <span class="token operator">|</span>
<span class="token operator">|</span>                                                                                                                <span class="token operator">|</span>
<span class="token constant">A</span> <span class="token punctuation">(</span>f0dcf2c3<span class="token punctuation">)</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token function">tree</span> <span class="token punctuation">(</span>7394b8cc<span class="token punctuation">)</span> —— readme<span class="token punctuation">.</span><span class="token function">md</span> <span class="token punctuation">(</span>3b18e512<span class="token punctuation">)</span> <span class="token operator">--</span><span class="token operator">&gt;</span> <span class="token function">blob</span> <span class="token punctuation">(</span>hello world<span class="token punctuation">)</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">|</span>
</code></pre></div><h4 id="对象存储"><a href="#对象存储" class="header-anchor">#</a> 对象存储</h4> <p>  ;<code>Git</code>数据对象存储步骤大致如下。其实所有的<code>Git</code>对象均以此方式存储，区别仅在于类型标识，另两种对象类型的头部信息以字符串<code>commit</code>或<code>tree</code>开头，而不是<code>blob</code>。虽然数据对象的内容可以是任何东西，但提交对象和树对象的内容却有各自固定的格式。</p> <ul><li>读取文件内容，以对象类型<code>blob</code>作为开头来构造一个头部信息，拼接头部信息和文件原始内容，记为<code>content</code></li> <li>计算<code>content</code>的<code>SHA-1</code>校验和，得到长度为<code>40</code>个十六进制字符的哈希值</li> <li>取哈希值前两位作为文件目录，剩余<code>38</code>为作为文件名</li> <li>对<code>content</code>执行<code>lib</code>压缩，获得新的二进制内容，存入文件中</li></ul> <h3 id="git-引用"><a href="#git-引用" class="header-anchor">#</a> Git 引用</h3> <p>  上述提交历史可运行<code>git log b41c0107</code>查看，其中<code>b41c0107</code>为提交记录<code>C</code>的部分校验和。但是查看提交历史仍然需记住某次记录的部分校验和，倘若用某个文件保存校验和，同时起一个简单的名字，问题将会得到很好解决，而这种文件就被称为引用。引用文件均保存在<code>.git/refs</code>目录下。</p> <h4 id="分支引用"><a href="#分支引用" class="header-anchor">#</a> 分支引用</h4> <p>  若要创建一个分支引用，仅在<code>.git/refs/heads</code>目录下新增分支名，且内容为某次提交的校验和即可。<code>Git</code>提供了更加安全的命令<code>update-ref</code>，如下表示将部分校验和<code>b41c0107</code>对应的完整校验和写入<code>.git/refs/heads</code>目录下的<code>master</code>文件。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git update<span class="token operator">-</span>ref refs<span class="token operator">/</span>heads<span class="token operator">/</span>master b41c0107
</code></pre></div><p>  如下查看<code>master</code>分支文件的内容。同时也印证了分支是指向提交对象的可变指针。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>cat <span class="token punctuation">.</span>git<span class="token operator">/</span>refs<span class="token operator">/</span>heads<span class="token operator">/</span>master
b41c0107<span class="token operator">...</span>
</code></pre></div><h4 id="head-引用"><a href="#head-引用" class="header-anchor">#</a> HEAD 引用</h4> <p>  ;<code>HEAD</code>是一个符号引用，指向当前所在分支，或者说是一个指向其他引用的分支。</p> <p>  运行<code>git branch dev</code>即创建一个<code>dev</code>分支，但是查看<code>dev</code>引用文件的内容，会有完整的校验和，此校验和即是通过<code>HEAD</code>来获取的。</p> <p>  创建<code>dev</code>分支时<code>Git</code>首先会找到<code>HEAD</code>指向的分支，再获取此分支保存的完整校验和，将此校验和写入<code>.git/refs/heads</code>目录下<code>dev</code>文件中。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git branch dev
cat <span class="token punctuation">.</span>git<span class="token operator">/</span>refs<span class="token operator">/</span>heads<span class="token operator">/</span>dev
b41c0107<span class="token operator">...</span>
</code></pre></div><p>  查看<code>HEAD</code>内容。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>cat <span class="token punctuation">.</span>git<span class="token operator">/</span><span class="token constant">HEAD</span>
<span class="token literal-property property">ref</span><span class="token operator">:</span> refs<span class="token operator">/</span>heads<span class="token operator">/</span>master
</code></pre></div><p>  如下表示将当前<code>HEAD</code>指向<code>dev</code>分支。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git symbolic<span class="token operator">-</span>ref <span class="token constant">HEAD</span> refs<span class="token operator">/</span>heads<span class="token operator">/</span>dev
</code></pre></div><h4 id="标签引用"><a href="#标签引用" class="header-anchor">#</a> 标签引用</h4> <p>  标签包括轻量标签和附注标签。</p> <p>  轻量标签是一个固定的引用，指向某个提交对象。</p> <p>  附注标签会指向一个标签对象，标签对象保存一个引用来指向某个提交对象。</p> <p>  运行如下底层命令，创建一个轻量标签<code>v1.8.5</code>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git update<span class="token operator">-</span>ref refs<span class="token operator">/</span>tags<span class="token operator">/</span>v1<span class="token punctuation">.</span><span class="token number">8.5</span> <span class="token constant">HEAD</span>
</code></pre></div><p>  查看轻量标签<code>v1.8.5</code>，如下轻量标签<code>v1.8.5</code>指向提交<code>b41c0107</code>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>cat <span class="token punctuation">.</span>git<span class="token operator">/</span>refs<span class="token operator">/</span>tags<span class="token operator">/</span>v1<span class="token punctuation">.</span><span class="token number">8.5</span>
b41c0107<span class="token operator">...</span>
</code></pre></div><p>  创建附注标签<code>v1.8.6</code>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git tag <span class="token operator">-</span>a v1<span class="token punctuation">.</span><span class="token number">8.6</span> <span class="token constant">HEAD</span> <span class="token operator">-</span>m <span class="token string">'message'</span>
</code></pre></div><p>  查看附注标签指向的标签对象的完整校验和，如下附注标签指向标签对象<code>4740ea0b</code>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>cat <span class="token punctuation">.</span>git<span class="token operator">/</span>refs<span class="token operator">/</span>tags<span class="token operator">/</span>v1<span class="token punctuation">.</span><span class="token number">8.6</span>
4740ea0b<span class="token operator">...</span>
</code></pre></div><p>  查看标签对象<code>4740ea0b</code>内容，其中<code>object</code>表示指向的提交记录。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git cat<span class="token operator">-</span>file <span class="token operator">-</span>p 4740ea0b
object b41c0107<span class="token operator">...</span>
type commit
tag v1<span class="token punctuation">.</span><span class="token number">8.6</span>
tagger <span class="token operator">...</span>

message
</code></pre></div><h4 id="远程引用"><a href="#远程引用" class="header-anchor">#</a> 远程引用</h4> <p>  远程引用即本地仓库中保存远程仓库中各分支的指向信息。</p> <p>  远程引用是只读的，可以<code>git checkout</code>到某个远程引用，但是<code>Git</code>并不会将<code>HEAD</code>引用指向此远程引用。</p> <p>  远程引用一般保存在<code>refs/remotes</code>目录下，当与远程仓库交互时，远程引用会被更新。</p> <p>  若远程仓库<code>repo</code>含分支<code>dev</code>、<code>master</code>，添加远程仓库<code>origin</code>并拉取。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git remote add origin https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>username<span class="token operator">/</span>repo<span class="token punctuation">.</span>git
git fetch origin
<span class="token operator">...</span>
From https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>username<span class="token operator">/</span>repo
 <span class="token operator">*</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">branch</span><span class="token punctuation">]</span>      dev       <span class="token operator">-</span><span class="token operator">&gt;</span> origin<span class="token operator">/</span>dev
 <span class="token operator">*</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">branch</span><span class="token punctuation">]</span>      master     <span class="token operator">-</span><span class="token operator">&gt;</span> origin<span class="token operator">/</span>master
</code></pre></div><p>  查看目录<code>.git/refs/remotes/origin</code>下文件。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>find <span class="token punctuation">.</span>git<span class="token operator">/</span>refs<span class="token operator">/</span>remotes<span class="token operator">/</span>origin <span class="token operator">-</span>type f
<span class="token punctuation">.</span>git<span class="token operator">/</span>refs<span class="token operator">/</span>remotes<span class="token operator">/</span>origin<span class="token operator">/</span>dev
<span class="token punctuation">.</span>git<span class="token operator">/</span>refs<span class="token operator">/</span>remotes<span class="token operator">/</span>origin<span class="token operator">/</span>master
</code></pre></div><p>  查看远程仓库<code>master</code>分支，其中<code>90edc78e</code>为<code>master</code>分支指向的最新提交的校验和。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>cat <span class="token punctuation">.</span>git<span class="token operator">/</span>refs<span class="token operator">/</span>remotes<span class="token operator">/</span>origin<span class="token operator">/</span>master
90edc78e<span class="token operator">...</span>
</code></pre></div><h3 id="包文件"><a href="#包文件" class="header-anchor">#</a> 包文件</h3> <p>  ;<code>Git</code>跟踪了某个数千行代码的文件，若改动了此文件的某一行代码，<code>Git</code>会将整个文件保存为数据对象（<code>blob</code>）。此文件原始对象和改动后的对象被称为松散（<code>loose</code>）对象。</p> <p>  ;<code>Git</code>向磁盘中存储对象时所使用的格式为松散对象格式，并时不时地将多个对象打包成一个的包文件（二进制文件），以此来节省空间和提高效率。 版本库中有太多的松散对象或者执行<code>git gc</code>，或者向远程服务器推送时，<code>Git</code>都会打包。</p> <p>  ;<code>git gc</code>会将一个文件的完整内容保存为数据对象，再将与完整内容之间的差异保存为另一个数据对象。</p> <h4 id="打包"><a href="#打包" class="header-anchor">#</a> 打包</h4> <p>  初始化一个空仓库<code>repo</code>，新增一个<code>10kb</code>左右的<code>readme.md</code>文件，暂存后查看暂存区<code>readme.me</code>文件大小（<code>10311</code>字节），提交此次修改。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git add readme<span class="token punctuation">.</span>md
git ls<span class="token operator">-</span>files <span class="token operator">-</span>s
<span class="token number">100644</span> 767466fd<span class="token operator">...</span> <span class="token number">0</span>       readme<span class="token punctuation">.</span>md
git cat<span class="token operator">-</span>file <span class="token operator">-</span>s 767466fd
<span class="token number">10311</span>
git commit <span class="token operator">-</span>m <span class="token string">'A'</span>
</code></pre></div><p>  ;<code>readme.md</code>文件尾部追加部分内容后也暂存并查看文件大小（<code>10319</code>字节）。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>echo <span class="token string">'message'</span> <span class="token operator">&gt;&gt;</span> readme<span class="token punctuation">.</span>md
git add readme<span class="token punctuation">.</span>md
git ls<span class="token operator">-</span>files <span class="token operator">-</span>s
<span class="token number">100644</span> f08cfd3e<span class="token operator">...</span> <span class="token number">0</span>       readme<span class="token punctuation">.</span>md
git cat<span class="token operator">-</span>file <span class="token operator">-</span>s f08cfd3e
<span class="token number">10319</span>
git commit <span class="token operator">-</span>m <span class="token string">'B'</span>
</code></pre></div><p>  查看<code>.git/objects</code>下新增的对象，其中包括<code>6</code>个对象，两个树对象、两个提交对象、两个数据对象。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>find <span class="token punctuation">.</span>git<span class="token operator">/</span>objects <span class="token operator">-</span>type f
<span class="token punctuation">.</span>git<span class="token operator">/</span>objects<span class="token operator">/</span><span class="token number">76</span><span class="token operator">/</span>7466fd<span class="token operator">...</span>
<span class="token punctuation">.</span>git<span class="token operator">/</span>objects<span class="token operator">/</span>f0<span class="token operator">/</span>8cfd3e<span class="token operator">...</span>
<span class="token operator">...</span>
</code></pre></div><p>  运行<code>git gc</code>打包松散对象，查看<code>.git/objects</code>下对象。其中包括一个<code>.idx</code>索引文件和一个<code>.pack</code>包文件，包文件包含了从<code>Git</code>数据库中移除的所有对象的内容，索引文件包含了包文件的偏移信息，通过索引文件可以快速定位任意一个指定对象。</p> <p>  注意大部分对象都会被打包到包文件中，但是<code>Git</code>会保留悬空的数据对象，即未被任何提交记录引用的数据对象。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git gc
<span class="token punctuation">.</span>git<span class="token operator">/</span>objects<span class="token operator">/</span>info<span class="token operator">/</span>packs
<span class="token punctuation">.</span>git<span class="token operator">/</span>objects<span class="token operator">/</span>pack<span class="token operator">/</span>pack<span class="token operator">-</span><span class="token number">3575.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>a060<span class="token punctuation">.</span>idx
<span class="token punctuation">.</span>git<span class="token operator">/</span>objects<span class="token operator">/</span>pack<span class="token operator">/</span>pack<span class="token operator">-</span><span class="token number">3575.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>a060<span class="token punctuation">.</span>pack
</code></pre></div><p>  运行如下底层命令查看索引文件内容。其中包括<code>6</code>个对象，每一行含对象的<code>SHA-1</code>校验和、类型、文件大小、打包文件大小、打包文件偏移，可能再包含深度、基础<code>SHA-1</code>校验和。</p> <p>  注意<code>readme.md</code>第二个版本<code>f08cfd3e</code>保存了完整内容，反而第一个版本<code>767466fd</code>保存了差异内容，因为大多数情况下<code>Git</code>需要快速访问最新版本。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git verify<span class="token operator">-</span>pack <span class="token operator">-</span>v <span class="token punctuation">.</span>git<span class="token operator">/</span>objects<span class="token operator">/</span>pack<span class="token operator">/</span>pack<span class="token operator">-</span><span class="token number">3575.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>a060<span class="token punctuation">.</span>ind
f08cfd3e<span class="token operator">...</span> blob   <span class="token number">10319</span> <span class="token number">2561</span> <span class="token number">265</span>
767466fd<span class="token operator">...</span> blob   <span class="token number">7</span> <span class="token number">18</span> <span class="token number">2921</span> <span class="token number">1</span> f08cfd3e<span class="token operator">...</span>
<span class="token operator">...</span>
</code></pre></div><h4 id="引用"><a href="#引用" class="header-anchor">#</a> 引用</h4> <p>  ;<code>git gc</code>会做的另一件事是打包<code>.git/refs</code>目录下的引用到文件<code>.git/packed-refs</code>中。若当前版本库中包含如下分支和标签。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>find <span class="token punctuation">.</span>git<span class="token operator">/</span>refs <span class="token operator">-</span>type f
<span class="token punctuation">.</span>git<span class="token operator">/</span>refs<span class="token operator">/</span>heads<span class="token operator">/</span>master
<span class="token punctuation">.</span>git<span class="token operator">/</span>refs<span class="token operator">/</span>remotes<span class="token operator">/</span>origin<span class="token operator">/</span>master
<span class="token punctuation">.</span>git<span class="token operator">/</span>refs<span class="token operator">/</span>tags<span class="token operator">/</span>v1<span class="token punctuation">.</span><span class="token number">8.5</span>
<span class="token punctuation">.</span>git<span class="token operator">/</span>refs<span class="token operator">/</span>tags<span class="token operator">/</span>v1<span class="token punctuation">.</span><span class="token number">8.6</span>
</code></pre></div><p>  打包后上述引用不会再出现在<code>.git/refs</code>目录下，均会被移动到<code>.git/packed-refs</code>文件中。其中<code>^</code>表示它上一行的标签是附注标签，<code>^</code>所在行是那个附注标签指向的提交记录的校验和。</p> <p>  打包后更新了引用，<code>Git</code>并不会修改<code>packed-refs</code>文件，而是在<code>.git/refs</code>目录下创建新的引用文件。若<code>Git</code>要获取引用文件的最新<code>SHA-1</code>校验和，首先会在<code>.git/refs</code>目录下查找指定的引用文件，然后再到<code>packed-refs</code>文件中查找。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>cat <span class="token punctuation">.</span>git<span class="token operator">/</span>packed<span class="token operator">-</span>refs
ceb21368<span class="token operator">...</span> refs<span class="token operator">/</span>heads<span class="token operator">/</span>master
040db796<span class="token operator">...</span> refs<span class="token operator">/</span>remotes<span class="token operator">/</span>origin<span class="token operator">/</span>master
ceb21368<span class="token operator">...</span> refs<span class="token operator">/</span>tags<span class="token operator">/</span>v1<span class="token punctuation">.</span><span class="token number">8.5</span>
9dcb07d9<span class="token operator">...</span> refs<span class="token operator">/</span>tags<span class="token operator">/</span>v1<span class="token punctuation">.</span><span class="token number">8.6</span>
<span class="token operator">^</span>ceb2136<span class="token operator">...</span>
</code></pre></div><h3 id="引用规格"><a href="#引用规格" class="header-anchor">#</a> 引用规格</h3> <p>  本地仓库关联远程仓库后，查看<code>.git/config</code>文件。其中指定了远程版本库的名称、<code>url</code>和用于获取的引用规格。诸如<code>&lt;src&gt;:&lt;dst&gt;</code>的格式称为引用规格，<code>&lt;src&gt;</code>表示远程版本库中的引用，<code>&lt;dst&gt;</code>表示远程引用在本地所对应的位置，<code>+</code>表示不能快进情况下强制更新引用。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git remote add origin https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>username<span class="token operator">/</span>repo<span class="token punctuation">.</span>git
cat <span class="token punctuation">.</span>git<span class="token operator">/</span>config
<span class="token operator">...</span>
<span class="token punctuation">[</span>remote <span class="token string">&quot;origin&quot;</span><span class="token punctuation">]</span>
        url <span class="token operator">=</span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>username<span class="token operator">/</span>repo<span class="token punctuation">.</span>git
        fetch <span class="token operator">=</span> <span class="token operator">+</span>refs<span class="token operator">/</span>heads<span class="token comment">/*:refs/remotes/origin/*
</span></code></pre></div><p>  默认情况下，运行<code>git fetch</code>将获取远程仓库<code>refs/heads</code>目录下所有引用，同时写入本地<code>refs/remotes/origin</code>目录下。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git fetch origin
<span class="token operator">...</span>
From https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>username<span class="token operator">/</span>repo
 <span class="token operator">*</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">branch</span><span class="token punctuation">]</span>      dev         <span class="token operator">-</span><span class="token operator">&gt;</span> origin<span class="token operator">/</span>dev
 <span class="token operator">*</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">branch</span><span class="token punctuation">]</span>      master      <span class="token operator">-</span><span class="token operator">&gt;</span> origin<span class="token operator">/</span>master
find <span class="token punctuation">.</span>git<span class="token operator">/</span>refs<span class="token operator">/</span>remotes<span class="token operator">/</span>origin <span class="token operator">-</span>type f
<span class="token punctuation">.</span>git<span class="token operator">/</span>refs<span class="token operator">/</span>remotes<span class="token operator">/</span>origin<span class="token operator">/</span>dev
<span class="token punctuation">.</span>git<span class="token operator">/</span>refs<span class="token operator">/</span>remotes<span class="token operator">/</span>origin<span class="token operator">/</span>master
</code></pre></div><h4 id="拓展"><a href="#拓展" class="header-anchor">#</a> 拓展</h4> <p>  本地仓库获取<code>fetch</code>远程仓库<code>master</code>分支后，查看此分支提交历史。如下三个命令等价，并最终都会被拓展为<code>refs/remotes/origin/master</code>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git log origin<span class="token operator">/</span>master
git log remotes<span class="token operator">/</span>origin<span class="token operator">/</span>master
git log refs<span class="token operator">/</span>remotes<span class="token operator">/</span>origin<span class="token operator">/</span>master
</code></pre></div><h4 id="获取"><a href="#获取" class="header-anchor">#</a> 获取</h4> <p>  只获取远程仓库<code>repo</code>的<code>master</code>分支，而不是所有分支，修改为如下引用规格。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>fetch <span class="token operator">=</span> <span class="token operator">+</span>refs<span class="token operator">/</span>heads<span class="token operator">/</span>master<span class="token operator">:</span>refs<span class="token operator">/</span>remotes<span class="token operator">/</span>origin<span class="token operator">/</span>master
</code></pre></div><p>  获取多个远程分支。如下表示仅获取远程<code>master</code>和<code>dev</code>分支。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>fetch <span class="token operator">=</span> <span class="token operator">+</span>refs<span class="token operator">/</span>heads<span class="token operator">/</span>master<span class="token operator">:</span>refs<span class="token operator">/</span>remotes<span class="token operator">/</span>origin<span class="token operator">/</span>master
fetch <span class="token operator">=</span> <span class="token operator">+</span>refs<span class="token operator">/</span>heads<span class="token operator">/</span>dev<span class="token operator">:</span>refs<span class="token operator">/</span>remotes<span class="token operator">/</span>origin<span class="token operator">/</span>dev
</code></pre></div><h4 id="命名空间"><a href="#命名空间" class="header-anchor">#</a> 命名空间</h4> <p>  推送本地<code>master</code>分支到远程仓库<code>feat/master</code>分支。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git push origin master<span class="token operator">:</span>feat<span class="token operator">/</span>master
</code></pre></div><p>  仅获取远程仓库<code>dev</code>分支和命名空间<code>feat</code>下的分支，修改为如下引用规格。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>fetch <span class="token operator">=</span> <span class="token operator">+</span>refs<span class="token operator">/</span>heads<span class="token operator">/</span>master<span class="token operator">:</span>refs<span class="token operator">/</span>remotes<span class="token operator">/</span>origin<span class="token operator">/</span>master
fetch <span class="token operator">=</span> <span class="token operator">+</span>refs<span class="token operator">/</span>heads<span class="token operator">/</span>feat<span class="token comment">/*:refs/remotes/origin/feat/*
</span></code></pre></div><h4 id="强制更新"><a href="#强制更新" class="header-anchor">#</a> 强制更新</h4> <p>  若远程仓库<code>repo</code>存在<code>master</code>分支，用户<code>A</code>、<code>B</code>和<code>C</code>均关联并获取<code>fetch</code>了最新的修改。</p> <p>  用户<code>A</code>将与原历史无关的提交历史强制推送到了<code>master</code>。</p> <p>  用户<code>B</code>仓库<code>.git/config</code>配置如下。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>fetch <span class="token operator">=</span> <span class="token operator">+</span>refs<span class="token operator">/</span>heads<span class="token comment">/*:refs/remotes/origin/*
</span></code></pre></div><p>  用户<code>C</code>仓库<code>.git/config</code>配置如下，即删除<code>+</code>不开启强制更新。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>fetch <span class="token operator">=</span> refs<span class="token operator">/</span>heads<span class="token comment">/*:refs/remotes/origin/*
</span></code></pre></div><p>  用户<code>B</code>获取<code>fetch</code>远程仓库中的修改，其中<code>forced update</code>即表示强制更新了<code>master</code>提交历史。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git fetch origin
<span class="token operator">...</span>
 <span class="token operator">+</span> <span class="token operator">...</span> master     <span class="token operator">-</span><span class="token operator">&gt;</span> origin<span class="token operator">/</span><span class="token function">master</span>  <span class="token punctuation">(</span>forced update<span class="token punctuation">)</span>
</code></pre></div><p>  用户<code>C</code>获取远程仓库修改，其中<code>master</code>分支的拉取被拒绝，因为其提交历史不能快进。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git fetch origin
<span class="token operator">...</span>
 <span class="token operator">!</span> <span class="token punctuation">[</span>rejected<span class="token punctuation">]</span>        master     <span class="token operator">-</span><span class="token operator">&gt;</span> origin<span class="token operator">/</span><span class="token function">master</span>  <span class="token punctuation">(</span>non<span class="token operator">-</span>fast<span class="token operator">-</span>forward<span class="token punctuation">)</span>
</code></pre></div><h3 id="恢复与移除"><a href="#恢复与移除" class="header-anchor">#</a> 恢复与移除</h3> <h4 id="数据恢复"><a href="#数据恢复" class="header-anchor">#</a> 数据恢复</h4> <p>  若某版本库提交历史如下，当前<code>HEAD</code>指向<code>master</code>分支。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token constant">A</span> —— <span class="token constant">B</span> —— <span class="token constant">C</span> —— <span class="token constant">D</span> —— <span class="token constant">E</span> <span class="token operator">&lt;</span><span class="token operator">--</span> master <span class="token operator">&lt;</span><span class="token operator">--</span> <span class="token constant">HEAD</span>
</code></pre></div><p>  回退<code>master</code>分支到提交记录<code>C</code>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git reset <span class="token operator">--</span>hard <span class="token constant">HEAD</span><span class="token operator">^</span><span class="token operator">^</span>
</code></pre></div><p>  此时若再将<code>master</code>分支提交记录切换到<code>E</code>，可运行<code>git reflog</code>查看引用日志中的提交<code>E</code>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git reflog
<span class="token operator">...</span>
329e7f4 <span class="token constant">HEAD</span>@<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token operator">:</span> commit<span class="token operator">:</span> <span class="token constant">E</span>
</code></pre></div><p>  运行<code>git reset --hard HEAD@{1}</code>可将<code>master</code>切换到提交<code>E</code>。</p> <p>  可能因为某些原因提交<code>E</code>不在引用日志<code>reflog</code>中，同时也没有任何引用指向提交<code>E</code>。</p> <p>  要模拟此场景首先还是将<code>master</code>指向提交<code>C</code>，然后删除<code>.git/logs</code>目录中的引用日志，此时再运行<code>git reflog</code>将没有任何输出。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>rm <span class="token operator">-</span>r <span class="token punctuation">.</span>git<span class="token operator">/</span>logs
</code></pre></div><p>  运行如下命令，<code>Git</code>会检查数据库完整性，其中<code>--full</code>选项会显示出所有没有被其他对象指向的对象，<code>dangling commit</code>后即为提交<code>E</code>的校验和。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git fsck <span class="token operator">--</span>full
<span class="token operator">...</span>
dangling commit 329e7f4<span class="token operator">...</span>
</code></pre></div><h4 id="磁盘空间"><a href="#磁盘空间" class="header-anchor">#</a> 磁盘空间</h4> <p>  运行如下命令，查看<code>Git</code>数据库中对象数量及其磁盘消耗。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git count<span class="token operator">-</span>objects <span class="token operator">-</span>v
<span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">3</span>
<span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">4</span>
<span class="token keyword">in</span><span class="token operator">-</span>pack<span class="token operator">:</span> <span class="token number">6</span>
<span class="token literal-property property">packs</span><span class="token operator">:</span> <span class="token number">1</span>
size<span class="token operator">-</span>pack<span class="token operator">:</span> <span class="token number">132</span>
prune<span class="token operator">-</span>packable<span class="token operator">:</span> <span class="token number">2</span>
<span class="token literal-property property">garbage</span><span class="token operator">:</span> <span class="token number">0</span>
size<span class="token operator">-</span>garbage<span class="token operator">:</span> <span class="token number">0</span>
</code></pre></div><p>  打印参数描述如下。</p> <ul><li><code>count</code>：松散对象的数量</li> <li><code>size</code>：松散对象占用的磁盘空间，以<code>KiB</code>为单位</li> <li><code>in-pack</code>：包文件中所有对象的数量，即<code>.git/objects/pack</code>目录下所有以<code>.idx</code>为后缀名文件中保存的对象的个数</li> <li><code>packs</code>：包文件的数量，即<code>.git/objects/pack</code>目录下以<code>.pack</code>为后缀名文件的个数</li> <li><code>size-pack</code>：包文件占用的磁盘空间，以<code>KiB</code>为单位</li> <li><code>prune-packable</code>：包文件中存在的松散对象的数量，运行<code>git prune-packed</code>可删除，运行<code>git prune-packed -n</code>显示将要删除的对象</li> <li><code>garbage</code>：垃圾文件的数量，既不是有效的松散对象也不是有效包的文件数</li> <li><code>size-garbage</code>：垃圾文件占用的磁盘空间，以<code>KiB</code>为单位</li></ul> <h4 id="移除对象"><a href="#移除对象" class="header-anchor">#</a> 移除对象</h4> <p>  如果某个人向<code>Git</code>版本库添加了一个特别大的文件，然后又从项目中移除了，但是由于<code>Git</code>提交历史跟踪了此文件，或者说通过提交历史可随时还原此文件，每次运行<code>git clone</code>克隆项目历史时，都会强制下载此文件，造成的情况就是每次克隆非常耗时。</p> <p>  因此必须从最早开始引用此文件的树对象开始重写每一个提交记录，此操作破坏性地修改了提交历史，其他人拉取记录时最好运行<code>git pull --rebase</code>。</p> <p>  可能由于历史线过长不知道那个特别大的文件是什么，可通过如下方式查找出那个文件。</p> <p>  首先运行<code>git gc</code>打包<code>Git</code>数据库中的对象，同时查看<code>.git/objects/pack</code>目录下文件。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git gc
find <span class="token punctuation">.</span>git<span class="token operator">/</span>objects<span class="token operator">/</span>pack <span class="token operator">-</span>type f
<span class="token punctuation">.</span>git<span class="token operator">/</span>objects<span class="token operator">/</span>pack<span class="token operator">/</span>pack<span class="token operator">-</span>3aa8<span class="token operator">...</span>a09e<span class="token punctuation">.</span>idx
<span class="token punctuation">.</span>git<span class="token operator">/</span>objects<span class="token operator">/</span>pack<span class="token operator">/</span>pack<span class="token operator">-</span>3aa8<span class="token operator">...</span>a09e<span class="token punctuation">.</span>pack
</code></pre></div><p>  运行如下命令，查看索引文件内容并排序。其中第一行输出索引文件内容，通过管道传递给下一行命令。<code>sort</code>排序管道输入内容，<code>-n</code>表示按照数值大小排序，<code>-k 3</code>表示根据内容的第三列进行排序。<code>tail -3</code>表示显示内容的尾部<code>3</code>行。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git verify<span class="token operator">-</span>pack <span class="token operator">-</span>v <span class="token punctuation">.</span>git<span class="token operator">/</span>objects<span class="token operator">/</span>pack<span class="token operator">/</span>pack<span class="token operator">-</span>3aa8<span class="token operator">...</span>a09e<span class="token punctuation">.</span>idx \
  <span class="token operator">|</span> sort <span class="token operator">-</span>n <span class="token operator">-</span>k <span class="token number">3</span> \
  <span class="token operator">|</span> tail <span class="token operator">-</span><span class="token number">3</span>
bc65c0d9<span class="token operator">...</span> commit <span class="token number">206</span> <span class="token number">141</span> <span class="token number">437</span>
c4a96707<span class="token operator">...</span> commit <span class="token number">206</span> <span class="token number">140</span> <span class="token number">1145</span>
072e320f<span class="token operator">...</span> blob   <span class="token number">7407405</span> <span class="token number">6594320</span> <span class="token number">1978</span>
</code></pre></div><p>  上述列表中数据对象<code>072e320f</code>占用了<code>7M</code>左右的空间，运行如下命令根据校验和查找对应文件名称。其中<code>git rev-list --objects --all</code>查看所有<code>Git</code>对象的校验和与文件名的关系，输入到管道符中，<code>grep</code>匹配校验和为<code>072e320f</code>的行，最终查找到<code>file.zip</code>即为那个<code>7M</code>的大文件。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git rev<span class="token operator">-</span>list <span class="token operator">--</span>objects <span class="token operator">--</span>all <span class="token operator">|</span> grep 072e320f
072e320f<span class="token operator">...</span> file<span class="token punctuation">.</span>zip
</code></pre></div><p>  运行如下命令查看哪些提交记录对此文件做了改动，其中<code>--branches</code>表示范围为当前版本库所有分支。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git log <span class="token operator">--</span>oneline <span class="token operator">--</span>branches <span class="token operator">--</span> file<span class="token punctuation">.</span>zip
<span class="token number">9</span><span class="token function">db12cc</span> <span class="token punctuation">(</span><span class="token constant">HEAD</span> <span class="token operator">-</span><span class="token operator">&gt;</span> master<span class="token punctuation">)</span> remove file<span class="token punctuation">.</span>zip
52bd5ce add file<span class="token punctuation">.</span>zip
</code></pre></div><p>  运行如下命令擦除提交历史，其中<code>52bd5ce^..HEAD</code>表示<code>52bd5ce</code>及以后的提交记录都会被擦除重写。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>git filter<span class="token operator">-</span>branch <span class="token operator">-</span>f <span class="token operator">--</span>prune<span class="token operator">-</span>empty <span class="token operator">--</span>index<span class="token operator">-</span>filter <span class="token string">'git rm -f --cached --ignore-unmatch file.zip'</span> 52bd5ce<span class="token operator">^</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token constant">HEAD</span>
</code></pre></div><p>  再运行如下命令，彻底清理提交历史并对仓库重新分析打包。</p> <ul><li>擦除命令默认会生成备份，实质是保存了一个引用，指向原提交历史中的最新提交，<code>rm -rf</code>删除<code>.git/refs/original</code>目录下引用</li> <li>修剪当前时间点前的所有引用日志</li> <li>打印出无法到达的对象</li> <li>将包中的所有无法到达的对象变成松散的、未打包的对象，而不是留在旧包中。打包后若新创建的包使某些现有包变得多余，删除冗余包</li> <li>花费更多时间更加积极地优化存储库，修剪当前时间点前的松散对象</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>rm <span class="token operator">-</span>rf <span class="token punctuation">.</span>git<span class="token operator">/</span>refs<span class="token operator">/</span>original<span class="token operator">/</span>
git reflog expire <span class="token operator">--</span>expire<span class="token operator">=</span>now <span class="token operator">--</span>all
git fsck <span class="token operator">--</span>full <span class="token operator">--</span>unreachable
git repack <span class="token operator">-</span><span class="token constant">A</span> <span class="token operator">-</span>d
git gc <span class="token operator">--</span>aggressive <span class="token operator">--</span>prune<span class="token operator">=</span>now
</code></pre></div><h2 id="gitk"><a href="#gitk" class="header-anchor">#</a> Gitk</h2> <p>  ;<code>Gitk</code>是<code>Git</code>内置的图形可视化工具，包括提交历史图、每个提交的相关信息以及版本树中的文件。</p> <p>  ;<code>Git</code>仓库根目录下运行<code>gitk</code>打开如下可视化界面。其中主要包括菜单栏<code>A</code>、提交历史<code>B</code>、提交信息<code>C</code>、版本树文件<code>D</code>四个区域。</p> <p><img src="/other/git/lower-gitk.png" alt=""></p> <h3 id="菜单栏"><a href="#菜单栏" class="header-anchor">#</a> 菜单栏</h3> <h4 id="file"><a href="#file" class="header-anchor">#</a> File</h4> <p><img src="/other/git/lower-gitk-file.png" alt=""></p> <ul><li><code>Update</code>：更新，命令行操作仓库后，将更改反应在<code>gitk</code>中，更新引用并显示新旧差异。一般变基后运行，可以比较前一个分支头和新的分支头</li> <li><code>Reload</code>：重新加载</li> <li><code>Reread references</code>：重读引用</li> <li><code>List references</code>：引用列表，包括标签和分支。其中<code>Filter</code>内<code>*</code>表示所有引用，<code>*master</code>则筛选<code>master</code>、<code>remotes/origin/master</code>分支</li></ul> <p><img src="/other/git/lower-gitk-file-reference.png" alt=""></p> <ul><li><code>Start git gui</code>：打开<code>git gui</code>可视化工具</li> <li><code>Quit</code>：退出</li></ul> <h4 id="edit"><a href="#edit" class="header-anchor">#</a> Edit</h4> <p><img src="/other/git/lower-gitk-edit.png" alt=""></p> <p>  首选项<code>Preferences</code>包括常用设置、颜色和字体设置。注意提交信息区<code>C</code>中可能出现部分中文乱码的情况，需要在当前仓库下<code>.git/config</code>中追加如下。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">[</span>gui<span class="token punctuation">]</span>
    encoding <span class="token operator">=</span> utf<span class="token operator">-</span><span class="token number">8</span>
</code></pre></div><p><img src="/other/git/lower-gitk-edit-preferences.png" alt=""></p> <ul><li><code>Maximum graph width (lines)</code>：最大图形宽度(线)</li> <li><code>Maximum graph width (% of pane)</code>：最大图形宽度(窗格百分比)</li> <li><code>Show local changes</code>：显示本地更改</li> <li><code>Auto-select SHA1 (length)</code>：自动选择<code>SHA-1</code>校验和(长度)</li> <li><code>Hide remote refs</code>：隐藏远程引用</li> <li><code>Tab spacing</code>：标签间距</li> <li><code>Display nearby tags/heads</code>：显示最近的标签或者引用</li> <li><code>Maximum # tags/heads to show</code>：标签或引用最大显示数</li> <li><code>Limit diffs to listed paths</code>：限制列出路径的差异</li> <li><code>Support per-file encodings</code>：支持文件编码</li> <li><code>External difftool</code>：外部<code>diff</code>工具</li> <li><code>Web browser</code>：<code>Web</code>浏览器</li> <li><code>Use themed widgets</code>：使用小部件主题</li></ul> <h4 id="view"><a href="#view" class="header-anchor">#</a> View</h4> <p><img src="/other/git/lower-gitk-view.png" alt=""></p> <p>  设置快速查询视图，可根据查询条件筛选查询记录，进而对比两个视图之间的差异。添加后的视图可编辑或者删除。</p> <p><img src="/other/git/lower-gitk-view-new.png" alt=""></p> <ul><li><code>View Name</code>：视图名称</li> <li><code>Branches &amp; tags</code>：分支或标签名，多个用空格隔开，可选项包括所有引用<code>All refs</code>、所有本地分支<code>All (local) branches</code>、所有标签<code>All tags</code>、所有远程跟踪分支<code>All remote-tracking branches</code></li> <li><code>Commit Info</code>：提交信息，包括作者<code>Author</code>、提交者<code>Committer</code>、提交信息<code>Commit Message</code>，可选项包括匹配所有提交信息条件<code>Matches all Commit Info citeria</code>、不匹配所有提交信息条件<code>Matches no Commit Info crteria</code></li> <li><code>Changes to Files</code>：文件内容的更改，包括固定字符串<code>Fixed String</code>、正则表达式匹配<code>Regular Expression</code></li> <li><code>Commit Dates</code>：提交时间，包括开始时间<code>Since</code>和结束时间<code>Until</code></li> <li><code>Limit and/or skip a number of revision (positive integer)</code>：显示固定数量的提交日志，可从头跳过一定数量的日志</li> <li><code>Miscellaneous options</code>：其他选项，包括按时间排序<code>Strictly sort by date</code>、标记分支侧<code>Mark branch sides</code>、限制第一父提交<code>Limit to first parent</code>、简要历史<code>Simple history</code>，也可自定义<code>git log</code>的参数</li> <li><code>Enter files and directories to include, one per line</code>：包括的文件和目录，一行一个</li></ul> <h4 id="help"><a href="#help" class="header-anchor">#</a> Help</h4> <p><img src="/other/git/lower-gitk-help.png" alt=""></p> <p>  ;<code>gitk</code>帮助包括<code>gitk</code>简介、快捷键。</p> <h3 id="提交历史"><a href="#提交历史" class="header-anchor">#</a> 提交历史</h3> <p><img src="/other/git/lower-gitk-commit-history.png" alt=""></p> <p>  提交历史包括提交信息、提交者、提交时间。</p> <p>  点击不同的提交历史会被高亮为蓝色背景，最下方显示此提交的<code>SHA-1</code>校验和，每次点击都会被<code>gitk</code>记录，左右箭头切换记录的提交，<code>Row</code>为当前点击的提交的行数和总行数。</p> <p>  提交信息会高亮本地分支、标签、远程跟踪分支，其中本地分支为绿色背景，<code>HEAD</code>指向的分支为黑色粗体，标签为黄色背景，远程跟踪分支为橙色背景。</p> <p>  ;<code>find</code>上下箭头切换满足查询条件的提交记录。</p> <h4 id="分支右键菜单"><a href="#分支右键菜单" class="header-anchor">#</a> 分支右键菜单</h4> <p><img src="/other/git/lower-gitk-branch-right.png" alt=""></p> <ul><li><code>Check out this branch</code>：切换到此分支，即<code>HEAD</code>指向此分支</li> <li><code>Rename this branch</code>：重命名此分支</li> <li><code>Remove this branch</code>：删除此分支</li> <li><code>Copy branch name</code>：拷贝分支名</li></ul> <h4 id="记录右键菜单"><a href="#记录右键菜单" class="header-anchor">#</a> 记录右键菜单</h4> <p><img src="/other/git/lower-gitk-record-right.png" alt=""></p> <ul><li><code>Create tag</code>：创建标签</li> <li><code>Copy commit reference</code>：拷贝此提交简略信息，包括<code>7</code>位<code>SHA-1</code>校验和、提交信息和提交时间（年月日）</li> <li><code>Write commit to file</code>：导出详细提交信息为文件，包括具体修改内容</li> <li><code>Create new branch</code>：创建新分支</li> <li><code>Cherry-pick</code>：拣选此提交</li> <li><code>Reset master branch to here</code>：重置<code>master</code>分支到此提交，包括<code>Soft</code>、<code>Mixed</code>和<code>Hard</code>，其中<code>Hard</code>将重置工作目录和暂存区，<code>Mixed</code>将重置暂存区域，<code>Soft</code>仅撤销此提交后的提交</li></ul> <p><img src="/other/git/lower-gitk-record-reset.png" alt=""></p> <ul><li><code>Mark this commit</code>：标记此提交，被标记的提交含黑色边框，注意只能有一个被标记的提交</li> <li><code>Revert this commit</code>：还原此提交，即生成新的提交来撤销此提交的修改</li></ul> <h4 id="标记后右键菜单"><a href="#标记后右键菜单" class="header-anchor">#</a> 标记后右键菜单</h4> <p>  标记某个提交后，其余的提交将开启部分右键菜单。</p> <p><img src="/other/git/lower-gitk-tag-right.png" alt=""></p> <ul><li><code>Return to mark</code>：跳转到被标记的提交</li> <li><code>Find descendant of this and mark</code>：查找当前提交和被标记的提交的最近的共同后代</li> <li><code>Compare with marked commit</code>：比较此提交和被标记的提交，不同于<code>diff</code></li> <li><code>Diff this -&gt; markedcommit</code>：<code>diff</code>此提交和被标记的提交</li> <li><code>Diff marked commit -&gt; this</code>：<code>diff</code>被标记的提交和此提交</li></ul> <h4 id="选中后右键菜单"><a href="#选中后右键菜单" class="header-anchor">#</a> 选中后右键菜单</h4> <p>  选中某次提交后，右键其他提交将开启部分右键菜单。</p> <p><img src="/other/git/lower-gitk-selected-right.png" alt=""></p> <ul><li><code>Diff this-&gt; selected</code>：<code>diff</code>此提交和被选中的提交</li> <li><code>Diff selected -&gt; this</code>：<code>diff</code>被选中的提交和此提交</li> <li><code>Make patch</code>：将此提交和被选中的提交的<code>diff</code>生成一个<code>patch</code>文件</li></ul> <h4 id="提交历史查询"><a href="#提交历史查询" class="header-anchor">#</a> 提交历史查询</h4> <p>  底部<code>commit</code>后为查询类型列表。</p> <p><img src="/other/git/lower-gitk-commit-history-type.png" alt=""></p> <ul><li><code>containing</code>：包含，配合后面范围参数</li> <li><code>touching paths</code>：文件路径</li> <li><code>adding/removing string</code>：修改内容包括添加或删除的字符串</li> <li><code>changing lines matching</code>：修改的行数</li></ul> <p>  查询方式。</p> <p><img src="/other/git/lower-gitk-search-type.png" alt=""></p> <ul><li><code>Exact</code>：精确匹配</li> <li><code>IgnCase</code>：忽略大小写</li> <li><code>Regexp</code>：正则表达式</li></ul> <p>  查询范围。</p> <p><img src="/other/git/lower-gitk-search-range.png" alt=""></p> <ul><li><code>All fileds</code>：所有范围</li> <li><code>Headline</code>：提交信息的标题</li> <li><code>Comments</code>：提交信息的内容</li> <li><code>Author</code>：作者</li> <li><code>Committer</code>：提交者</li></ul> <h3 id="提交信息"><a href="#提交信息" class="header-anchor">#</a> 提交信息</h3> <p>  显示提交的具体信息或两个提交的<code>diff</code>差异。</p> <p><img src="/other/git/lower-gitk-commit-msg.png" alt=""></p> <h4 id="选项参数"><a href="#选项参数" class="header-anchor">#</a> 选项参数</h4> <ul><li><code>Diff</code>：显示两个提交的<code>diff</code>差异</li> <li><code>Old version</code>：旧版本</li> <li><code>New version</code>：新版本</li> <li><code>Lines of context</code>：变更区域的上下文行数</li> <li><code>ignore space change</code>：忽略空格变化</li> <li><code>diff</code>样式：包括<code>Line diff</code>、<code>Markup words</code>和<code>Color words</code></li></ul> <p><img src="/other/git/lower-gitk-commit-params.png" alt=""></p> <h4 id="提交信息-2"><a href="#提交信息-2" class="header-anchor">#</a> 提交信息</h4> <ul><li><code>Author</code>：作者</li> <li><code>Committer</code>：提交者</li> <li><code>Tags</code>：当前标签节点</li> <li><code>Parent</code>：当前提交的父提交，合并提交存在多个父提交</li> <li><code>Branches</code>：当前节点最近的分支</li> <li><code>Follows</code>：当前节点最近的上一个标签</li> <li><code>Precedes</code>：当前节点最近的下一个标签</li></ul> <h3 id="版本树"><a href="#版本树" class="header-anchor">#</a> 版本树</h3> <p><img src="/other/git/lower-gitk-version-tree.png" alt=""></p> <h4 id="选项参数-2"><a href="#选项参数-2" class="header-anchor">#</a> 选项参数</h4> <ul><li><code>Patch</code>：仅显示变更的文件列表</li> <li><code>Tree</code>：显示完整文件树</li></ul> <h4 id="右键菜单"><a href="#右键菜单" class="header-anchor">#</a> 右键菜单</h4> <p><img src="/other/git/lower-gitk-right-menu.png" alt=""></p> <ul><li><code>Highlight this too</code>：高亮修改过此文件的提交记录</li> <li><code>Highlight this only</code>：仅高亮修改过此文件的提交记录，若当前提交历史中还高亮有其他文件，则取消其他文件的高亮</li> <li><code>External diff</code>：使用外部<code>diff</code>工具查看</li> <li><code>Blame parent commit</code>：查看此文件的全部内容的变更记录</li> <li><code>Copy path</code>：拷贝文件路径</li></ul> <h2 id="git-gui"><a href="#git-gui" class="header-anchor">#</a> Git Gui</h2> <p>  ;<code>Git Gui</code>也是<code>Git</code>内置的可视化工具，大部分操作相对于命令行显得方便很多，其中部分暂存等是命令行方式所达不到的。</p> <p>  仓库根目录下右击<code>Git GUI Here</code>或者命令行运行<code>git gui</code>打开如下可视化界面。其中主要包括菜单栏<code>A</code>、工作区变更<code>B</code>、差异对比<code>C</code>、暂存区<code>D</code>、提交信息<code>E</code>五个区域。</p> <p><img src="/other/git/lower-gui.png" alt=""></p> <h3 id="菜单栏-2"><a href="#菜单栏-2" class="header-anchor">#</a> 菜单栏</h3> <h4 id="repository"><a href="#repository" class="header-anchor">#</a> Repository</h4> <p><img src="/other/git/lower-gui-repos.png" alt=""></p> <ul><li><code>Explore Working Copy</code>：浏览工作目录</li> <li><code>Git Bash</code>：<code>Git</code>命令行</li> <li><code>Browse master's Files</code>：浏览当前分支文件</li> <li><code>Browse Branch Files</code>：浏览所有分支文件，其中<code>Revision Expression</code>为版本正则表达式，待选分支包括本地分支<code>Local Branch</code>、远程跟踪分支<code>Tracking Branch</code>、标签<code>Tag</code>，搜索栏关键字搜索待选分支</li></ul> <p><img src="/other/git/lower-gui-repos-browse-branch.png" alt=""></p> <ul><li><code>Visualize master's History</code>：可视化当前分支的历史</li> <li><code>Visualize All Branch History</code>：可视化所有分支的历史</li> <li><code>Database Statistics</code>：数据库统计，其中包括松散对象数量<code>Number of loose objects</code>、 松散对象占用的磁盘空间<code>Disk space used by loose objects</code>、包文件中的对象数量<code>Number of packed objects</code>、包文件数量<code>Number of packs</code>、包文件中对象占用的磁盘空间<code>Disk space used by packed objects</code>、包文件中的松散对象<code>Packed objects waiting for pruning</code>、垃圾文件<code>Garbage files</code>，<code>Compress Database</code>即打包<code>git gc</code>数据库</li></ul> <p><img src="/other/git/lower-gui-repos-database.png" alt=""></p> <ul><li><code>Compress Database</code>：打包数据库</li> <li><code>Verify Database</code>：验证<code>fsck</code>数据库连贯性和有效性</li> <li><code>Create Desktop Icon</code>：创建桌面图标</li> <li><code>Quit</code>：退出</li></ul> <h4 id="edit-2"><a href="#edit-2" class="header-anchor">#</a> Edit</h4> <p><img src="/other/git/lower-gui-edit.png" alt=""></p> <p>  ;<code>Edit</code>用于操作提交信息区域，包括撤销<code>Undo</code>、重做<code>Redo</code>、剪切<code>Cut</code>、复制<code>Copy</code>、粘贴<code>Paste</code>、删除<code>Delete</code>、全选<code>Select All</code>、选项<code>Options</code>，除了<code>Options</code>外的选项一般用处不大，都能通过快捷键实现。</p> <p><img src="/other/git/lower-gui-edit-options.png" alt=""></p> <p>  其中<code>repo Repository</code>为当前仓库下的配置选项，<code>Global (All Repository)</code>为全局下的仓库配置选项。</p> <ul><li><code>Summarize Merge Commits</code>：汇总合并提交</li> <li><code>Show Diffstat After Merge</code>：合并后显示<code>diff</code>统计</li> <li><code>use Merge Tool</code>：使用合并工具</li> <li><code>Trust File Modification Timestamps</code>：信任文件的改动时间</li> <li><code>Prune Tracking Branches During Fetch</code>：获取时清除跟踪分支</li> <li><code>Match Tracking Branches</code>：匹配跟踪分支</li> <li><code>Use Textconv For Diffs and Blames</code>：对差异和标注使用<code>Textconv</code></li> <li><code>Blame Copy Only On Changed Files</code>：仅标注变动的文件</li> <li><code>Maximum Length of Recent Repositories List</code>：当前版本库列表的最大长度</li> <li><code>Minimum Letters To Blame Copy On</code>：标注副本的最少字母数量</li> <li><code>Blame History Context Radius (days)</code>：标注历史上下文范围（天）</li> <li><code>Number of Diff Context Line</code>：<code>diff</code>差异的上下文行数</li> <li><code>Additional Diff Parameters</code>：其他<code>diff</code>参数</li> <li><code>Commit Message Text Width</code>：提交信息文本宽度</li> <li><code>Commit Message Text Width</code>：新分支名称模板</li> <li><code>Default File Contents Encoding</code>：默认文件内容编码格式</li> <li><code>Warn before committing to a detached head</code>：提交到一个游离的<code>HEAD</code>前警告</li> <li><code>Staging of untracked files</code>：暂存未跟踪的文件，包括是<code>yes</code>、否<code>no</code>或者询问<code>ask</code></li> <li><code>Show untracked files</code>：显示未跟踪的文件</li></ul> <h4 id="branch"><a href="#branch" class="header-anchor">#</a> Branch</h4> <p><img src="/other/git/lower-gui-branch.png" alt=""></p> <ul><li><code>Create</code>：创建分支，可输入分支名称<code>Name</code>创建，也可匹配远程跟踪分支<code>Match Tracking Branch Name</code>检出跟踪分支。或者从本地分支<code>Local Branch</code>、远程跟踪分支<code>Tracking Branch</code>、标签<code>Tag</code>检出分支，相关分支选项<code>Options</code>为更新存在的分支<code>Update Existing Branch</code>，包括无操作<code>No</code>、仅快进<code>Fast Forward Only</code>、重置<code>Reset</code>，拉取跟踪分支<code>Fetch Tracking Branch</code>，创建分支后并检出<code>Checkout After Creation</code></li></ul> <p><img src="/other/git/lower-gui-branch-create.png" alt=""></p> <ul><li><code>Checkout</code>：检出分支</li> <li><code>Rename</code>：分支重命名</li> <li><code>Delete</code>：删除分支</li> <li><code>Reset</code>：重置当前分支，若包括有未提交的修改，重置时将丢失</li></ul> <h4 id="commit"><a href="#commit" class="header-anchor">#</a> Commit</h4> <p><img src="/other/git/lower-gui-commit.png" alt=""></p> <ul><li><code>Amend Last Commit</code>：修改最后一次提交</li> <li><code>Rescan</code>：刷新，外部命令行操作了版本库，刷新同步</li> <li><code>Statge To Commit</code>：暂存选中的文件</li> <li><code>Stage Changed Files To Commit</code>：暂存工作区文件</li> <li><code>Unstage Form Commit</code>：撤销暂存选中的文件</li> <li><code>Show Less Context</code>：<code>diff</code>显示更少的上下文</li> <li><code>Show More Context</code>：<code>diff</code>显示更多的上下文</li> <li><code>Sign Off</code>：提交信息末尾追加操作者信息，一般拣选时不清楚提交记录的来源，可追加操作者信息便于追溯</li> <li><code>Commit</code>：提交</li></ul> <h4 id="merge"><a href="#merge" class="header-anchor">#</a> Merge</h4> <p><img src="/other/git/lower-gui-merge.png" alt=""></p> <ul><li><code>Local Merge</code>：选择本地分支合并</li> <li><code>Abort Merge</code>：撤销合并，某些情况下合并造成冲突，退回合并前的状态</li></ul> <h4 id="remote"><a href="#remote" class="header-anchor">#</a> Remote</h4> <p><img src="/other/git/lower-gui-remote.png" alt=""></p> <ul><li><code>Fetch from</code>：获取某个远程库更新</li> <li><code>Prune from</code>：裁剪从某个远程库删除的跟踪分支</li> <li><code>Remove Remote</code>：删除某个远程库</li> <li><code>Add</code>：添加某个远程库，包括立即拉取<code>Fetch Immediately</code>、初始化远程仓库并推送<code>Initialize Remote Repository and Push</code>、无操作<code>Do Nothing EIse Now</code></li></ul> <p><img src="/other/git/lower-gui-remote-add.png" alt=""></p> <ul><li><code>Push</code>：推送，可推送至指定远程仓库，也可强制覆盖已存在的分支<code>Force overwrite existing branch (may discard changes)</code>、使用简包<code>Use thin pack (for slow network connections)</code>、包括本地标签<code>Include tags</code></li></ul> <p><img src="/other/git/lower-gui-remote-push.png" alt=""></p> <ul><li><code>Delete Branch</code>：删除某个远程库的分支</li></ul> <h4 id="tools"><a href="#tools" class="header-anchor">#</a> Tools</h4> <p><img src="/other/git/lower-gui-tools.png" alt=""></p> <ul><li><code>Add</code>：添加新的命令，包括命令名称<code>Name</code>、命令指令<code>Command</code>，运行前可显示对话框<code>Show a dialog before running</code>，用户选中一个版本<code>Ask the user to select a revision</code>或者询问用户附加参数<code>Ask the user for additional arguments</code>，不显示命令输出窗口<code>Don't show the command output window</code>，仅选择了<code>diff</code>才运行<code>Run only if a diff is selected</code></li></ul> <p><img src="/other/git/lower-gui-tools-add.png" alt=""></p> <ul><li><code>Remove</code>：删除某个添加的命令</li></ul> <h4 id="help-2"><a href="#help-2" class="header-anchor">#</a> Help</h4> <p><img src="/other/git/lower-gui-help.png" alt=""></p> <ul><li><code>About Git Gui</code>：关于<code>Git Gui</code></li> <li><code>Online Documentation</code>：在线文档</li> <li><code>Show SSH Key</code>：显示<code>SSH</code>公匙，当前不存在可点击<code>Generate Key</code>生成<code>Key</code></li></ul> <p><img src="/other/git/lower-gui-help-key.png" alt=""></p> <h3 id="差异对比"><a href="#差异对比" class="header-anchor">#</a> 差异对比</h3> <p><img src="/other/git/lower-gui-diff.png" alt=""></p> <p>  差异对比区域无任何文件时右键菜单。</p> <ul><li><code>Undo Last Revert</code>：撤销最后一次丢弃<code>Revert</code>，丢弃文件<code>Revert Hunk</code>或丢弃行<code>Revert Line</code>均会丢弃掉修改，<code>Git Bash</code>命令行<code>git checkout</code>丢弃掉修改则无法再恢复，但是<code>Git Gui</code>缓存了最后一次丢弃前的那个文件的版本</li> <li><code>Refresh</code>：刷新</li> <li><code>Copy</code>：复制</li> <li><code>Select All</code>：全选</li> <li><code>Copy All</code>：复制全部</li> <li><code>Decrease Font Size</code>：缩小字体</li> <li><code>Increase Font Size</code>：放大字体</li> <li><code>Encoding</code>：文件内容编码</li> <li><code>Options</code>：选项</li></ul> <h3 id="工作区变更"><a href="#工作区变更" class="header-anchor">#</a> 工作区变更</h3> <p><img src="/other/git/lower-gui-working.png" alt=""></p> <p>  点击文件前蓝色图标可快捷暂存文件，差异对比开启部分右键菜单。</p> <p><img src="/other/git/lower-gui-working-right.png" alt=""></p> <ul><li><code>Stage Hunk For Commit</code>：暂存文件</li> <li><code>Stage Line For Commit</code>：暂存某一行或者多行，可通过点击某一行或者托选多行实现选中</li> <li><code>Rever Hunk</code>：撤销或丢弃文件的修改</li> <li><code>Rever Line</code>：撤销或丢弃某一行或者多行的修改</li> <li><code>Show Less Context</code>：显示更少的上下文</li> <li><code>Show More Context</code>：显示更多的上下文</li></ul> <h3 id="暂存区"><a href="#暂存区" class="header-anchor">#</a> 暂存区</h3> <p><img src="/other/git/lower-gui-index.png" alt=""></p> <p>  点击文件前绿色图标可快捷取消暂存文件，差异对比开启部分右键菜单。</p> <p><img src="/other/git/lower-gui-index-right.png" alt=""></p> <ul><li><code>Unstaged Hunk From Commit</code>：取消暂存文件</li> <li><code>Unstaged Line From Commit</code>：取消暂存文件的某一行或者多行</li></ul> <h3 id="提交信息-3"><a href="#提交信息-3" class="header-anchor">#</a> 提交信息</h3> <p><img src="/other/git/lower-gui-commit-msg.png" alt=""></p> <ul><li><code>Rescan</code>：刷新</li> <li><code>Staged Changed</code>：暂存文件</li> <li><code>Sign Off</code>：签署，提交信息的末尾追加一行操作者信息</li> <li><code>Push</code>：推送</li> <li><code>Amend Last Commit</code>：修改最后一次提交</li> <li><code>Commit Message</code>：提交信息</li></ul> <p>  提交信息右键菜单与菜单栏基本一致。</p> <p><img src="/other/git/lower-gui-commit-msg-right.png" alt=""></p> <p><a href="/pages/other/git/middle.html">上一篇</a></p> <h2 id="🎉-写在最后"><a href="#🎉-写在最后" class="header-anchor">#</a> 🎉 写在最后</h2> <p>🍻伙伴们，如果你已经看到了这里，觉得这篇文章有帮助到你的话不妨点赞👍或 <a href="https://github.com/dongwei1125/blog" target="_blank" rel="noopener noreferrer">Star<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ✨支持一下哦！</p> <p>手动码字，如有错误，欢迎在评论区指正💬~</p> <p>你的支持就是我更新的最大动力💪~</p> <p><a href="https://github.com/dongwei1125" target="_blank" rel="noopener noreferrer">GitHub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> / <a href="https://gitee.com/dongwei1125" target="_blank" rel="noopener noreferrer">Gitee<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<a href="https://dongwei1125.github.io/" target="_blank" rel="noopener noreferrer">GitHub Pages<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<a href="https://juejin.cn/user/2621689331987783" target="_blank" rel="noopener noreferrer">掘金<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<a href="https://blog.csdn.net/Don_GW" target="_blank" rel="noopener noreferrer">CSDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 同步更新，欢迎关注😉~</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间:</span> <span class="time">3/6/2022, 9:06:37 PM</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.0aa97f73.js" defer></script><script src="/assets/js/2.f850a8ef.js" defer></script><script src="/assets/js/56.03003660.js" defer></script>
  </body>
</html>
